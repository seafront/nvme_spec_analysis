



**Device Self-test command**


The Device Self-test command is used to start a device self-test operation or abort a device self-test
operation (refer to section 8.1.7). The Device Self-test command is used specifically to:


a) start a short device self-test operation;
b) start an extended device self-test operation;
c) start a Host-Initiated Refresh operation;
d) start a vendor specific device self-test operation; or
e) abort a device self-test operation already in process.


A Host-Initiated Refresh operation is a device self-test operation.


The device self-test operation is performed by the controller that the Device Self-test command was
submitted to. The Namespace Identifier field controls which namespaces are included in the device selftest operation as specified in Figure 171. For a Host-Initiated Refresh operation, the Namespace Identifier
field shall be ignored by the controller.


**Figure 171: Device Self-test Namespace Test Action**







|NSID Value|Definition|
|---|---|
|00000000h|Specifies that the device self-test operation shall not include any namespaces, and only the<br>controller is included as part of the device self-test operation.|
|00000001h to<br>FFFFFFFEh|Specifies that the device self-test operation shall include the specified namespace. If this field<br>specifies an invalid namespace ID, then the controller shall abort the command with a status<br>code of Invalid Namespace or Format. If this field specifies an inactive namespace ID, then the<br>controller shall abort the command with a status code of Invalid Field in Command.|
|FFFFFFFFh|Specifies that the device self-test operation shall include all attached namespaces accessible<br>through the controller at the time the device self-test operation is started.|


185


NVM Express [®] Base Specification, Revision 2.2


The Device Self-test command uses the Command Dword 10 field and the Command Dword 15 field. All
other command specific fields are reserved.


**Figure 172: Device Self-test – Command Dword 10**





|Bits|Description|
|---|---|
|31:04|Reserved|
|03:00|**Self-test Code (STC):**This field specifies the action taken by the Device Self-test command. <br>**Value** <br>**Definition** <br>0h<br>Reserved<br>1h<br>Start a short device self-test operation<br>2h<br>Start an extended device self-test operation<br>3h<br>Start a Host-Initiated Refresh operation<br>4h to Dh<br>Reserved<br>Eh<br>Vendor specific. Additional information may be provided in Command Dword 15<br>(refer to Figure 173).<br>Fh<br>Abort device self-test operation|


|Value|Definition|
|---|---|
|0h|Reserved|
|1h|Start a short device self-test operation|
|2h|Start an extended device self-test operation|
|3h|Start a Host-Initiated Refresh operation|
|4h to Dh|Reserved|
|Eh|Vendor specific. Additional information may be provided in Command Dword 15<br>(refer to Figure 173).|
|Fh|Abort device self-test operation|


**Figure 173: Device Self-test – Command Dword 15**



|Bits|Description|
|---|---|
|31:00|**Device Self-test Parameter (DSTP):** If the Self-test Code field is set to Eh (refer to Figure 172), then<br>this field is vendor specific; otherwise this field is reserved.|


The processing of a Device Self-test command and interactions with a device self-test operation already in
progress is defined in Figure 174.


**Figure 174: Device Self-test – Command Processing**











|Self-test in<br>1<br>Progress|Self-test Code value in new<br>Drive Self-test command|Controller Action|
|---|---|---|
|Yes|1h – Short device self-test|Abort the new Device Self-test command with a status<br>code of Device Self-test in Progress.|
|Yes|2h – Extended device self-test|2h – Extended device self-test|
|Yes|3h – Host-Initiated Refresh|3h – Host-Initiated Refresh|
|Yes|Eh – Vendor specific|Vendor specific|
|Yes|Fh – Abort device self-test|The controller takes the following actions in order:<br>1.<br>Abort device self-test operation in progress;<br>2.<br>Create log entry in the Newest Self-test Result<br>Data Structure in the Device Self-test log page;<br>3.<br>Set the Device Selt-test Result field of the current<br>Device Self-test Status field in the Device Self-<br>test log page to 0h; and<br>4.<br>Completes command successfully.|
|No|1h – Short device self-test|The controller takes the following actions in order:<br>1.<br>Validate the command parameters;<br>2.<br>Set the Device Selt-test Result field of the current<br>Device Self-test Status field in the Device Self-<br>test log page to 1h;<br>3.<br>Start a device self-test operation; and<br>4.<br>Completes command successfully.|


186


NVM Express [®] Base Specification, Revision 2.2


**Figure 174: Device Self-test – Command Processing**













|Self-test in<br>1<br>Progress|Self-test Code value in new<br>Drive Self-test command|Controller Action|
|---|---|---|
||2h – Extended device self-test|The controller takes the following actions in order:<br>1.<br>Validate the command parameters;<br>2.<br>Set the Device Selt-test Result field of the current<br>Device Self-test Status field in the Device Self-<br>test log page to 2h;<br>3.<br>Start a device self-test operation; and<br>4.<br>Complete the command successfully.|
||3h – Host-Initiated Refresh|The controller takes the following actions in order:<br>1.<br>Validate the command parameters;<br>2.<br>Set the Device Selt-test Result field of the current<br>Device Self-test Status field in the Device Self-<br>test log page to 3h;<br>3.<br>Start a Host-Initiated Refresh operation; and<br>4.<br>Complete the command successfully.|
||Eh – Vendor specific|Vendor specific|
||Fh – Abort device self-test|Completes command successfully. The Device Self-test<br>log page is not modified.|
|Notes:<br>1.<br>If the Single Device Self-test Operation (SDSO) bit is cleared to ‘0’ in the Device Self-test Options (DSTO) of<br>the Identify Controller data structure (refer to Figure 313), then the Self-test in Progress column represents that<br>a device self-test operation is in progress on the controller that the new Device Self-test command was received<br>on. If the SDSO bit is set to ‘1’, then the Self-test in Progress column represents that a device self-test operation<br>is in progress on the NVM subsystem.|Notes:<br>1.<br>If the Single Device Self-test Operation (SDSO) bit is cleared to ‘0’ in the Device Self-test Options (DSTO) of<br>the Identify Controller data structure (refer to Figure 313), then the Self-test in Progress column represents that<br>a device self-test operation is in progress on the controller that the new Device Self-test command was received<br>on. If the SDSO bit is set to ‘1’, then the Self-test in Progress column represents that a device self-test operation<br>is in progress on the NVM subsystem.|Notes:<br>1.<br>If the Single Device Self-test Operation (SDSO) bit is cleared to ‘0’ in the Device Self-test Options (DSTO) of<br>the Identify Controller data structure (refer to Figure 313), then the Self-test in Progress column represents that<br>a device self-test operation is in progress on the controller that the new Device Self-test command was received<br>on. If the SDSO bit is set to ‘1’, then the Self-test in Progress column represents that a device self-test operation<br>is in progress on the NVM subsystem.|


**Command Completion**


A completion queue entry is posted to the Admin Completion Queue after the appropriate actions are taken
as specified in Figure 174. Device Self-test command specific status values are defined in Figure 175.


**Figure 175: Device Self-test – Command Specific Status Values**

|Value|Definition|
|---|---|
|1Dh|**Device Self-test in Progress:** The controller or NVM subsystem already has a device self-test<br>operation in process.|


