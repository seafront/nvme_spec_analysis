**Set Features command**


The Set Features command specifies the attributes of the Feature indicated.


The Set Features command uses the Data Pointer, Command Dword 10, and Command Dword 14. The
use of Command Dword 11, Command Dword 12, Command Dword 13, and Command Dword 15 fields is
Feature specific. If Command Dword 11, Command Dword 12, Command Dword 13, or Command Dword
15 fields are not used, then the Command Dwords are reserved.


**Figure 383: Set Features – Data Pointer**





|Bits|Description|
|---|---|
|127:00|**Data Pointer (DPTR):**This field specifies the start of the data buffer. Refer to Figure 92 for the definition<br>of this field. If using PRPs, this field shall not be a pointer to a PRP List as the data buffer may not cross<br>more than one page boundary. If no data structure is used as part of the specified feature, then this field<br>is not used.|


367


NVM Express [®] Base Specification, Revision 2.2


**Figure 384: Set Features – Command Dword 10**







|Bits|Description|
|---|---|
|31|**Save (SV):** This bit specifies that the controller shall save the attribute so that the attribute persists<br>through all power states and resets.<br>The controller indicates in the Save and Select Feature Support (SSFS) bit in the Optional NVM<br>Command Support field of the Identify Controller data structure in Figure 313 whether this bit is<br>supported.<br>If the Feature Identifier specified in the Set Features command is not saveable by the controller and the<br>controller receives a Set Features command with this bit set to ‘1’, then the command shall be aborted<br>with a status code of Feature Identifier Not Saveable.|
|30:08|Reserved|
|07:00|**Feature Identifier (FID):**This field indicates the identifier of the Feature that attributes are being<br>specified for.|


If the controller supports selection of a UUID by the Set Features command (refer to Figure 386 and section
8.1.28) and the controller supports selection of a UUID for the specified vendor specific feature identifier
(refer to Figure 386), then Command Dword 14 is used to specify a UUID Index value (refer to Figure 385).
If the controller does not support selection of a UUID by the Set Features command or the controller does
not support selection of a UUID for the specified vendor specific feature identifier, then Command Dword
14 does not specify a UUID Index value.


**Figure 385: Set Features – Command Dword 14**

|Bits|Description|
|---|---|
|31:07|Reserved|
|06:00|**UUID Index (UIDX):** Refer to Figure 659.|



Figure 386 defines the Features that are able to be configured with a Set Features command and retrieved
with a Get Features command.


Section 5.1.25.1 describes features that are common to all transport models. Section 5.1.25.2 describes
features that are specific to the Memory-based transport model. Section 5.1.25.3 describes features that
are specific to the Message-based transport model.


**Figure 386: Set Features – Feature Identifiers**











|Feature<br>Identifier|Current Setting<br>Persists<br>Across Power<br>Cycle and<br>2<br>Reset|Uses<br>Memory<br>Buffer for<br>Attributes|Feature Name|6<br>Scope|
|---|---|---|---|---|
|00h|Reserved|Reserved|Reserved|Reserved|
|01h|No|No|Arbitration|Controller|
|02h|No|No|Power Management|Controller7|
|03h|Refer to the NVM Command Set Specification|Refer to the NVM Command Set Specification|Refer to the NVM Command Set Specification|Refer to the NVM Command Set Specification|
|04h|No|No|Temperature Threshold|Controller|
|05h|Refer to the NVM Command Set Specification|Refer to the NVM Command Set Specification|Refer to the NVM Command Set Specification|Refer to the NVM Command Set Specification|
|06h|No|No|Volatile Write Cache|Controller|
|07h|No|No|Number of Queues|Controller|
|08h|No|No|Interrupt Coalescing|Controller|
|09h|No|No|Interrupt Vector Configuration|Controller|
|0Ah|Refer to the NVM Command Set Specification|Refer to the NVM Command Set Specification|Refer to the NVM Command Set Specification|Refer to the NVM Command Set Specification|
|0Bh|No|No|Asynchronous Event Configuration|Controller|
|0Ch|No|Yes|Autonomous Power State Transition|Controller7|


368


NVM Express [®] Base Specification, Revision 2.2


**Figure 386: Set Features – Feature Identifiers**

















|Feature<br>Identifier|Current Setting<br>Persists<br>Across Power<br>Cycle and<br>2<br>Reset|Uses<br>Memory<br>Buffer for<br>Attributes|Feature Name|6<br>Scope|
|---|---|---|---|---|
|0Dh|No3|No4|Host Memory Buffer|Controller|
|0Eh|No|Yes|Timestamp|Controller|
|0Fh|No|No|Keep Alive Timer|Controller|
|10h|Yes|No|Host Controlled Thermal Management|Controller|
|11h|No|No|Non-Operational Power State Config|Controller|
|12h|Yes|No|Read Recovery Level Config|NVM Set|
|12h|Yes|No|Read Recovery Level Config|NVM subsystem|
|13h|No|Yes|Predictable Latency Mode Config|NVM Set|
|14h|No|No|Predictable Latency Mode Window|NVM Set|
|15h|Refer to the NVM Command Set Specification|Refer to the NVM Command Set Specification|Refer to the NVM Command Set Specification|Refer to the NVM Command Set Specification|
|16h|No|Yes|Host Behavior Support|Controller|
|17h|Yes|No|Sanitize Config|NVM subsystem|
|18h|No|No|Endurance Group Event Configuration|Endurance Group|
|19h|Yes|No|I/O Command Set Profile|Controller|
|1Ah|Yes|No|Spinup Control|NVM subsystem|
|1Bh|Yes|No|Power Loss Signaling Config|Domain|
|1Ch|Refer to the NVM Command Set Specification|Refer to the NVM Command Set Specification|Refer to the NVM Command Set Specification|Refer to the NVM Command Set Specification|
|1Dh|Yes|No|Flexible Data Placement|Endurance Group|
|1Eh|Yes|Yes|Flexible Data Placement Events|Reclaim Unit<br>Handle|
|1Fh|Yes|Yes|Namespace Admin Label|Namespace|
|20h|Refer to the Key Value Command Set Specification|Refer to the Key Value Command Set Specification|Refer to the Key Value Command Set Specification|Refer to the Key Value Command Set Specification|
|21h|No|Yes|Controller Data Queue|Controller Data<br>Queue per<br>controller|
|22h to 77h|Reserved|Reserved|Reserved|Reserved|
|78h|Yes|Yes|Embedded Management Controller Address|NVM subsystem|
|79h|Yes|Yes|Host Management Agent Address|NVM subsystem|
|7Ah to 7Ch|Reserved for Management Features.|Reserved for Management Features.|Reserved for Management Features.|Reserved for Management Features.|
|7Dh|No|Yes|Enhanced Controller Metadata|Controller|
|7Eh|No|Yes|Controller Metadata|Controller|
|7Fh|No|Yes|Namespace Metadata|Namespace per<br>controller|
|80h|Yes|No|Software Progress Marker|Controller|
|81h|No|Yes|Host Identifier|Controller|
|82h|No|No|Reservation Notification Mask|Namespace|
|83h|Yes|No|Reservation Persistence|Namespace|
|84h|No|No|Namespace Write Protection Config|Namespace|
|85h|No|No|Boot Partition Write Protection Config|Controller|
|86h to BFh|Reserved|Reserved|Reserved|Reserved|


369


NVM Express [®] Base Specification, Revision 2.2


**Figure 386: Set Features – Feature Identifiers**











|Feature<br>Identifier|Current Setting<br>Persists<br>Across Power<br>Cycle and<br>2<br>Reset|Uses<br>Memory<br>Buffer for<br>Attributes|Feature Name|6<br>Scope|
|---|---|---|---|---|
|C0h to FFh|Vendor Specific1, 5|Vendor Specific1, 5|Vendor Specific1, 5|Vendor Specific1, 5|
|Notes:<br>1.<br>The behavior of a controller in response to an inactive namespace ID to a vendor specific Feature Identifier is<br>vendor specific.<br>2.<br>This column is only valid if the feature is not saveable (refer to section 4.4). If the feature is saveable, then this<br>column is not used.<br>3.<br>The controller does not save settings for the Host Memory Buffer feature across power states and reset events,<br>however, host software may restore the previous values. Refer to section 8.2.3.<br>4.<br>The feature does not use a memory buffer for Set Features commands and does use a memory buffer for Get<br>Features commands. Refer to section 5.1.25.2.4.<br>5.<br>Selection of a UUID may be supported. Refer to section 8.1.28.<br>6.<br>Refer to Feature Identifiers Supported and Effects log page in section 5.1.12.1.18 for how scope is reported to<br>the host.<br>7.<br>For NVM Subsystems with multiple controllers in the same domain, specifying different power states results in<br>an unspecified power state for that domain.|Notes:<br>1.<br>The behavior of a controller in response to an inactive namespace ID to a vendor specific Feature Identifier is<br>vendor specific.<br>2.<br>This column is only valid if the feature is not saveable (refer to section 4.4). If the feature is saveable, then this<br>column is not used.<br>3.<br>The controller does not save settings for the Host Memory Buffer feature across power states and reset events,<br>however, host software may restore the previous values. Refer to section 8.2.3.<br>4.<br>The feature does not use a memory buffer for Set Features commands and does use a memory buffer for Get<br>Features commands. Refer to section 5.1.25.2.4.<br>5.<br>Selection of a UUID may be supported. Refer to section 8.1.28.<br>6.<br>Refer to Feature Identifiers Supported and Effects log page in section 5.1.12.1.18 for how scope is reported to<br>the host.<br>7.<br>For NVM Subsystems with multiple controllers in the same domain, specifying different power states results in<br>an unspecified power state for that domain.|Notes:<br>1.<br>The behavior of a controller in response to an inactive namespace ID to a vendor specific Feature Identifier is<br>vendor specific.<br>2.<br>This column is only valid if the feature is not saveable (refer to section 4.4). If the feature is saveable, then this<br>column is not used.<br>3.<br>The controller does not save settings for the Host Memory Buffer feature across power states and reset events,<br>however, host software may restore the previous values. Refer to section 8.2.3.<br>4.<br>The feature does not use a memory buffer for Set Features commands and does use a memory buffer for Get<br>Features commands. Refer to section 5.1.25.2.4.<br>5.<br>Selection of a UUID may be supported. Refer to section 8.1.28.<br>6.<br>Refer to Feature Identifiers Supported and Effects log page in section 5.1.12.1.18 for how scope is reported to<br>the host.<br>7.<br>For NVM Subsystems with multiple controllers in the same domain, specifying different power states results in<br>an unspecified power state for that domain.|Notes:<br>1.<br>The behavior of a controller in response to an inactive namespace ID to a vendor specific Feature Identifier is<br>vendor specific.<br>2.<br>This column is only valid if the feature is not saveable (refer to section 4.4). If the feature is saveable, then this<br>column is not used.<br>3.<br>The controller does not save settings for the Host Memory Buffer feature across power states and reset events,<br>however, host software may restore the previous values. Refer to section 8.2.3.<br>4.<br>The feature does not use a memory buffer for Set Features commands and does use a memory buffer for Get<br>Features commands. Refer to section 5.1.25.2.4.<br>5.<br>Selection of a UUID may be supported. Refer to section 8.1.28.<br>6.<br>Refer to Feature Identifiers Supported and Effects log page in section 5.1.12.1.18 for how scope is reported to<br>the host.<br>7.<br>For NVM Subsystems with multiple controllers in the same domain, specifying different power states results in<br>an unspecified power state for that domain.|Notes:<br>1.<br>The behavior of a controller in response to an inactive namespace ID to a vendor specific Feature Identifier is<br>vendor specific.<br>2.<br>This column is only valid if the feature is not saveable (refer to section 4.4). If the feature is saveable, then this<br>column is not used.<br>3.<br>The controller does not save settings for the Host Memory Buffer feature across power states and reset events,<br>however, host software may restore the previous values. Refer to section 8.2.3.<br>4.<br>The feature does not use a memory buffer for Set Features commands and does use a memory buffer for Get<br>Features commands. Refer to section 5.1.25.2.4.<br>5.<br>Selection of a UUID may be supported. Refer to section 8.1.28.<br>6.<br>Refer to Feature Identifiers Supported and Effects log page in section 5.1.12.1.18 for how scope is reported to<br>the host.<br>7.<br>For NVM Subsystems with multiple controllers in the same domain, specifying different power states results in<br>an unspecified power state for that domain.|


**Common Feature Specific Information**


Refer to section 3.1.3.6 for mandatory, optional, and prohibited features for the various controller types.
Some Features utilize a memory buffer to configure or return attributes for a Feature, whereas others only
utilize a dword in the command or completion queue entry. For more information on Features, including
default value definitions, saved value definitions, and current value definitions, refer to section 4.4.


Upon completion of a Set Features command for a feature, the host should rediscover, re-enumerate and/or
re-initialize all capabilities associated with that feature. For example, if a namespace capability change may
occur for a feature, then host software should pause the use of any associated namespace, submit the Set
Features command for that feature and wait for that command to complete, and then re-issue commands
to all namespaces affected by that Set Features command.


There may be commands in execution when a Feature is changed. The new settings may or may not apply
to commands already submitted for execution when the Feature is changed. Any commands submitted to
a Submission Queue after a Set Features command is successfully completed shall utilize the new settings
for the associated Feature. To ensure that a Features values apply to all subsequent commands, the host
should allow commands being processed to complete prior to issuing the Set Features command.


If the controller does not support a changeable value for a Feature (i.e., the Feature is not changeable,
refer to section 5.1.11.2), and a Set Features command for that Feature is processed, then if that command
specifies a Feature value that:


  - is not the same as the existing value for that Feature, then the controller shall abort that command
with a status code of Feature Not Changeable; and

  - is the same as the existing value for that Feature, then the controller may:


`o` complete that command successfully; or
`o` abort that command with a status code of Feature Not Changeable.


Refer to each feature description in this section for any additional requirements associated with that feature.


**5.1.25.1.1** **Arbitration (Feature Identifier 01h)**


This Feature controls command arbitration within the controller. Refer to section 3.4.4 for command
arbitration details. The attributes are specified in Command Dword 11.


370


NVM Express [®] Base Specification, Revision 2.2


If a Get Features command is submitted for this Feature, the attributes specified in Figure 387 are returned
in Dword 0 of the completion queue entry for that command.


**Figure 387: Arbitration & Command Processing – Command Dword 11**






|Bits|Description|
|---|---|
|31:24|**High Priority Weight (HPW):**This field defines the number of commands that may be executed from<br>the high priority service class in each arbitration round. This is a 0’s based value.|
|23:16|**Medium Priority Weight (MPW):**This field defines the number of commands that may be executed from<br>the medium priority service class in each arbitration round. This is a 0’s based value.|
|15:08|**Low Priority Weight (LPW):**This field defines the number of commands that may be executed from the<br>low priority service class in each arbitration round. This is a 0’s based value.|
|07:03|Reserved|
|02:00|**Arbitration Burst (AB):** Indicates the maximum number of commands that the controller may fetch at<br>one time from a particular Submission Queue. The value is expressed as a power of two (e.g., 000b<br>indicates one, 011b indicates eight). A value of 111b indicates no limit.|



**5.1.25.1.2** **Power Management (Feature Identifier 02h)**


This Feature allows the host to configure the controller power state. The attributes are specified in
Command Dword 11 (refer to Figure 388).


Upon successful completion of a Set Features command for this Feature, the controller shall be in the
Power State specified. For a transition to a non-operational power state, the device may exceed the power
indicated for that non-operational power state as defined in section 8.1.17.1 (e.g., while completing this
command). If enabled, autonomous power state transitions continue to occur from the new state.


If a Get Features command is submitted for this Feature, the attributes described in Figure 389 are returned
in Dword 0 of the completion queue entry for that command.


**Figure 388: Power Management – Command Dword 11**





|Bits|Description|
|---|---|
|31:08|Reserved|
|07:05|**Workload Hint (WH):** This field indicates the type of workload expected. This hint may be used to<br>optimize performance. Refer to section 8.1.17.3 for more details.|
|04:00|**Power State (PS):**This field indicates the new power state into which the controller is requested to<br>transition. This power state shall be one supported by the controller as indicated in the Number of Power<br>States Supported (NPSS) field in the Identify Controller data structure. If the power state specified is not<br>supported, the controller shall abort the command and should return an error of Invalid Field in<br>Command.|


**Figure 389: Power Management – Completion Queue Entry Dword 0**



|Bits|Description|
|---|---|
|31:08|Reserved|
|07:05|**Workload Hint (WH):** This field indicates the type of workload. Refer to section 8.1.17.3 for more details.|
|04:00|**Power State (PS):** This field indicates the current power state of the controller, or the power state into<br>which the controller is transitioning.|


**5.1.25.1.3** **Temperature Threshold (Feature Identifier 04h)**


A controller may report up to nine temperature values in the SMART / Health Information log page (i.e., the
Composite Temperature and Temperature Sensor 1 through Temperature Sensor 8; refer to Figure 207).
Associated with each implemented temperature sensor is an over temperature threshold and an under
temperature threshold. When a temperature is greater than or equal to its corresponding over temperature
threshold or less than or equal to its corresponding under temperature threshold, then the Temperature
Threshold Condition (TTC) bit is set to ‘1’ of the Critical Warning field in the SMART / Health Information
log page (refer to section 5.1.12.1.3). This may trigger an asynchronous event.


371


NVM Express [®] Base Specification, Revision 2.2


The over temperature threshold feature shall be implemented for Composite Temperature. The under
temperature threshold Feature shall be implemented for Composite Temperature if a non-zero Warning
Composite Temperature Threshold (WCTEMP) field value is reported in the Identify Controller data
structure (refer to Figure 313). The over temperature threshold and under temperature threshold features
shall be implemented for all implemented temperature sensors (i.e., all Temperature Sensor fields that
report a non-zero value).


The default value of the over temperature threshold feature for Composite Temperature is the value in the
WCTEMP field in the Identify Controller data structure if the value of the WCTEMP field is non-zero;
otherwise, the default value is implementation specific. The default value of the under temperature threshold
feature for Composite Temperature is implementation specific. The default value of the over temperature
threshold for all implemented temperature sensors is FFFFh. The default value of the under temperature
threshold for all implemented temperature sensors is 0h.


If a Get Features command is submitted for this Feature, the temperature threshold selected by Command
Dword 11 is returned in Dword 0 of the completion queue entry for that command.


**Temperature Threshold Hysteresis**


This feature allows the host to specify the temperature hysteresis that a controller shall use to determine
the end of a temperature threshold event.


If the controller supports the use of the Temperature Threshold Hysteresis feature as indicated by at nonzero value of the TMPTHMH field (refer to Figure 313), then the controller shall:


  - support this feature for the Composite Temperature value (refer to Figure 390); and

  - support the Temperature Threshold Hysteresis Recovery event (refer to Figure 313).


If hysteresis is supported for Threshold Temperature Select values other than Composite Temperature (i.e.,
0h) (refer to Figure 390); then, associated with each implemented temperature sensor is an overtemperature threshold and an under-temperature threshold with a hysteresis value. If the host specifies
hysteresis for a Threshold Temperature Select that is not supported, the controller shall abort the command
with a status of Invalid Field in Command.


An over-temperature threshold hysteresis event begins when the value of a temperature field (refer to the
temperature values reported as described in section 5.1.25.1.3) transitions from less than its corresponding
temperature threshold to greater than or equal to that temperature threshold. That over-temperature
threshold hysteresis event ends when the value of that temperature field transitions from greater than or
equal to that temperature threshold to less than that temperature threshold minus the value of the
Temperature Threshold Hysteresis (TMPTHH) field.


An under-temperature threshold hysteresis event begins when the value of a temperature field transitions
from greater than its corresponding temperature threshold to less than or equal to that temperature
threshold. That under-temperature threshold hysteresis event ends when the value of that temperature field
transitions from less than or equal to that temperature threshold to greater than that temperature threshold
plus the value of the Temperature Threshold Hysteresis (TMPTHH) field.


When a temperature threshold hysteresis event has started, the Temperature Threshold Condition (TTC)
is set to ‘1’ of the Critical Warning field in the SMART / Health Information log page (refer to section
5.1.12.1.3) is set to ‘1’. This may trigger an initial asynchronous event.


At the end of a temperature threshold hysteresis event, a Temperature Threshold Hysteresis Recovery
event shall be triggered (refer to Figure 392), the TTC bit (refer to section 5.1.12.1.3) shall be cleared to ’0’
and the Warning Composite Temperature Time field shall stop accumulating the number of minutes.


If the value of the Temperature Threshold Hysteresis field is larger than the value supported by the controller
as specified by the TMPTHMH field in Figure 313, the controller shall abort the command with a status code
of Invalid Field in Command.


372


NVM Express [®] Base Specification, Revision 2.2


**Figure 390: Temperature Threshold – Command Dword 11**






|Value|Definition|
|---|---|
|00b|Over Temperature Threshold|
|01b|Under Temperature Threshold|
|10b to 11b|Reserved|


|Value|Definition|
|---|---|
|0h|Composite Temperature|
|1h|Temperature Sensor 1|
|2h|Temperature Sensor 2|
|3h|Temperature Sensor 3|
|4h|Temperature Sensor 4|
|5h|Temperature Sensor 5|
|6h|Temperature Sensor 6|
|7h|Temperature Sensor 7|
|8h|Temperature Sensor 8|
|9h to Eh|Reserved|
|Fh|All implemented temperature sensors in a Set Features<br>command. Reserved in a Get Features command.|



|Bits|Description|
|---|---|
|31:25|Reserved|
|24:22|**Temperature Threshold Hysteresis (TMPTHH)**: This field indicates the temperature hysteresis (i.e.,<br>the number of kelvins the controller uses to determine the end of the over temperature or under<br>temperature event). If this field is cleared to 000b, then the hysteresis as defined for this Feature does<br>not apply.<br>If the Temperature Threshold Maximum Hysteresis (TMPTHMH) field in Figure 313 is cleared to 0h, this<br>field shall be cleared to 000b.|
|21:20|**Threshold Type Select (THSEL):**This field selects the threshold type that is modified by a Set Features<br>command and whose threshold value is returned by a Get Features command.<br>**Value**<br>**Definition**<br>00b<br>Over Temperature Threshold<br>01b<br>Under Temperature Threshold<br>10b to 11b<br>Reserved|
|19:16|**Threshold Temperature Select (TMPSEL):** This field selects the temperature whose threshold is<br>modified by a Set Features command and whose threshold value is returned by a Get Features<br>command.<br>**Value**<br>**Definition**<br>0h<br>Composite Temperature<br>1h<br>Temperature Sensor 1<br>2h<br>Temperature Sensor 2<br>3h<br>Temperature Sensor 3<br>4h<br>Temperature Sensor 4<br>5h<br>Temperature Sensor 5<br>6h<br>Temperature Sensor 6<br>7h<br>Temperature Sensor 7<br>8h<br>Temperature Sensor 8<br>9h to Eh<br>Reserved<br>Fh<br>All implemented temperature sensors in a Set Features<br>command. Reserved in a Get Features command.|
|15:00|**Temperature Threshold (TMPTH):**Indicates the threshold value for the temperature sensor and<br>threshold type specified in Kelvins.|


**5.1.25.1.4** **Volatile Write Cache (Feature Identifier 06h)**


This Feature controls the volatile write cache, if present, on the controller. If a volatile write cache is present
(refer to the VWC field in Figure 313), then this Feature shall be supported. The attributes are specified in
Command Dword 11.


Note: If the controller is able to guarantee that data present in a write cache is written to non-volatile storage
media on loss of power, then that write cache is considered non-volatile and this Feature does not apply to
that write cache.


If a Get Features command is submitted for this Feature, the attributes specified in Figure 391 are returned
in Dword 0 of the completion queue entry for that command.


If a volatile write cache is not present, then a Set Features command specifying the Volatile Write Cache
feature identifier shall abort with a status code of Invalid Field in Command, and a Get Features command
specifying the Volatile Write Cache feature identifier shall abort with a status code of Invalid Field in
Command.


If a volatile write cache is present and the volatile write cache is disabled (i.e., the WCE bit is cleared to
‘0’), then the user data written by any command to a namespace shall be persistent. Refer to the Volatile
Write Cache Presence field contained in the Common Namespace Features field in Figure 320.


373


NVM Express [®] Base Specification, Revision 2.2


**Figure 391: Volatile Write Cache – Command Dword 11**

|Bits|Description|
|---|---|
|31:01|Reserved|
|00|**Volatile Write Cache Enable (WCE):**If this bit is set to ‘1’, then the volatile write cache is enabled. If<br>this bit is cleared to ‘0’, then the volatile write cache is disabled.|



**5.1.25.1.5** **Asynchronous Event Configuration (Feature Identifier 0Bh)**


This Feature controls the events that trigger an asynchronous event notification to the host. This Feature
may be used to disable reporting events by the controller in the case of a persistent condition (refer to
section 5.1.2). If the condition for an event is true when the corresponding notice is enabled, then an event
is sent to the host. The attributes are specified in Command Dword 11.


If a Get Features command is submitted for this Feature, the attributes specified in Figure 392 are returned
in Dword 0 of the completion queue entry for that command.


**Figure 392: Asynchronous Event Configuration – Command Dword 11**











|Bits|Description|
|---|---|
|**Fabrics Specific**|**Fabrics Specific**|
|31|**Discovery Log Page Change Notification (DLPCN):** This bit indicates that the Discovery controller<br>reports Discovery Log Page Change Notifications. If this bit is set to ‘1’, then the Discovery controller<br>shall send a notification if Discovery log page changes occur.|
|30|**Host Discovery Log Page Change Notification (HDLPCN):** This bit indicates that the Discovery<br>controller reports Host Discovery Log Page Change Notifications. If this bit is set to ‘1’, then the<br>Discovery controller shall send a notification if Host Discovery log page changes occur**. **|
|29|**AVE Discovery Log Page Change Notification (ADLPCN):**This bit indicates that the Discovery<br>controller reports AVE Discovery Log Page Change Notifications. If this bit is set to ‘1’, then the<br>Discovery controller shall send a notification if AVE Discovery log page changes occur.|
|28|**Pull Model DDC Request Log Page Change Notification (PMDRLPCN):** This bit indicates that the<br>Discovery controller reports Pull Model DDC Request log page Change Notifications. If this bit is set<br>to ‘1’, then the Discovery controller shall send a notification if Pull Model DDC Request log page<br>changes occur.|
|**Non-Fabrics Specific**|**Non-Fabrics Specific**|
|27|**Zone Descriptor Changed Notices2 (ZDCN):**I/O Command Set specific definition.|
|26:20|Reserved|
|19|**Allocated Namespace Attribute Notices (ANSAN):** This bit determines whether an asynchronous<br>event notification is sent to the host for an Allocated Namespace Attribute Changed asynchronous<br>event (refer to Figure 152). If this bit is set to ‘1’, then the Allocated Namespace Attribute Changed<br>asynchronous event is sent to the host when this condition occurs. If this bit is cleared to ‘0’, then the<br>controller shall not send the Allocated Namespace Attribute Changed asynchronous event to the host.|
|18|**Reachability Group (RGRP0):** This bit determines whether an asynchronous event notification is sent<br>to the host when a Reachability Group change occurs (i.e., the contents of the Reachability Groups<br>log page (refer to section 5.1.12.1.25) changed). If this bit is set to ‘1’, then the Reachability Group<br>Change Notices event is sent to the host when this condition occurs. If this bit is cleared to ‘0’, then<br>the controller shall not send the Reachability Group Change Notices event to the host.|
|17|**Reachability Association (RASSN):** This bit determines whether an asynchronous event notification<br>is sent to the host when a Reachability Association change occurs (i.e., the contents of the Reachability<br>Associations log page (refer to section 5.1.12.1.26) changed). If this bit is set to ‘1’, then the<br>Reachability Association Change Notices event is sent to the host when this condition occurs. If this<br>bit is cleared to ‘0’, then the controller shall not send the Reachability Association Change Notices<br>event to the host.|
|16|**Temperature Threshold Hysteresis Recovery (TTHRY):** This bit determines whether an<br>asynchronous event notification is sent to the host at the end of a temperature threshold hysteresis<br>event (refer to section 5.1.25.1.3.1). If this bit is set to ‘1’, then the Temperature Threshold Hysteresis<br>Recovery event is sent to the host if an outstanding Asynchronous Event Request command exists at<br>the time this condition occurs. If this bit is cleared to ‘0’, then the controller shall not send the<br>Temperature Threshold Hysteresis Recovery event to the host.|


374


NVM Express [®] Base Specification, Revision 2.2


**Figure 392: Asynchronous Event Configuration – Command Dword 11**













|Bits|Description|
|---|---|
|15|**Normal NVM Subsystem Shutdown (NNSSHDN):** This bit determines whether an asynchronous<br>event notification is sent to the host when the NVM subsystem has started performing a normal<br>shutdown due to an NVM Subsystem Shutdown (refer to Figure 154). If this bit is set to ‘1’, then the<br>Normal NVM Subsystem Shutdown event is sent to the host if an outstanding Asynchronous Event<br>Request command exists at the time this condition occurs. If this bit is cleared to ‘0’, then the controller<br>shall not send the Normal NVM Subsystem Shutdown event to the host.|
|14|**Endurance Group Event Aggregate Log Change Notices (EGEALCN):** This bit determines whether<br>an asynchronous event notification is sent to the host when an event entry for an Endurance Group<br>(refer to section 3.2.3) has been added to the Endurance Group Event Aggregate log (refer to section<br>5.1.12.1.15). If this bit is set to ‘1’, then the Endurance Group Event Aggregate Log Change event is<br>sent to the host when this condition occurs. If this bit is cleared to ‘0’, then the controller shall not send<br>the Endurance Group Event Aggregate Log Change event to the host.<br>If Endurance Groups are not supported and this bit is set to ‘1’, then the Set Features command shall<br>be aborted with a status of Invalid Field in Command.|
|13|**LBA Status Information Alert Notices**1** (LSIAN):** I/O Command Set specific definition.|
|12|**Predictable Latency Event Aggregate Log Change Notices (PLEALCN):** This bit determines<br>whether an asynchronous event notification is sent to the host when an event pending entry for an<br>NVM Set (refer to section 5.1.12.1.12) has been added to the Predictable Latency Event Aggregate<br>Log. If this bit is set to ‘1’, then the Predictable Latency Event Aggregate Log Change event is sent to<br>the host when this condition occurs. If this bit is cleared to ‘0’, then the controller shall not send the<br>Predictable Latency Event Aggregate Log Change event to the host.|
|11|**Asymmetric Namespace Access Change Notices (ANACN):** This bit determines whether an<br>asynchronous event notification is sent to the host when an asymmetric namespace access change<br>occurs (i.e., the contents of the Asymmetric Namespace Access log page (refer to section 5.1.12.1.13)<br>change). If this bit is set to ‘1’, then the Asymmetric Namespace Access Change Notices event is sent<br>to the host when this condition occurs. If this bit is cleared to ‘0’, then the controller shall not send the<br>Asymmetric Namespace Access Change Notices event to the host.|
|10|**Telemetry Log Notices (TLN):**This bit determines whether an asynchronous event notification is sent<br>to the host when the Telemetry Controller-Initiated Data Available field transitions from 0h to 1h in the<br>Telemetry Controller-Initiated log page. If this bit is set to ‘1’, then the Telemetry Log Changed event<br>is sent to the host when this condition occurs. If this bit is cleared to ‘0’, then the controller shall not<br>send the Telemetry Log Changed event to the host.|
|09|**Firmware Activation Notices (FAN):** This bit determines whether an asynchronous event notification<br>is sent to the host for a Firmware Activation Starting event (refer to Figure 152). If this bit is set to ‘1’,<br>then the Firmware Activation Starting event is sent to the host when this condition occurs. If this bit is<br>cleared to ‘0’, then the controller shall not send the Firmware Activation Starting event to the host.|
|08|**Attached Namespace Attribute Notices (NAN):** This bit determines whether an asynchronous event<br>notification is sent to the host for an Attached Namespace Attribute Changed asynchronous event<br>(refer to Figure 152). If this bit is set to ‘1’, then the Attached Namespace Attribute Changed<br>asynchronous event is sent to the host when this condition occurs. If this bit is cleared to ‘0’, then the<br>controller shall not send the Attached Namespace Attribute Changed asynchronous event to the host.|
|07:00|**SMART / Health Critical Warnings (SHCW):**This field determines whether an asynchronous event<br>notification is sent to the host for the corresponding Critical Warning specified in the SMART / Health<br>Information log (refer to Figure 207). If a bit is set to ‘1’, then an asynchronous event notification is<br>sent when the corresponding critical warning bit is set to ‘1’ in the SMART / Health Information log. If<br>a bit is cleared to ‘0’, then an asynchronous event notification is not sent when the corresponding<br>critical warning bit is set to ‘1’ in the SMART / Health Information log.|
|Notes:<br>1.<br>Refer to the NVM Command Set Specification.<br>2.<br>Refer to the Zoned Namespace Command Set Specification.|Notes:<br>1.<br>Refer to the NVM Command Set Specification.<br>2.<br>Refer to the Zoned Namespace Command Set Specification.|


**5.1.25.1.6** **Autonomous Power State Transition (Feature Identifier 0Ch)**


This Feature configures the settings for autonomous controller power state transitions, refer to section
8.1.17.2.


375


NVM Express [®] Base Specification, Revision 2.2


The Autonomous Power State Transition uses Command Dword 11 and specifies the attribute information
in the data structure indicated in Figure 393 and the Autonomous Power State Transition data structure
consisting of 32 of the entries defined in Figure 394.


If a Get Features command is issued for this Feature, the attributes specified in Figure 393 are returned in
Dword 0 of the completion queue entry and the Autonomous Power State Transition data structure, whose
entry structure is defined in Figure 394, is returned in the data buffer for that command.


**Figure 393: Autonomous Power State Transition – Command Dword 11**






|Bits|Description|
|---|---|
|31:01|Reserved|
|00|**Autonomous Power State Transition Enable (APSTE):**This bit specifies whether autonomous power<br>state transition is enabled. If this bit is set to ‘1’, then autonomous power state transitions are enabled. If<br>this bit is cleared to ‘0’, then autonomous power state transitions are disabled. This bit is cleared to ‘0’<br>by default.|



Each entry in the Autonomous Power State Transition data structure is defined in Figure 394. Each entry
is 64 bits in size. There is an entry for each of the allowable 32 power states. For power states that are not
supported, the unused Autonomous Power State Transition data structure entries shall be cleared to all
zeroes. The entries begin with power state 0 and then increase sequentially (i.e., power state 0 is described
in bytes 7:0, power state 1 is described in bytes 15:8, etc.). The data structure is 256 bytes in size and shall
be physically contiguous.


**Figure 394: Autonomous Power State Transition – Data Structure Entry**







|Bits|Description|
|---|---|
|63:32|Reserved|
|31:08|**Idle Time Prior to Transition (ITPT):** This field specifies the amount of idle time that occurs in this power<br>state prior to transitioning to the Idle Transition Power State. The time is specified in milliseconds. A<br>value of 0h disables the autonomous power state transition feature for this power state.|
|07:03|**Idle Transition Power State (ITPS):**This field specifies the power state to which the controller<br>autonomously transitions, after there is a continuous period of idle time in the current power state that<br>exceeds the time specified in the Idle Time Prior to Transition (ITPT) field. If the ITPT field is set to a<br>non-zero value, then the state specified in this field shall be a non-operational state as described in<br>Figure 314. This field should not specify a power state with higher reported idle power than the current<br>power state. If the ITPT field is cleared to 0h, then this field should be cleared to 0h.|
|02:00|Reserved|


The Autonomous Power State Transition feature may interact with the Non-Operational Power State Config
feature (refer to section 5.1.25.1.10). Figure 395 shows these interactions.


**Figure 395: Interactions between APSTE and NOPPME**

|1<br>APSTE|2<br>NOPPME|Non-operational power state entry|Background operations during<br>non-operational power states|
|---|---|---|---|
|1|1|Entered by host request3 or by ITPT idle timer4|Allowed|
|0|1|Entered by host request3|Allowed|
|1|0|Entered by host request3 or by ITPT idle timer4|Not allowed|
|0|0|Entered by host request3|Not allowed|
|Notes:<br>1.<br>Defined in Figure 393.<br>2.<br>Defined in Figure 400.<br>3.<br>Refer to section 5.1.25.1.2.<br>4.<br>Refer to Figure 394.|Notes:<br>1.<br>Defined in Figure 393.<br>2.<br>Defined in Figure 400.<br>3.<br>Refer to section 5.1.25.1.2.<br>4.<br>Refer to Figure 394.|Notes:<br>1.<br>Defined in Figure 393.<br>2.<br>Defined in Figure 400.<br>3.<br>Refer to section 5.1.25.1.2.<br>4.<br>Refer to Figure 394.|Notes:<br>1.<br>Defined in Figure 393.<br>2.<br>Defined in Figure 400.<br>3.<br>Refer to section 5.1.25.1.2.<br>4.<br>Refer to Figure 394.|



376


NVM Express [®] Base Specification, Revision 2.2


**5.1.25.1.7** **Timestamp (Feature Identifier 0Eh)**


This Feature enables the host to set a timestamp value in the controller. A controller indicates support for
the Timestamp feature through the Optional NVM Command Support (ONCS) field in the Identify Controller
data structure. The Timestamp field value (refer to Figure 396) in a Set Features command sets a timestamp
value in the controller. After the current value for this Feature is set, the controller updates that value as
time passes. A Get Features command that requests the current value reports the timestamp value in the
controller at the time the Get Features command is processed (e.g., the value set with a Set Features
command for the current value plus the elapsed time since being set).


Note: If the Timestamp feature is saveable (refer to Figure 196) and the host saves a value, then the
timestamp value restored after a subsequent power on or reset event is the value that was saved (refer to
section 4.4). As a result, the timestamp may appear to move backwards in time.


The accuracy of a Timestamp value after initialization may be affected by vendor specific factors, such as
whether the controller continuously counts after the timestamp is initialized, or whether the controller stops
counting during certain intervals (e.g., non-operational power states). If the controller stops counting during
such intervals, then the Synch bit in the Timestamp – Data Structure for Get Features (refer to Figure 397)
shall be set to ‘1’.


If the controller maintains (i.e., continues to update) the timestamp value across any type of Controller Level
Reset (e.g., across a Controller Reset), then the controller shall also preserve the Timestamp Origin field
(refer to Figure 397) across that type of Controller Level Reset.


If the controller does not maintain the value of the timestamp across the most recent Controller Level Reset,
then the Timestamp field is cleared to 0h due to that Controller Level Reset.


Timestamp values should not be used for security applications. Other application use of the Timestamp
feature is outside the scope of this specification.
If a Set Features command is issued for this Feature, the data structure specified in Figure 396 is transferred
in the data buffer for that command, specifying the Timestamp value.


**Figure 396: Timestamp – Data Structure for Set Features**

|Bytes|Description|
|---|---|
|05:00|**Timestamp (TSTMP):** Number of milliseconds that have elapsed since midnight, 01-Jan-1970, UTC. Refer<br>to ISO 8601 for format requirements.|
|07:06|Reserved|



If a Get Features command is issued for this Feature, the data structure specified in Figure 397 is returned
in the data buffer for that command.


**Figure 397: Timestamp – Data Structure for Get Features**





|Bytes|Description|
|---|---|
|05:00|**Timestamp (TSTMP):** <br>If the Timestamp Origin field cleared to 000b, then this field is set to the time in milliseconds since the last<br>Controller Level Reset.<br>If the Timestamp Origin field is set to 001b, then this field is set to the last Timestamp value set by the host, plus<br>the time in milliseconds since the Timestamp was set. If the sum of the Timestamp value set by the host and the<br>elapsed time exceeds 2^48, the value returned should be reduced modulo 2^48.<br>If the Synch bit is set to ‘1’, then the Timestamp value may be reduced by vendor specific time intervals not<br>counted by the controller.|


377


NVM Express [®] Base Specification, Revision 2.2


**Figure 397: Timestamp – Data Structure for Get Features**








|Value|Definition|
|---|---|
|000b|The Timestamp field was initialized to 0h by a Controller Level Reset.|
|001b|The Timestamp field was initialized with a Timestamp value using a Set<br>Features command.|
|010b to 111b|Reserved|



|Bytes|Description|
|---|---|
|06|**Timestamp Attribute (TSTMPS):** This field indicates attributes associated with the timestamp.<br>**Bits**<br>**Description**<br>07:04<br>Reserved<br>03:01<br>**Timestamp Origin (TSTMPO):**<br>**Value**<br>**Definition**<br>000b<br>The Timestamp field was initialized to 0h by a Controller Level Reset.<br>001b<br>The Timestamp field was initialized with a Timestamp value using a Set<br>Features command.<br>010b to 111b<br>Reserved<br> <br>00<br>**Synch (SYNC):**<br>**Value**<br>**Definition**<br>0b<br>The controller counted time in milliseconds continuously since the Timestamp value<br>was initialized.<br>1b<br>The controller may have stopped counting during vendor specific intervals after the<br>Timestamp value was initialized (e.g., non-operational power states).|
|07|Reserved|


|Bits|Description|
|---|---|
|07:04|Reserved|
|03:01|**Timestamp Origin (TSTMPO):**<br>**Value**<br>**Definition**<br>000b<br>The Timestamp field was initialized to 0h by a Controller Level Reset.<br>001b<br>The Timestamp field was initialized with a Timestamp value using a Set<br>Features command.<br>010b to 111b<br>Reserved<br>|
|00|**Synch (SYNC):**<br>**Value**<br>**Definition**<br>0b<br>The controller counted time in milliseconds continuously since the Timestamp value<br>was initialized.<br>1b<br>The controller may have stopped counting during vendor specific intervals after the<br>Timestamp value was initialized (e.g., non-operational power states).|


|Value|Definition|
|---|---|
|0b|The controller counted time in milliseconds continuously since the Timestamp value<br>was initialized.|
|1b|The controller may have stopped counting during vendor specific intervals after the<br>Timestamp value was initialized (e.g., non-operational power states).|


**5.1.25.1.8** **Keep Alive Timer (Feature Identifier 0Fh)**


This Feature configures the controller Keep Alive Timer. Refer to section 3.9 for Keep Alive details. The
attributes are specified in Command Dword 11.


If a Get Features command is submitted for this Feature, the attributes specified in Figure 398 are returned
in Dword 0 of the completion queue entry for that command.


**Figure 398: Keep Alive Timer – Command Dword 11**






|Bits|Description|
|---|---|
|31:00|**Keep Alive Timeout (KATO):**This field specifies the timeout value for the Keep Alive Timer feature in<br>milliseconds. The controller rounds up the value specified to the granularity indicated in the KAS field in<br>the Identify Controller data structure. If this field is cleared to 0h, then the Keep Alive Timer is disabled.<br>The default value for this field is 0h for NVMe transports that do not require use of the Keep Alive Timer<br>feature (e.g., NVMe over PCIe). For NVMe transports that require use of the Keep Alive Timer feature<br>(e.g., RDMA and TCP), the default value for this field is 1D4C0h (i.e., 120,000 milliseconds or 2 minutes)<br>rounded up to the granularity indicated in the KAS field.<br>Refer to the applicable NVMe Transport Binding specification for details.|



**5.1.25.1.9** **Host Controlled Thermal Management (Feature Identifier 10h)**


This Feature configures the controller settings for the host controlled thermal management feature, refer to
section 8.1.17.5. The host controlled thermal management feature uses Command Dword 11 with the
attributes shown in Figure 399.


If a Get Features command is submitted for this Feature, then the attributes shown in Figure 399 are
returned in Dword 0 of the completion queue entry for that command.


378


NVM Express [®] Base Specification, Revision 2.2


**Figure 399: HCTM – Command Dword 11**






|Bits|Description|
|---|---|
|31:16|**Thermal Management Temperature 1 (TMT1):** This field specifies the temperature, in Kelvins, when<br>the controller begins to transition to lower power active power states or performs vendor specific thermal<br>management actions while minimizing the impact on performance (e.g., light throttling) in order to attempt<br>to reduce the Composite Temperature.<br>A value cleared to 0h, specifies that this part of the Feature shall be disabled.<br>The range of values that are supported by the controller are indicated in the Minimum Thermal<br>Management Temperature field and Maximum Thermal Management Temperature field in the Identify<br>Controller data structure in Figure 313.<br>If the host attempts to set this field to a value less than the value contained in the Minimum Thermal<br>Management Temperature field or greater than the value contained in the Maximum Thermal<br>Management Temperature field in the Identify Controller data structure in Figure 313, then the command<br>shall abort with a status code of Invalid Field in Command.<br>If the host attempts to set this field to a value greater than or equal to the value contained in the Thermal<br>Management Temperature 2 field, if non-zero, then the command shall abort with a status code of Invalid<br>Field in Command.|
|15:00|**Thermal Management Temperature 2 (TMT2):** This field specifies the temperature, in Kelvins, when<br>the controller begins to transition to lower power active power states or perform vendor specific thermal<br>management actions regardless of the impact on performance (e.g., heavy throttling) in order to attempt<br>to reduce the Composite Temperature.<br>A value cleared to 0h, specifies that this part of the Feature shall be disabled.<br>The range of values that are supported by the controller are indicated in the Minimum Thermal<br>Management Temperature field and Maximum Thermal Management Temperature field in the Identify<br>Controller data structure in Figure 313.<br>If the host attempts to set this field to a value less than the value contained in the Minimum Thermal<br>Management Temperature field or greater than the value contained in the Maximum Thermal<br>Management Temperature field in the Identify Controller data structure in Figure 313, then the command<br>shall abort with a status code of Invalid Field in Command.<br>If the host attempts to set this field to a non-zero value less than or equal to the value contained in the<br>Thermal Management Temperature 1 field, then the command shall abort with a status code of Invalid<br>Field in Command.|



**5.1.25.1.10** **Non-Operational Power State Config (Feature Identifier 11h)**


This Feature configures non-operational power state settings for the controller. The settings are specified
in Command Dword 11.


If a Get Features command is submitted for this Feature, the values in Figure 400 are returned in Dword 0
of the completion queue entry for that command.


**Figure 400: Non-Operational Power State Config – Command Dword 11**

|Bits|Description|
|---|---|
|31:01|Reserved|



379


NVM Express [®] Base Specification, Revision 2.2


**Figure 400: Non-Operational Power State Config – Command Dword 11**






|Bits|Description|
|---|---|
|00|**Non-Operational Power State Permissive Mode Enable (NOPPME):**If this bit is set to ‘1’, then the<br>controller may temporarily exceed the power limits of any non-operational power state, up to the limits of<br>the last operational power state, to run controller-initiated background operations in that state (i.e., Non-<br>Operational Power State Permissive Mode is enabled). If this bit is cleared to ‘0’, then the controller shall<br>not exceed the limits of any non-operational state while running controller-initiated background<br>operations in that state (i.e., Non-Operational Power State Permissive Mode is disabled).<br>If Non-Operational Power State Permissive Mode is disabled, then:<br>a)<br>thermal management that requires power (e.g., cooling fans) may be disabled; and<br>b)<br>performance after resuming from the non-operational power state may be degraded until<br>background activity that was not allowed while in that non-operational power state has<br>completed.<br>If the host attempts to set this bit to ‘1’ and the controller does not support Non-Operational Power State<br>Permissive Mode as indicated in the Controller Attributes (CTRATT) field of the Identify Controller data<br>structure, then the controller shall abort the command with a status code of Invalid Field in Command.|



The Non-Operational Power State Config feature may interact with the Autonomous Power State Transition
feature (refer to section 5.1.25.1.6). Figure 395 shows these interactions.


**5.1.25.1.11** **Read Recovery Level Config (Feature Identifier 12h)**


This Feature is used to configure the Read Recovery Level (refer to section 8.1.20). The attributes are
specified in Command Dword 11 and Command Dword 12. Modifying the Read Recovery Level has no
effect on the data contained in any associated namespace.


The scope of this Feature is:


  - NVM Set if NVM Sets are supported; or

  - NVM Subsystem if NVM Sets are not supported.


If a Get Features command is submitted for this Feature, the attributes specified in Figure 402 are returned
in Dword 0 of the completion queue entry for that command.


**Figure 401: Read Recovery Level Config – Command Dword 11**

|Bits|Description|
|---|---|
|31:16|Reserved|
|15:00|**NVM Set Identifier (NVMSETID):** This field specifies the NVM Set to be modified. If NVM Sets are not<br>supported, then this field is ignored and the command applies to all namespaces in the NVM subsystem.|



**Figure 402: Read Recovery Level Config – Command Dword 12**

|Bits|Description|
|---|---|
|31:04|Reserved|
|03:00|**Read Recovery Level (RRL):** This field sets the Read Recovery Level for the NVM Set specified.|



**5.1.25.1.12** **Predictable Latency Mode Config (Feature Identifier 13h)**


This Feature configures an NVM Set to use Predictable Latency Mode, including warning event thresholds.
Predictable Latency Mode and events are disabled by default. The attributes are specified in Command
Dword 11, Command Dword 12, and the Deterministic Threshold Configuration data structure.


The NVM Set has transitioned to Predictable Latency Mode when the controller completes a Set Features
command successfully with the Predictable Latency Enable bit in Command Dword 12 set to ‘1’. A transition
to the Predictable Latency Mode may be delayed (i.e., the Set Features command completion is delayed)
if the NVM subsystem needs to perform background operations on the NVM in order to operate in


380


NVM Express [®] Base Specification, Revision 2.2


Predictable Latency Mode. Upon successful completion of this command, the controller shall be in the NonDeterministic Window.


If a Get Features command is submitted for this Feature, the attributes specified in Figure 404 are returned
in Dword 0 of the completion queue entry for that command and the Deterministic Threshold Configuration
data structure is returned.


**Figure 403: Predictable Latency Mode Config – Command Dword 11**

|Bits|Description|
|---|---|
|31:16|Reserved|
|15:00|**NVM Set Identifier (NVMSETID):** This field specifies the NVM Set to be modified.|



**Figure 404: Predictable Latency Mode Config – Command Dword 12**






|Bits|Description|
|---|---|
|31:01|Reserved|
|00|**Predictable Latency Enable (LPE):** If this bit is set to ‘1’, then Predictable Latency Mode (refer to section<br>8.1.18) is enabled for the NVM Set specified. If this bit is cleared to ‘0’, then Predictable Latency Mode<br>is disabled for the NVM Set specified.|



Predictable Latency Events (refer to section 5.1.12.1.12) are configured as described in Figure 405.


**Figure 405: Predictable Latency Mode – Deterministic Threshold Configuration Data Structure**








|Bits|Description|
|---|---|
|15|**Deterministic Excursion (DTE):**Autonomous transition from DTWIN to NDWIN due to<br>Deterministic Excursion.|
|14|**Exceeded Value (EXV):**Autonomous transition from DTWIN to NDWIN due to typical or<br>maximum value exceeded.|
|13:03|Reserved|
|02|**DTWIN Time Warning (DTTW)**|
|01|**DTWIN Writes Warning (DTWW)**|
|00|**DTWIN Reads Warning (DTRW)**|







|Bytes|Description|
|---|---|
|01:00|**Enable Event (ENEV):** This field specifies whether an entry shall be added to the Predictable Latency<br>Event Aggregate log page for the associated event. If a bit is set to ‘1’, then an entry shall be added if<br>the specified event occurs. If a bit is cleared to ‘0’, then an entry shall not be added if the specified event<br>occurs.<br>**Bits**<br>**Description**<br>15<br>**Deterministic Excursion (DTE):**Autonomous transition from DTWIN to NDWIN due to<br>Deterministic Excursion.<br>14<br>**Exceeded Value (EXV):**Autonomous transition from DTWIN to NDWIN due to typical or<br>maximum value exceeded.<br>13:03<br>Reserved<br>02<br>**DTWIN Time Warning (DTTW)**<br>01<br>**DTWIN Writes Warning (DTWW)**<br>00<br>**DTWIN Reads Warning (DTRW)**|
|31:02|Reserved|
|39:32|**DTWIN Reads Threshold (DTRT):** If the value of DTWIN Reads Estimate falls below this value and the<br>DTWIN Reads Warning is enabled, then the ‘DTWIN Reads Warning’ event is set in the Predictable<br>Latency Per NVM Set log page for the affected NVM Set.|
|47:40|**DTWIN Writes Threshold (DTWT):** If the value of DTWIN Writes Estimate falls below this value and the<br>DTWIN Writes Warning is enabled, then the ‘DTWIN Writes Warning’ event is set in the Predictable<br>Latency Per NVM Set log page for the affected NVM Set.|
|55:48|**DTWIN Time Threshold (DTTT):** If the value of DTWIN Time Estimate falls below this value and the<br>DTWIN Time Warning is enabled, then the ‘DTWIN Time Warning’ event is set in the Predictable Latency<br>Per NVM Set log page for the affected NVM Set.|
|511:56|Reserved|


**5.1.25.1.13** **Predictable Latency Mode Window (Feature Identifier 14h)**


This Feature is used to set the window for the specified NVM Set and its associated namespaces if the
NVM Set is configured in Predictable Latency Mode (refer to section 8.1.18). The attributes are specified in
Command Dword 11 and Command Dword 12. If Predictable Latency Mode is not enabled, then the
controller shall abort the command with a status code of Invalid Field in Command.


381


NVM Express [®] Base Specification, Revision 2.2


The transition to the window selected is complete when the Set Features command completes successfully.
A transition to the Deterministic Window may be delayed (i.e., the Set Features command completion is
delayed) if the minimum time has not been spent in the Non-Deterministic Window.


If a Get Features command is submitted for this Feature, the attributes specified in Figure 407 are returned
in Dword 0 of the completion queue entry for that command. If Predictable Latency Mode is not enabled,
then the controller shall abort the command with a status code of Invalid Field in Command.


**Figure 406: Predictable Latency Mode Window – Command Dword 11**

|Bits|Description|
|---|---|
|31:16|Reserved|
|15:00|**NVM Set Identifier (NVMSETID):** This field specifies the NVM Set to be modified.|



**Figure 407: Predictable Latency Mode Window – Command Dword 12**






|Bits|Description|
|---|---|
|31:03|Reserved|
|02:00|**Window Select (WSEL):** This field selects or indicates the window used by all namespaces in the NVM<br>Set.<br>**Value**<br>**Definition**<br>000b<br>Reserved<br>001b<br>Deterministic Window (DTWIN)<br>010b<br>Non-Deterministic Window (NDWIN)<br>011b to 111b<br>Reserved|


|Value|Definition|
|---|---|
|000b|Reserved|
|001b|Deterministic Window (DTWIN)|
|010b|Non-Deterministic Window (NDWIN)|
|011b to 111b|Reserved|



**5.1.25.1.14** **Host Behavior Support (Feature Identifier 16h)**


This Feature enables use of controller functionality that is associated with and depends upon specific host
behavior that may or may not be supported by all hosts. A controller does not use such functionality unless
the host has indicated that the host supports the specific host behavior upon which the functionality
depends. The host indicates that support to the controller by setting a field in this Feature. That host action
enables controller use of the associated functionality with that host. A controller shall not use functionality
with a host that has not indicated support for the associated specific host behavior upon which that controller
functionality depends. The attributes in Figure 408 are transferred in the data buffer.


For example, the Command Interrupted status code is associated with and depends upon the specific host
behavior that the host is expected to retry commands that are aborted with that status code. That command
retry behavior may or may not be supported by all hosts (e.g., hosts compliant with versions 1.3 and earlier
of the NVM Express Base Specification are unlikely to retry commands aborted with the Command
Interrupted status code as that status code was introduced after NVM Express Base Specification, Revision
1.3). A host that supports that command retry behavior indicates its support to the controller by setting a
field to 1h in the Host Behavior Support Feature. Setting that field to 1h enables controller use of the
Command Interrupted status code, with the result that this status code is used only with hosts that have
indicated support for the associated command retry behavior.


This Feature is not saveable (refer to Figure 196). The default value of this Feature shall be all bytes cleared
to 0h.


After a successful completion of a Set Features command for this Feature, the controller may use controllerto-host functionality that depends on specific host behavior as indicated by the attributes. If multiple Set
Features commands for this Feature are processed by the controller, only information from the most recent
successful command is retained (i.e., subsequent commands replace information provided by previous
commands).


If a Get Features command is submitted for this Feature, the attributes specified in Figure 408 are returned
in the data buffer for that command.


382


NVM Express [®] Base Specification, Revision 2.2


**Figure 408: Host Behavior Support – Data Structure**





|Bytes|Description|
|---|---|
|00|**Advanced Command Retry Enable (ACRE):** If this bit is set to 1h, then the Command Interrupted status<br>code is enabled (refer to Figure 102) and command retry delays are enabled. The controller may use the<br>Command Interrupted status code and may indicate a command retry delay by setting the Command<br>Retry Delay (CRD) field to a non-zero value in the Status field of a completion queue entry, refer to Figure<br>100. A host that sets this field to 1h indicates host support for the command retry behaviors that are<br>specified for both the Command Interrupted status code and non-zero values in the CRD field.<br>If this bit is cleared to 0h, then both the Command Interrupted status code and command retry delays<br>are disabled. The controller shall not use the Command Interrupted status code, and shall clear the CRD<br>field to 0h in all CQEs.<br>All values other than 0h and 1h are reserved.|
|01|**Extended Telemetry Data Area 4 Supported (ETDAS):**If this bit is set to 1h, then Telemetry Host-<br>Initiated Data Area 4 and Telemetry Controller-Initiated Data Area 4 are supported by the host. If the<br>Data Area 4 Support (DA4S) bit is set to ‘1’ of the Log Page Attributes field, then the controller may<br>populate Telemetry Host-Initiated Data Area 4 (refer to section 5.1.12.1.8) and the Telemetry Controller-<br>Initiated Data Area 4 (refer to section 5.1.12.1.9).<br>If this field is cleared to 0h, then Telemetry Host-Initiated Data Area 4 and Telemetry Controller-Initiated<br>Data Area 4 are not supported by the host.<br>All values other than 0h and 1h are reserved.|
|02|**LBA Format Extension Enable (LBAFEE):**I/O Command Set specific definition. Refer to the applicable<br>I/O Command Set specification for details. <br>All values other than 0h and 1h are reserved.|
|03|**Host Dispersed Namespace Support (HDISNS):** If this bit is set to 1h, then dispersed namespaces are<br>enabled. A host that sets this field to 1h specifies that globally unique namespace identifiers (refer to<br>section 8.1.9.2) are used for identifying namespaces (e.g., multi-path I/O software does not use the NSID<br>of a namespace as the sole method for detection of multiple paths to that namespace).<br>A host that supports reservations (refer to section 8.1.22) and sets this field to 1h specifies a Host<br>Identifier that is unique across all hosts that connect to any participating NVM subsystem.<br>If this bit is cleared to 0h, then dispersed namespaces are disabled. If the participating NVM subsystem<br>prohibits host access to dispersed namespaces (refer to section 8.1.9.4) when this field is cleared to 0h,<br>then the controller aborts any I/O commands (refer to section 7 in this specification and the I/O<br>Commands section in the appropriate I/O Command Set specification) or any of the Admin commands<br>listed in Figure 616 that the host submits to dispersed namespaces with a status code of Host Dispersed<br>Namespace Support Not Enabled, as described in section 8.1.9.4.<br>All values other than 0h and 1h are reserved.|


383


NVM Express [®] Base Specification, Revision 2.2


**Figure 408: Host Behavior Support – Data Structure**









|Bytes|Description|
|---|---|
|05:04|**Copy Descriptor Formats Enable (CDFE):**The bits in this field that are used (i.e., are neither reserved<br>nor unused) enable the corresponding Copy Descriptor Formats (e.g., the Copy Descriptor Format 2h<br>Enable (CDF2E) bit enables Copy Descriptor Format 2h). Bits in this field that this specification defines<br>as unused (i.e., bits 1:0) correspond to Copy Descriptor Formats (refer to the NVM Command Set<br>Specification) that are always enabled if they are supported.<br>**Bits**<br>**Description**<br>15:5<br>Reserved<br>4 <br>**Copy Descriptor Format 4h Enable (CDF4E):** If this bit is set to ‘1’ and the controller<br>supports Copy Descriptor Format 4h, then Copy Descriptor Format 4h is enabled. If this bit is<br>cleared to ‘0’, or the controller does not support Copy Descriptor Format 4h, then Copy<br>Descriptor Format 4h is disabled.<br>3 <br>**Copy Descriptor Format 3h Enable (CDF3E):** If this bit is set to ‘1’ and the controller<br>supports Copy Descriptor Format 3h, then Copy Descriptor Format 3h is enabled. If this bit is<br>cleared to ‘0’, or the controller does not support Copy Descriptor Format 3h, then Copy<br>Descriptor Format 3h is disabled.<br>2 <br>**Copy Descriptor Format 2h Enable (CDF2E):** If this bit is set to ‘1’ and the controller<br>supports Copy Descriptor Format 2h, then Copy Descriptor Format 2h is enabled. If this bit is<br>cleared to ‘0’, or the controller does not support Copy Descriptor Format 2h, then Copy<br>Descriptor Format 2h is disabled.<br>1:0<br>**Not Used (NUSED):** The controller shall ignore these bits when processing a Set Features<br>command that specifies this Feature and shall clear these bits to ‘0’ in the attributes returned<br>in the data buffer for a Get Features command that specifies this Feature.|
|511:06|Reserved|


|Bits|Description|
|---|---|
|15:5|Reserved|
|4|**Copy Descriptor Format 4h Enable (CDF4E):** If this bit is set to ‘1’ and the controller<br>supports Copy Descriptor Format 4h, then Copy Descriptor Format 4h is enabled. If this bit is<br>cleared to ‘0’, or the controller does not support Copy Descriptor Format 4h, then Copy<br>Descriptor Format 4h is disabled.|
|3|**Copy Descriptor Format 3h Enable (CDF3E):** If this bit is set to ‘1’ and the controller<br>supports Copy Descriptor Format 3h, then Copy Descriptor Format 3h is enabled. If this bit is<br>cleared to ‘0’, or the controller does not support Copy Descriptor Format 3h, then Copy<br>Descriptor Format 3h is disabled.|
|2|**Copy Descriptor Format 2h Enable (CDF2E):** If this bit is set to ‘1’ and the controller<br>supports Copy Descriptor Format 2h, then Copy Descriptor Format 2h is enabled. If this bit is<br>cleared to ‘0’, or the controller does not support Copy Descriptor Format 2h, then Copy<br>Descriptor Format 2h is disabled.|
|1:0|**Not Used (NUSED):** The controller shall ignore these bits when processing a Set Features<br>command that specifies this Feature and shall clear these bits to ‘0’ in the attributes returned<br>in the data buffer for a Get Features command that specifies this Feature.|


**5.1.25.1.15** **Sanitize Config (Feature Identifier 17h)**


This Feature controls behavior of the Sanitize command and sanitize operations. The scope of this Feature
is the NVM subsystem.


The attributes are specified in Command Dword 11.


If a Get Features command is submitted for this Feature, the attributes specified in Figure 409 are returned
in Dword 0 of the completion queue entry for that command.


If this Feature is not saveable (refer to Figure 196), then the default value of the NODRM attribute shall be
cleared to ‘0’ (i.e., No-Deallocate Error Response Mode).


If the capabilities of the Sanitize Config Feature Identifier are both changeable and saveable (refer to
section 4.4), then the host is able to configure this Feature when initially provisioning a device.


**Figure 409: Sanitize Config – Command Dword 11**





|Bits|Description|
|---|---|
|31:01|Reserved|
|00|**No-Deallocate Response Mode (NODRM):**If the No-Deallocate Inhibited bit) is set to ‘1’ in the Sanitize<br>Capabilities field of the Identify Controller data structure (refer to Figure 313), then this bit defines the<br>response of the controller to a Sanitize command processed with the No-Deallocate After Sanitize<br>(NDAS) bit set to ‘1’ (refer to Figure 373).<br>If this bit is set to ‘1’ (i.e., No-Deallocate Warning Response Mode), then the controller shall process<br>such Sanitize commands, and if the resulting sanitize operation is completed successfully, then the SOS<br>field shall be set to 100b (i.e., Sanitized Unexpected Deallocate) in the Sanitize Status log page (refer to<br>Figure 292).<br>If this bit is cleared to ‘0’ (i.e., No-Deallocate Error Response Mode), then the controller shall abort such<br>Sanitize commands with a status code of Invalid Field in Command.<br>If the No-Deallocate Inhibited bit in the Sanitize Capabilities field of the Identify Controller data structure<br>(refer to Figure 313) is cleared to ‘0’, then this bit has no effect.|


384


NVM Express [®] Base Specification, Revision 2.2


**5.1.25.1.16** **Endurance Group Event Configuration (Feature Identifier 18h)**


This Feature controls the events that trigger adding an Endurance Group Event Aggregate Log Change
Notices event to the Endurance Group Event Aggregate log for the specified Endurance Group. This
Feature may be used to disable reporting events in the case of a persistent condition (refer to section 5.1.2).
If the condition for an event is true when the corresponding notice is enabled, then an event is sent to the
host. The attributes are specified in Command Dword 11.


If a Get Features command is submitted for this Feature, the Endurance Group Critical Warnings field in
Command Dword 11 is not used and the attributes specified in Figure 410 are returned in Dword 0 of the
completion queue entry for that command.


**Figure 410: Asynchronous Event Configuration – Command Dword 11**






|Bits|Description|
|---|---|
|31:24|Reserved|
|23:16|**Endurance Group Critical Warnings (EGCW):** This field determines whether an event entry for an<br>Endurance Group (refer to section 3.2.3) is added to the Endurance Group Event Aggregate log page<br>(refer to section 5.1.12.1.15) for the corresponding Critical Warning specified in the Endurance Group<br>Information log page (refer to Figure 219). If a bit is set to ‘1’, then an entry is added when the<br>corresponding critical warning bit is set to ‘1’ in the Endurance Group Information log page. If a bit is<br>cleared to ‘0’, then an entry is not added when the corresponding critical warning bit is set to ‘1’ in the<br>Endurance Group Information log page.|
|15:00|**Endurance Group Identifier (ENDGID):** This field indicates the Endurance Group for which<br>asynchronous events are being configured. If this field is cleared to 0h, then the Endurance Group Critical<br>Warnings field is not used.|



If a bit is set to ‘1’ in the Endurance Group Critical Warnings field which corresponds to a reserved bit in the
Critical Warning field of the Endurance Group Information log page (refer to Figure 219), then the Set
Features command shall be aborted with a status code of Invalid Field in Command.


If the Endurance Group Identifier specifies an Endurance Group that does not exist, then the Set Features
or Get Features command shall be aborted with a status code of Invalid Field in Command.


**5.1.25.1.17** **I/O Command Set Profile (Feature Identifier 19h)**


This Feature specifies the I/O Command Sets that may be used by the controller when all supported I/O
Command Sets (110b) are selected in CC.CSS. This Feature shall be implemented if the CAP.CSS.IOCSS
bit is set to ‘1’. When CC.CSS is set to any value other than 110b, then this Feature has no effect and the
I/O Command Sets that may be used by the controller are specified by CC.CSS. If CC.CSS is set to any
value other than 110b and the controller receives a Set Features command for this Feature, then this
command has no effect and returns a status code of Successful Completion.


When all supported I/O Command Sets (110b) is selected in CC.CSS, the value of this Feature specifies
the index of the I/O Command Set Combination in the Identify I/O Command Set data structure that is used.
Refer to section 5.1.13.2.19 for more information. The Index is specified in the I/O Command Set
Combination Index field of Command Dword 11 (refer to Figure 411). If any namespace attached to the
controller uses an I/O Command Set that is not supported by the specified I/O Command Set combination,
then the controller shall abort the command with a status code of I/O Command Set Combination Rejected.
Upon successful completion of a Set Features command for this Feature, the controller transitions to using
the specified I/O Command Set Combination.


**Figure 411: I/O Command Set Profile – Command Dword 11**

|Bits|Description|
|---|---|
|31:09|Reserved|



385


NVM Express [®] Base Specification, Revision 2.2


**Figure 411: I/O Command Set Profile – Command Dword 11**






|Bits|Description|
|---|---|
|08:00|**I/O Command Set Combination Index (IOCSCI):**This field specifies the index of the I/O Command Set<br>Combination that is to be used. This field is used for the Set Features command only and is ignored for<br>the Get Features command for this Feature.<br>The controller shall abort a command that specifies an index that corresponds to an I/O Command Set<br>Combination that has a value of 0h with a status code of I/O Command Set Combination Rejected.|



If a Get Features command is submitted for this Feature, then the attributes described in Figure 412 are
returned in Dword 0 of the completion queue entry for that command.


**Figure 412: I/O Command Set Profile – Completion Queue Entry Dword 0**

|Bits|Description|
|---|---|
|31:09|Reserved|
|08:00|**I/O Command Set Combination Index (IOCSCI):**This field returns the index of the currently selected<br>I/O Command Set Combination.|



**5.1.25.1.18** **Spinup Control (Feature Identifier 1Ah)**


This Feature allows the host to configure the method for initial spinup for Endurance Groups that store data
on rotational media (refer to section 8.1.23).


If the NVM subsystem does not contain any Endurance Groups that store data on rotational media, then
the controller shall abort the Set Features command and the Get Features command for this Feature with

status code of Invalid Field in Command.


The method is specified in Command Dword 11 (refer to Figure 413).


**Figure 413: Spinup Control – Command Dword 11**

|Bits|Description|
|---|---|
|31:01|Reserved|
|0|**Spinup Control Enable (SCE):** If this bit is set to ‘1’, then the Spinup Control feature is enabled. If this<br>bit is cleared to ‘0’, then the Spinup Control feature is disabled. The setting is persistent.|



If a Get Features command is submitted for this Feature, the attributes described in (refer to Figure 414)
are returned in Dword 0 of the completion queue entry for that command.


**Figure 414: Completion Queue Entry Dword 0**

|Bits|Description|
|---|---|
|31:01|Reserved|
|0|**Spinup Control State (SCS):**If this bit is set to ‘1’, then the Spinup Control feature is enabled. If this bit<br>is cleared to ‘0’, then the Spinup Control feature is disabled.|



**5.1.25.1.19** **Power Loss Signaling Config (Feature Identifier 1Bh)**


This Feature configures the behavior of Power Loss Signaling (refer to section 8.2.5). The scope of this
Feature is as described in Figure 386. The attributes are specified in Command Dword 11 (refer to Figure
415).


If a Get Features command is successfully completed for this Feature, then the attribute described in Figure
415 is returned in Dword 0 of the completion queue entry for that command.


If a Set Features command is submitted for this Feature and the Power Loss Signaling Mode field specifies
a Power Loss Signaling mode that is not supported (refer to the Power Loss Signaling Information field in
Figure 313), then that command shall be aborted with a status code of Invalid Field in Command.


386


NVM Express [®] Base Specification, Revision 2.2


If a Set Features command is processed while the controller is in the FQ Processing state, then that
command is aborted as described in section 8.2.5.2.


**Figure 415: Power Loss Signaling Config – Command Dword 11**






|Bits|Description|
|---|---|
|31:02|Reserved|
|01:00|**Power Loss Signaling Mode (PLSM):**Specifies the Power Loss Signaling mode of operation.<br>**Value**<br>**Definition**<br>00b<br>Power Loss Signaling not enabled<br>01b<br>Power Loss Signaling with Emergency Power Fail enabled<br>10b<br>Power Loss Signaling with Forced Quiescence enabled<br>11b<br>Reserved|


|Value|Definition|
|---|---|
|00b|Power Loss Signaling not enabled|
|01b|Power Loss Signaling with Emergency Power Fail enabled|
|10b|Power Loss Signaling with Forced Quiescence enabled|
|11b|Reserved|



**5.1.25.1.20** **Flexible Data Placement (Feature Identifier 1Dh)**


This Feature controls operation of the Flexible Data Placement capability (refer to section 8.1.10) in the
specified Endurance Group (refer to Figure 416).


The attribute is specified in Command Dword 12. Effects of enabling and disabling the Flexible Data
Placement are described in section 8.1.10.


If a Get Features command specifying this Feature is successfully completed, then the attributes described
in Figure 417 are returned in Dword 0 of the completion queue entry for that command.


**Figure 416: Flexible Data Placement – Command Dword 11**

|Bits|Description|
|---|---|
|31:16|Reserved|
|15:00|**Endurance Group Identifier (ENDGID):**If Endurance Groups are supported, then this field specifies<br>the identifier for the Endurance Group (refer to section 3.2.3) used for this Feature.|



**Figure 417: Flexible Data Placement – Command Dword 12**






|Bits|Description|
|---|---|
|31:16|Reserved|
|15:08|**Flexible Data Placement Configuration Index (FDPCIDX):** This field specifies the index into the FDP<br>Configuration Descriptor List (refer to Figure 280) identifying a valid FDP configuration to be applied to<br>the Endurance Group when Flexible Data Placement is enabled (refer to section 8.1.10).|
|07:01|Reserved|
|00|**Flexible Data Placement Enable (FDPE):** This bit specifies if the Flexible Data Placement (i.e.,<br>capability) is enabled or disabled. If this bit is set to ‘1’, then Flexible Data Placement is enabled. If this<br>bit is cleared to ‘0’, then Flexible Data Placement is disabled.|



This Feature shall be saveable (refer to section 4.4). The default value of this Feature shall be 0h.


The value of this Feature is only allowed to change if the SV bit is set to ‘1’ in the Set Features command.
Therefore, if the Save and Select Feature Support (SSFS) bit is set to ‘1’ in the ONCS field in the Identify
Controller data structure (refer to Figure 313) and the SV bit is cleared to ’0’, then the controller shall abort
the command with a status code of Invalid Field in Command.


If the value of this Feature changes, then the controller is allowed to modify any fields associated with
specifying any User Data Format information accessible using the Identify command (i.e., any field
associated with the Format Index (refer to section 1.6.2) that includes CNS values 00h, 05h, 08h, 09h,
0Ah). The host should issue Identify commands in this condition to access the values that may have been
modified.


387


NVM Express [®] Base Specification, Revision 2.2


**5.1.25.1.21** **Flexible Data Placement Events (Feature Identifier 1Eh)**


This Feature controls if a controller generates Flexible Data Placement (FDP) events associated with a
specific Reclaim Unit Handle. The Reclaim Unit Handle is the Reclaim Unit Handle associated with the
specified Placement Handle for the specified namespace. For a Set Features command, the data buffer
contains the list of FDP Event Types that are to be enabled or disabled as defined in Figure 421.


The attribute is specified in Command Dword 12. Effects of enabling and disabling FDP events on the
Reclaim Unit Handles are described in section 8.1.10.


If Flexible Data Placement is disabled, then the controller shall abort any Set Feature command or Get
Feature command specifying this Feature with a status code of FDP Disabled.


If the NSID field is set to FFFFFFFFh, then the controller shall abort the command with a status code of
Invalid Field in Command.


If a Get Features command specifying this Feature is successfully completed, then the attributes for the
supported list of FDP Event Types described in Figure 422 is returned in the data buffer and Dword 0 of
the completion queue entry contains the value of NOET (i.e., the number of supported FDP Event Types
that are contained in the data buffer). Completion queue entry Dword 0 is defined in Figure 418. The
supported list of FDP Event Types shall be listed in ascending order of FDP Event Type.


**Figure 418: FDP Events – Completion Queue Entry Dword 0**

|Bits|Description|
|---|---|
|31:08|Reserved|
|07:00|**Number of FDP Event Types (NOET)**: This field specifies the number of FDP Event Types that are<br>contained in the data buffer (refer to Figure 421).|



**Figure 419: FDP Events – Command Dword 11**





|Bits|Description|
|---|---|
|31:24|Reserved|
|23:16|**Number of FDP Event Types (NOET):** This field specifies the number of FDP Event Types that are<br>contained in the data buffer (refer to Figure 421).<br>This field is ignored by the controller on a Get Features command.|
|15:00|**Placement Handle (PHNDL):** This field specifies the Placement Handle associated with the Reclaim<br>Unit Handle affected by this command.<br>If the specified Placement Handle is not valid for the namespace, then the controller shall abort a Set<br>Feature command or a Get Feature command with a status code of Invalid Field in Command.|


**Figure 420: Flexible Data Placement – Command Dword 12**








|Bits|Description|
|---|---|
|31:01|Reserved|
|00|**FDP Event Enable (FDPEE):**If this bit is set to ‘1’, then FDP events are enabled on the Reclaim Unit<br>Handle associated with the Placement Handle. If this bit is cleared to ‘0’, then FDP events are disabled<br>on the Reclaim Unit Handle associated with the Placement Handle.<br>This field is ignored by the controller on a Get Features command.|



This Feature shall be saveable (refer to section 4.4).


If:


  - a Reclaim Unit Handle is shared by more than one namespace that exists in the same Endurance
Group; and

  - a Set Features command specifies this Feature and one of those namespaces,


388


NVM Express [®] Base Specification, Revision 2.2


then a modification to this Feature occurs to that shared Reclaim Unit Handle and the Placement Handle

that is associated with the shared Reclaim Unit Handle.


**Figure 421: FDP Events – Set Feature Data Structure**

|Bytes|Description|
|---|---|
|**FDP Event Type List**|**FDP Event Type List**|
|00|**FDP Event Type 0:** This field contains the first FDP Event Type (refer to Figure 290).|
|01|**FDP Event Type 1:** This field contains the second FDP Event Type.|
|…|…|
|NOET-1|**FDP Event Type NOET-1:** This field contains the last FDP Event Type.|



**Figure 422: FDP Events – Get Feature Data Structure**





|Bytes|Description|
|---|---|
|**Supported FDP Event Type List**|**Supported FDP Event Type List**|
|01:00|**Supported FDP Event Type 0:** This field contains the Supported FDP Event Descriptor for the<br>first Supported FDP Event Type.|
|03:02|**Supported FDP Event Type 1:** This field contains the Supported FDP Event Descriptor for the<br>second Supported FDP Event Type.|
|…|…|
|(NOET-1)*2+1:<br>(NOET-1)*2|**Supported FDP Event Type NOET-1:** This field contains the Supported FDP Event Descriptor<br>for the last Supported FDP Event Type.|


**Figure 423: Supported FDP Event Descriptor**








|Bytes|Description|
|---|---|
|00|**FDP Event Type (FDPET):** This field contains the FDP Event Type (refer to Figure 290).|
|01|**FDP Event Type Attributes (FDPETA):** This field contains attributes for the FDP Event Type.<br>**Bits**<br>**Description**<br>07:01<br>Reserved<br>00<br>**FDP Event Enable (FDPEE):** If this bit is set to ‘1’ then this FDP Event Type is enabled. If<br>this bit is cleared to ‘0’, then this FDP Event Type is disabled.|


|Bits|Description|
|---|---|
|07:01|Reserved|
|00|**FDP Event Enable (FDPEE):** If this bit is set to ‘1’ then this FDP Event Type is enabled. If<br>this bit is cleared to ‘0’, then this FDP Event Type is disabled.|



**5.1.25.1.22** **Namespace Admin Label (Feature Identifier 1Fh)**


The Namespace Admin Label feature provides the ability to set and get the Namespace Admin Label for a
namespace. This Feature shall be saveable and therefore shall not be supported if the Save and Select
Feature Support (SSFS) bit is cleared to ‘0’ in the Optional NVM Command Support (ONCS) field of the
Identify Controller data structure (refer to Figure 313). The attributes in Figure 424 are transferred in the
data buffer.


The saved value and current value of this Feature shall be identical. If the SV bit is cleared to ‘0’ in a Set
Features command that specifies this Feature, the controller shall abort the command with a status code
of Invalid Field in the Command. If the value of the Namespace Admin Label is changed by means outside
the scope of this standard, then that change shall affect the results of any subsequent Get Features
command that specifies this Feature.


The default value of this Feature is all nulls (i.e., all bytes cleared to 0h). Sanitize operations (refer to section
8.1.24) affect the values of this Feature; any successful sanitize operation shall modify this Feature by
resetting both the saved value and the current value to the default value.


If a Get Features command is submitted for this Feature, the attributes specified in Figure 424 are returned
in the data buffer for that command.


389


NVM Express [®] Base Specification, Revision 2.2


**Figure 424: Namespace Admin Label – Data Structure**








|Bytes|Description|
|---|---|
|255:0|**Namespace Admin Label (NSAL):** This field contains the Namespace Admin Label for the namespace<br>as a null-terminated UTF-8 string. A Namespace Admin Label is intended to assist a human administrator<br>in identifying a namespace (e.g., based on the contents of the data stored in the namespace (e.g., “Q4<br>2018 Financial Records”) or the application intended to use the namespace (e.g., “CRM data”)).|



**5.1.25.1.23** **Controller Data Queue (Feature Identifier 21h)**


This Feature allows a host to update the status of the head pointer of a Controller Data Queue (CDQ) and
specify the configuration of a Controller Data Queue Tail event. The CDQ is specified by the Controller
Data Queue Identifier (CDQID) field in Command Dword 11 (refer to Figure 425).


The Head Pointer field specifies the current slot of the head pointer in the queue (refer to section 8.1.6).
The controller uses this value to determine if CDQ entries have been freed by the host.


If the Enable Tail Pointer Trigger (ETPT) bit is set to ‘1’, then when the slot specified by the Tail Pointer
Trigger (TPT) field for the specified CDQ is posted with an entry, the controller shall generate a Controller
Data Queue Tail Pointer event to the host (refer to section 8.1.6).


If the Set Features command is successful and there is a pending Controller Data Queue Tail Pointer event
for the specified Controller Data Queue specified by the CDQID field, then the controller shall clear that
pending event.


A controller should report Controller Data Queue Tail Pointer events in the order of occurrence to avoid
reporting the same Controller Data Queue when a Controller Data Queue Tail Pointer event for that
Controller Data Queue is being repeatedly triggered.


If the Enable Tail Pointer Trigger (ETPT) bit is set to ‘1’ in the current value of this Feature (refer to section
4.4) and the controller processes a Set Features command for this Feature that specifies:


   - the Enable Tail Pointer Trigger (ETPT) bit set to ‘1’; and

   - a slot in the Tail Pointer Trigger (TPT) field,


then prior to posting the completion for that Set Features command, the controller may post an entry into
the specified CDQ in the slot specified by the value of the TPT field that had been set prior to processing
that Set Features command. To detect this condition, after receiving the completion of that Set Features
command, a host should examine the CDQ to determine if the requested tail pointer trigger has already
occurred. If the requested tail pointer trigger has occurred, then a subsequent Set Features command
should be submitted by the host to disable the Tail Pointer Trigger event or request a different tail pointer
trigger.


If a Get Features command is submitted for this Feature, the attributes described in Figure 425 are returned
in Dword 0 and the attributes described in Figure 427 are returned in the data buffer for that command.


**Figure 425: Controller Data Queue – Command Dword 11**







|Bits|Description|
|---|---|
|31|**Enable Tail Pointer Trigger (ETPT):** If this bit is set to ‘1’, then the controller is to generate a Controller<br>Data Queue Tail Pointer event when that controller posts the entry into the slot specified by the TPT field<br>for the specified CDQ. If this bit is cleared to ‘0’, then there is no request for a Controller Data Queue Tail<br>Pointer event to be sent by the controller.<br>If a Controller Data Queue Tail Pointer event is generated for the specified Controller Data Queue, then<br>the current value of this bit for this Feature shall be cleared to ’0’ (i.e., the current value for this bit only<br>enables a single occurrence of a Controller Data Queue Tail Pointer event for the specified Controller<br>Data Queue).<br>For a Get Features command, this field shall be ignored by the controller.|
|30:16|Reserved|
|15:00|**Controller Data Queue Identifier (CDQID):** This field contains the identifier associated with the CDQ.|


390


NVM Express [®] Base Specification, Revision 2.2


**Figure 426: Controller Data Queue – Command Dword 12**

|Bits|Description|
|---|---|
|31:00|**Head Pointer (HP):** This field specifies the slot of the head pointer for the specified CDQ.|



**Figure 427: Controller Data Queue – Command Dword 13**






|Bits|Description|
|---|---|
|31:00|**Tail Pointer Trigger (TPT):** If the ETPT bit is set to ‘1’, then this field specifies a slot in the CDQ that when<br>posted with an entry causes the controller to issue a Controller Data Queue Tail Pointer event.<br>For a Set Features command, if the ETPT bit is cleared to ‘0’, then this field shall be ignored by the controller.<br>For a Get Features command, this field shall be ignored by the controller.|



If the CDQ is empty (refer to section 3.3.1.4) and the Head Pointer field specifies a value that is not the
same value as the current value, then the controller shall abort the command with a status code of Invalid
Field in Command.


If the CDQ is not empty and the Head Pointer field specifies a slot not associated with an entry that was
posted by the controller within the specified CDQ, then the controller shall abort the command with a status
code of Invalid Field in Command.


If the Enable Tail Pointer Trigger bit is set to ‘1’ and the Tail Pointer Trigger field specifies a slot not
associated with an entry within the specified CDQ, then the controller shall abort the command with a
status code of Invalid Field in Command.


If the value in the Controller Data Queue Identifier field specifies a CDQ that does not exist in the controller
processing the command, then the controller shall abort the command with a status code of Invalid
Controller Data Queue.


**Figure 428: Controller Data Queue – Data Structure**







|Bytes|Description|
|---|---|
|03:00|**Head Pointer (HP):** This field indicates the slot of the head pointer for the specified CDQ.|
|07:04|**Tail Pointer Trigger (TPT):** If the ETPT bit is set to ‘1’, then this field indicates the slot in the CDQ that<br>when posted with an entry causes the controller to issue a Controller Data Queue Tail Pointer event.<br>If the ETPT bit is cleared to ‘0’, then this field shall be cleared to 0h and should be ignored by the host.|
|511:08|Reserved|


**5.1.25.1.24** **Embedded Management Controller Address (Feature Identifier 78h)**


This Feature configures a URI (refer to RFC 3986) containing the address of a management agent provided
by the system (e.g., a Management Controller (refer to the NVM Express Management Interface
Specification) or an enclosure manager) for management of the NVM subsystem.


If a Set Features command is issued for this Feature, the data structure specified in Figure 429 is transferred
in the data buffer for that command.


If a Get Features command is issued for this Feature, the data structure specified in Figure 429 is returned
in the data buffer for that command.


**Figure 429: Set Features – Command Specific Status Values**

|Bytes|Description|
|---|---|
|03:00|Reserved|
|511:04|**Embedded Management Controller Address (EMCA):**A URI (refer to RFC 3986), containing the<br>address of a management agent provided by the system.|



391


NVM Express [®] Base Specification, Revision 2.2


The Command and Feature Lockdown log page (refer to section 5.1.12.1.20), if supported, should indicate
that this Feature is supported to be prohibited from execution.


**5.1.25.1.25** **Host Management Agent Address (Feature Identifier 79h)**


This Feature configures a URI (refer to RFC 3986) containing the address of a management agent provided
by host software for management of the NVM subsystem.


If a Set Features command is issued for this Feature, the data structure specified in Figure 430 is transferred
in the data buffer for that command.


If a Get Features command is issued for this Feature, the data structure specified in Figure 430 is returned
in the data buffer for that command.


**Figure 430: Host Management Agent Address**

|Bytes|Description|
|---|---|
|03:00|Reserved|
|511:04|**Host Management Agent Address (HMAA):**A URI (refer to RFC 3986), containing the address of a<br>management agent residing in host software.|



The Command and Feature Lockdown log page (refer to section 5.1.12.1.20), if supported, should indicate
that this Feature is supported to be prohibited from execution.


**5.1.25.1.26** **Host Metadata (Feature Identifier 7Dh), (Feature Identifier 7Eh), (Feature Identifier 7Fh)**


The Host Metadata features are the Enhanced Controller Metadata feature (Feature Identifier 7Dh), the
Controller Metadata feature (Feature Identifier 7Eh), and the Namespace Metadata feature (Feature
Identifier 7Fh).


If a Get Features command specifying one of the Host Metadata features with the SEL field set to 011b
(i.e., Supported Capabilities) is submitted, then the Saveable bit in Dword 0 of the corresponding completion
queue entry shall be cleared to ‘0’ (i.e., refer to section 4.4), and the Changeable bit in Dword 0 of the
corresponding completion queue entry shall be set to ‘1’.


If a Get Features command specifying one of the Host Metadata features, the controller shall perform
additional actions specified in Figure 431.


**Figure 431: Get Features – Command Dword 11**

|Bits|Description|
|---|---|
|31:01|Reserved|



392


NVM Express [®] Base Specification, Revision 2.2


**Figure 431: Get Features – Command Dword 11**






|Bits|Description|
|---|---|
|00|**Generate Default Host Metadata (GDHM):** If this bit is set to ‘1’, then the controller shall modify the default<br>value of the specified Host Metadata feature by creating and returning a number of vendor specific strings<br>for the Element Types of the specified Host Metadata feature. The number of vendor specific strings created<br>and returned is implementation specific. The controller is allowed to return:<br>• <br>no vendor specific strings;<br>• <br>vendor specific strings created for a subset of the defined Element Types of the specified Host<br>Metadata feature; or<br>• <br>vendor specific strings created for each of the defined Element Types of the specified Host<br>Metadata feature.<br>These vendor specific strings replace the Metadata Element Descriptors in the default Host Metadata data<br>structure returned by the specified Host Metadata feature, when a Get Features command for a Host<br>Metadata feature with the SEL field set to 001b (i.e., Default) is submitted, until a Controller Level Reset<br>occurs (i.e., the replacement default values are not persistent across a Controller Level Reset).<br>If this bit is cleared to ‘0’, then the controller shall not modify the default value of the specified Host Metadata<br>feature.<br>If this bit is cleared to ‘0’ and a Get Features command for a Host Metadata feature with the SEL field set to<br>001b (i.e., Default) is submitted, then the controller shall return the currently existing modified default value,<br>if any, for that Host Metadata feature (i.e., the updated default value that was created by the last Get<br>Features command, with the GDHM bit set to ‘1’, that completed successfully since the last Controller Level<br>Reset).|



The host issues a Set Features command specifying one of the Host Metadata features containing a Host
Metadata data structure (refer to Figure 433). The host receives a Host Metadata data structure via the Get
Features command. The content of the strings in the Host Metadata data structure are vendor specific.


If any Get Features command specifying the GDHM bit set to ‘1’ returned a status code of Successful
Completion since the last Controller Level Reset, then for any subsequent Get Features command that
specifies a SEL field set to 001b (i.e., Default) and specifies a Host Metadata feature, the controller shall
return the replaced default value containing the most recent vendor specific strings for that Host Metadata
feature.


The Action is specified in Command Dword 11 as shown in Figure 432.


**Figure 432: Set Features – Command Dword 11**

|Bits|Description|
|---|---|
|31:15|Reserved|



393


NVM Express [®] Base Specification, Revision 2.2


**Figure 432: Set Features – Command Dword 11**


|Value|Definition|
|---|---|
|00b|Add or Replace Entry|
|01b|Delete Entry Multiple|
|10b|Add Entry Multiple|
|11b|Reserved|







|Bits|Description|
|---|---|
|14:13|**Element Action (EA):** This field specifies the action to perform on the specified Host Metadata Feature<br>value for each Metadata Element Descriptor data structure contained in the Host Metadata data<br>structure. <br>**Value**<br>**Definition**<br>00b<br>Add or Replace Entry<br>01b<br>Delete Entry Multiple<br>10b<br>Add Entry Multiple<br>11b<br>Reserved<br>If the Element Action field is cleared to 00b (Add/Replace Entry) and the Metadata Element Descriptor<br>with the specified Element Type (refer to Figure 434) does not exist in the specified Host Metadata<br>Feature value, then the Controller shall create the descriptor in the specified Host Metadata Feature<br>value with the value in the Host Metadata data structure.<br>If the Element Action field is cleared to 00b (Add/Replace Entry) and one Metadata Element Descriptor<br>with the specified Element Type exists in the specified Host Metadata Feature value, then the Controller<br>shall replace with the value in the specified Host Metadata data structure.<br>If the Element Action field is cleared to 00b (Add/Replace Entry) and the Feature Identifier field is set to<br>Enhanced Controller Metadata, then the controller shall abort the Set Features command with a status<br>code of Invalid Field in Command and shall not change any Host Metadata Feature value.<br>If the Element Action field is set to 01b (Delete Entry Multiple), then the Controller shall delete all the<br>specified Metadata Element Descriptors from the specified Host Metadata Feature value, if any. If none<br>of the specified Metadata Element Descriptors are present in the specified Host Metadata Feature value,<br>then the controller shall complete the Set Features command with a status code of Successful<br>Completion and shall not change any Host Metadata Feature value.<br>If the Element Action field is set to 10b (Add Entry Multiple), the Feature Identifier field is set to Enhanced<br>Controller Metadata, and no Metadata Element Descriptor with the specified Element Type exists in the<br>Enhanced Controller Metadata Feature value, then the controller shall create new Metadata Element<br>Descriptors in the Enhanced Controller Metadata Feature value with the Element Type and the value<br>specified in the Host Metadata data structure.<br>If the Element Action field is set to 10b (Add Entry Multiple), the Feature Identifier field is set to Enhanced<br>Controller Metadata, and one or more Metadata Element Descriptors with the specified Element Type<br>exists in the Enhanced Controller Metadata Feature value, then the controller shall add the specified<br>Metadata Element to the Enhanced Controller Metadata Feature value and shall not modify any existing<br>Metadata Element Descriptors.<br>If the Element Action field is set to 10b (Add Entry Multiple) and the Feature Identifier field is not set to<br>Enhanced Controller Metadata, then the controller shall abort the Set Features command with a status<br>code of Invalid Field in Command and shall not change the Host Metadata Feature value.|
|12:00|Reserved|


Metadata Element Descriptors may be added, replaced, or deleted based on the action specified in the
Element Action field. Modification of the Host Metadata Feature value shall be performed by the controller
in an atomic manner.


If a Set Features command is submitted for a Host Metadata Feature, a Host Metadata data structure,
defined in Figure 433, is transferred in the data buffer for the command. The Host Metadata data structure
is 4 KiB in size and contains zero or more Metadata Element Descriptors. If host software attempts to add
or replace a Metadata Element that causes the Host Metadata Feature value of the specified feature to
grow larger than 4 KiB, then the controller shall abort the command with a status code of Invalid Field in
Command.


If the host receives a Host Metadata data structure via the Get Features command, then all of the Metadata
Element Descriptors present for the specified feature are added to a Host Metadata data structure (refer to


394


NVM Express [®] Base Specification, Revision 2.2


Figure 433) and returned in the data buffer for that command. The data buffer size is equal to the size of
the Host Metadata data structure that is 4 KiB in size.


**Figure 433: Host Metadata Data Structure**

|Bytes|Description|
|---|---|
|**Header**|**Header**|
|00|**Number of Metadata Element Descriptors (NMED):**This field contains the number of Metadata<br>Element descriptors in the data structure.|
|01|Reserved|
|**Metadata Element Descriptor List**|**Metadata Element Descriptor List**|
|x:02|**Metadata Element Descriptor 0:** This field contains the first Metadata Element descriptor or 0h<br>if there are no entries.|
|y:x+1|**Metadata Element Descriptor 1:**This field contains the second Metadata Element descriptor or<br>0h if there is only 1 entry.|
|…|…|
|4095:z|**Metadata Element Descriptor N:** This field contains the last Metadata Element descriptor or 0h<br>if there are less than N+1 entries where N is the value of the NMED field.|



If the Feature Identifier field specifies Controller Metadata or Namespace Metadata, then the Host Metadata
data structure may contain at most one Metadata Element Descriptor of each Element Type. If the Feature
Identifier field specifies Enhanced Controller Metadata, then a Host Metadata data structure may contain
more than one Metadata Element Descriptor of each Element Type. Each Metadata Element Descriptor
contains the data structure shown in Figure 434.


**Figure 434: Metadata Element Descriptor**





|Bits|Description|
|---|---|
|31 + (Element<br>Length*8) :32|**Element Value (EVAL):** This field specifies the value for the element.|
|31:16|**Element Length (ELEN):**This field specifies the length of the Element Value field in bytes. This<br>field shall be cleared to 0h when deleting an entry (i.e., the EA field is set to 01b in Command<br>Dword 11). This field should be non-zero when adding/updating an entry (i.e., the EA field is<br>cleared to 00b). If this field is cleared to 0h when adding/updating an entry, then the controller<br>behavior is undefined.|
|15:12|Reserved|
|11:08|**Element Revision (ER):** This field specifies the revision of this element value. Unless specified<br>otherwise elsewhere in this specification, all Metadata Element Descriptors shall clear this field<br>to 0h.|
|07:05|Reserved|
|04:00|**Element Type (ET):** This field specifies the type of metadata stored in the descriptor.<br>**Value**<br>**Definition**<br>00h<br>Reserved<br>01h to 17h<br>Element Types defined by this specification. Enhanced Controller<br>Metadata Element and Controller Metadata Element types are defined in<br>Figure 435. Namespace Metadata Element types are defined in Figure 436.<br>18h to 1Fh<br>Vendor Specific|


|Value|Definition|
|---|---|
|00h|Reserved|
|01h to 17h|Element Types defined by this specification. Enhanced Controller<br>Metadata Element and Controller Metadata Element types are defined in<br>Figure 435. Namespace Metadata Element types are defined in Figure 436.|
|18h to 1Fh|Vendor Specific|


**Enhanced Controller Metadata (Feature Identifier 7Dh)**



This Feature is used to store enhanced controller metadata about the host platform for later retrieval.


The metadata element types defined in Figure 435 are used by this Feature.


**Figure 435: Controller Metadata Element Types**

|Value|Definition|
|---|---|
|00h|Reserved|



395


NVM Express [®] Base Specification, Revision 2.2


**Figure 435: Controller Metadata Element Types**

|Value|Definition|
|---|---|
|01h|**Operating System Controller Name:**The name of the controller in the operating system as a UTF-8<br>string.|
|02h|**Operating System Driver Name:**The name of the driver in the operating system as a UTF-8 string.|
|03h|**Operating System Driver Version:**The version of the driver in the operating system as a UTF-8<br>string.|
|04h|**Pre-boot Controller Name:**The name of the controller in the pre-boot environment as a UTF-8 string.|
|05h|**Pre-boot Driver Name:**The name of the driver in the pre-boot environment as a UTF-8 string.|
|06h|**Pre-boot Driver Version:**The version of the driver in the pre-boot environment as a UTF-8 string.|
|07h|**System Processor Model:** The model of the processor as a UTF-8 string.|
|08h|**Chipset Driver Name:** The chipset driver name as a UTF-8 string.|
|09h|**Chipset Driver Version:** The chipset driver version as a UTF-8 string.|
|0Ah|**Operating System Name and Build:** The operating system name and build as a UTF-8 string.|
|0Bh|**System Product Name:** The system product name as a UTF-8 string.|
|0Ch|**Firmware Version:** The host firmware (e.g., UEFI) version as a UTF-8 string.|
|0Dh|**Operating System Driver Filename:** The operating system driver filename as a UTF-8 string.|
|0Eh|**Display Driver Name:** The display driver name as a UTF-8 string.|
|0Fh|**Display Driver Version:** The display driver version as a UTF-8 string.|
|10h|**Host-Determined Failure Record:** A failure record (e.g., the reason the host has flagged a failure for<br>an NVMe Storage Device (refer to the NVM Express Management Interface Specification) FRU which<br>may be used for failure analysis) as a UTF-8 string.|
|11h to 17h|Reserved|
|18h to 1Fh|Vendor Specific|



Refer to section 5.1.25.1.26 for the definitions of Command Dword 11 and the Host Metadata data structure _._


The default value for the Number of Metadata Element Descriptors of the Enhanced Controller Metadata
Feature shall be 0h on a Controller Level Reset.


If a Get Features command with the SEL field set to 011b (i.e., Supported Capabilities) with the Enhanced
Controller Metadata Feature value is submitted, then the NS Specific bit in Dword 0 of the corresponding
completion queue entry shall be cleared to ‘0’.


**Controller Metadata (Feature Identifier 7Eh)**


This Feature is used to store controller metadata about the host platform for later retrieval.


The Controller Metadata Feature provides backward compatibility with Management Controllers (refer to
the NVM Express Management Interface Specification) compliant with version 1.1 and earlier versions of
the NVM Express Management Interface Specification.


If a controller supports both the Enhanced Controller Metadata Feature and the Controller Metadata
Feature, then the Controller Metadata Feature should not be used by the host.


The metadata element types defined in Figure 435 are used by this Feature.


Refer to section 5.1.25.1.26 for the definitions of Command Dword 11 and the Host Metadata data structure _._


If a Set Features command’s Element Action field of Command Dword 11 is set to 10b (Add Entry Multiple),
then the controller shall abort the command with a status code of Invalid Field in Command and shall not
change the Host Metadata Feature value.


The default value for the Number of Metadata Element Descriptors of the Controller Metadata Feature shall
be 0h on a Controller Level Reset.


If a Get Features command with the SEL field set to 011b (i.e., Supported Capabilities) with the Controller
Metadata Feature value is submitted, then the NS Specific bit in Dword 0 of the corresponding completion
queue entry shall be cleared to ‘0’.


396


NVM Express [®] Base Specification, Revision 2.2


**Namespace Metadata (Feature Identifier 7Fh)**


This Feature is used to store metadata about a namespace associated with a controller for later retrieval.
This Feature is namespace specific and controller specific. The Add Entry Multiple action is prohibited for
this Feature.


**Figure 436: Namespace Metadata Element Types**

|Value|Definition|
|---|---|
|00h|Reserved|
|01h|**Operating System Namespace Name:**The name of the namespace in the operating system as a<br>UTF-8 string.|
|02h|**Pre-boot Namespace Name:**The name of the namespace in the pre-boot environment as a UTF-8<br>string.|
|03h|**Operating System Namespace Name Qualifier 1:**The first qualifier of the Operating System<br>Namespace Name as a UTF-8 string.|
|04h|**Operating System Namespace Name Qualifier 2:**The second qualifier of the Operating System<br>Namespace Name as a UTF-8 string.|
|05h to 17h|Reserved|
|18h to 1Fh|Vendor Specific|



Refer to section 5.1.25.1.26 for the definitions of Command Dword 11 and the Host Metadata data structure _._


If a Get Features command with the SEL field set to 011b (i.e., Supported Capabilities) with the Namespace
Metadata Feature value is submitted, then the NS Specific bit in Dword 0 of the corresponding completion
queue entry shall be set to ‘1’.


**5.1.25.1.27** **Software Progress Marker (Feature Identifier 80h)**


This Feature is a controller software progress marker. The software progress marker is persistent across
power states. This information may be used to indicate to an OS software driver whether there have been
issues with the OS successfully loading. The attributes are specified in Command Dword 11.


If a Get Features command is submitted for this Feature, the attributes specified in Figure 437 are returned
in Dword 0 of the completion queue entry for that command.


**Figure 437: Software Progress Marker – Command Dword 11**






|Bits|Description|
|---|---|
|31:08|Reserved|
|07:00|**Pre-boot Software Load Count (PBSLC):**Indicates the load count of pre-boot software. After<br>successfully loading and initializing the controller, pre-boot software should set this field to one more<br>than the previous value of the Pre-boot Software Load Count. If the previous value is 255, then the value<br>should not be updated by pre-boot software (i.e., the value does not wrap to 0). OS driver software should<br>set this field to 0h after the OS has successfully been initialized.|



**5.1.25.1.28** **Host Identifier (Feature Identifier 81h)**


This Feature allows the host to register a Host Identifier with the controller. The Host Identifier is used by
the controller to determine whether other controllers in the NVM subsystem are associated with the same
host. The Host Identifier may be used to designate host elements that access an NVM subsystem
independently of each other or for reservations.


The Host Identifier is contained in the data structure indicated in Figure 439. The attributes are specified in
Command Dword 11. If a Get Features command is issued for this Feature, the data structure specified in
Figure 439 is returned in the data buffer for that command.


A Host Identifier value of 0h indicates that the host associated with the controller is not associated with any
other controller in the NVM subsystem. For example, two controllers in an NVM subsystem that both have
a Host Identifier value of 0h indicates that the controllers are associated with different hosts. NVMe over
PCIe implementations may support using a Host Identifier value of 0h for the reservations feature (refer to


397


NVM Express [®] Base Specification, Revision 2.2


section 8.1.22). However, reservations and registrations associated with a Host Identifier value of 0h do not
persist across a Controller Level Reset since a host that uses a Host Identifier value of 0h is treated as a
different host after a Controller Level Reset.


A Set Features command should be used to change a Host Identifier value of 0h to a non-zero value before
using streams (refer to section 8.1.8.3) or using reservations (refer to section 8.1.22). Information (i.e.,
streams or reservations) associated with a Host Identifier value of 0h retain the association to that Host
Identifier if the Host Identifier value is changed and are not associated with the host that has the non-zero
Host Identifier.


The NVM subsystem indicates if reservations are supported with a Host Identifier value of 0h with the RHII
bit in the Controller Attributes field of the Identify Controller data structure (refer to Figure 313). The NVM
subsystem indicates if streams are supported with a Host Identifier value of 0h with the SRNZID bit in the
NVM Subsystem Stream Capability field of the streams directive return parameters (refer to Figure 608).


The Host Identifier feature shall not be a saveable feature.


The requirements and use of the Host Identifier feature are dependent on whether the NVMe over PCIe
implementation or the NVMe over Fabrics implementation is supported. Refer to section 5.1.25.1.28.1 and
section 5.1.25.1.28.2.


**Figure 438: Host Identifier – Command Dword 11**

|Bits|Description|
|---|---|
|31:01|Reserved|
|00|**Enable Extended Host Identifier (EXHID):**If this bit is set to ‘1’, then the host is requesting the use of<br>an extended 128-bit Host Identifier. If this bit is cleared to ‘0’, then the host is requesting the use of a 64-<br>bit Host Identifier. NVMe over Fabrics implementations shall use an extended 128-bit Host Identifier.<br>If the controller does not support a 128-bit Host Identifier as indicated in the Controller Attributes field in<br>the Identify Controller data structure and the host sets this bit to ‘1’, then a status code of Invalid Field in<br>Command shall be returned.<br>If the controller does not support a 64-bit Host Identifier (e.g., the device is an NVMe over Fabrics device)<br>and the host clears this bit to ‘0’, then a status code of Invalid Field in Command shall be returned.<br>If the NVM subsystem supports a 64-bit Host Identifier, supports a 128-bit Host Identifier and detects<br>that another controller in the NVM subsystem is already using a non-zero Host Identifier of a different<br>size than the size requested in this command, then a status code of Host Identifier Inconsistent Format<br>shall be returned.|



**Figure 439: Host Identifier – Data Structure Entry**

|Bytes|Description|
|---|---|
|15:00|**Host Identifier (HOSTID):**This field specifies a 64-bit or 128-bit identifier that uniquely identifies the host<br>associated with the controller within the NVM subsystem. The host provides an 8 byte or 16 byte data<br>structure depending on the value specified in the Enable Extended Host Identifier bit. The value of the<br>Host Identifier used by a host, the method used to select this value, and the method used to ensure<br>uniqueness are outside the scope of this specification. Controllers in an NVM subsystem that have the<br>same Host Identifier are assumed to be associated with the same host and have the same reservation<br>and registration rights.<br>If the current Host Identifier value is cleared to 0h, then the current Host Identifier shall be set to the value<br>specified in this field.<br>If the current Host Identifier value is set to a non-zero value, then the controller shall abort the command<br>with a status code of Command Sequence Error.<br>A Host Identifier value of 0h indicates that the host is not associated with any other controller in the NVM<br>subsystem.|



398


NVM Express [®] Base Specification, Revision 2.2


**PCIe Transport Implementations**


The Host Identifier is an optional feature when implemented on a controller using a PCIe transport. The
controller may support a 64-bit Host Identifier and/or an extended 128-bit Host Identifier. It is recommended
that implementations support the extended 128-bit Host Identifier as indicated in the Controller Attributes
field in the Identify Controller data structure.


The Host Identifier for PCIe transport implementations shall have a default value of 0h and shall not have
a saved value. NVM Express Base Specification, Revision 2.0 and earlier allowed saving a Host Identifier
value, if a non-zero Host Identifier value had been saved then that saved value shall be reset to the default
value.


**NVMe over Fabrics Implementations**


The Host Identifier is a mandatory feature in NVMe over Fabrics implementations. The Host Identifier shall
be an extended 128-bit Host Identifier.


**5.1.25.1.29** **Reservation Notification Mask (Feature Identifier 82h)**


This Feature controls the masking of reservation notifications on a per namespace basis. A Reservation
Notification log page is created whenever a reservation notification occurs on a namespace and the
corresponding reservation notification type is not masked on that namespace by this Feature. If reservations
are supported by the controller, then this Feature shall be supported. The attributes are specified in
Command Dword 11.


A Set Features command that uses a namespace ID other than FFFFFFFFh modifies the reservation
notification mask for the corresponding namespace only. A Set Features command that uses a namespace
ID of FFFFFFFFh modifies the reservation notification mask of all namespaces that are attached to the
controller and that support reservations. A Get Features command that uses a namespace ID other than
FFFFFFFFh returns the reservation notification mask for the corresponding namespace. A Get Features
command that uses a namespace ID of FFFFFFFFh shall be aborted with status code of Invalid Field in
Command. If a Set Features command or a Get Features command attempts to access the Reservation
Notification Mask on a namespace that does not support reservations or is invalid, then that command is
aborted with status code of Invalid Field in Command.


If a Get Features command successfully completes for this Feature, the attributes specified in Figure 440
are returned in Dword 0 of the completion queue entry for that command.


**Figure 440: Reservation Notification Configuration – Command Dword 11**







|Bits|Description|
|---|---|
|31:04|Reserved|
|03|**Mask Reservation Preempted Notification (RESPRE):** If this bit is set to ‘1’, then mask the reporting<br>of reservation preempted notification by the controller. If this bit is cleared to ‘0’, then the notification is<br>not masked and a Reservation Notification log page is created whenever notification occurs.|
|02|**Mask Reservation Released Notification (RESREL):** If this bit is set to ‘1’, then mask the reporting of<br>reservation released notification by the controller. If this bit is cleared to ‘0’, then the notification is not<br>masked and a Reservation Notification log page is created whenever the notification occurs.|
|01|**Mask Registration Preempted Notification (REGPRE):** If this bit is set to ‘1’, then mask the reporting<br>of registration preempted notification by the controller. If this bit is cleared to ‘0’, then the notification is<br>not masked and a Reservation Notification log page is created whenever the notification occurs.|
|00|Reserved|


**5.1.25.1.30** **Reservation Persistence (Feature Identifier 83h)**


Each namespace that supports reservations has a Persist Through Power Loss (PTPL) state that may be
modified using either a Set Features command or a Reservation Register command (refer to section 7.6).
The Reservation Persistence feature attributes are specified in Command Dword 11.


The PTPL state is contained in the Reservation Persistence feature that is namespace specific. A Set
Features command that uses the namespace ID FFFFFFFFh modifies the PTPL state associated with all


399


NVM Express [®] Base Specification, Revision 2.2


namespaces that are attached to the controller and that support PTPL (i.e., support reservations). A Set
Features command that uses a valid namespace ID other than FFFFFFFFh and corresponds to a
namespace that supports reservations, modifies the PTPL state for that namespace. A Get Features
command that uses a namespace ID of FFFFFFFFh shall be aborted with a status code of Invalid Field in
Command. A Get Features command that uses a valid namespace ID other than FFFFFFFFh and
corresponds to a namespace that supports PTPL, returns the PTPL state for that namespace. If a Set
Features command or a Get Features command using a namespace ID other than FFFFFFFFh attempts
to access the PTPL state for a namespace that does not support this Feature Identifier, then the command
is aborted with status code of Invalid Field in Command.


This feature shall not be saveable (refer to Figure 196).


If a Get Features command successfully completes for this Feature Identifier, the attributes specified in
Figure 441 are returned in Dword 0 of the completion queue entry for that command


**Figure 441: Reservation Persistence Configuration – Command Dword 11**






|Bits|Description|
|---|---|
|31:01|Reserved|
|00|**Persist Through Power Loss (PTPL):** If this bit is set to '1', then reservations and registrants persist<br>across a power loss. If this bit is cleared to ‘0’, then reservations are released and registrants are cleared<br>on a power loss.|



**5.1.25.1.31** **Namespace Write Protection Config (Feature Identifier 84h)**


This Feature is used by the host to configure the namespace write protection state or to determine the write
protection state of a namespace. Refer to section 8.1.16 for definition and behaviors of the namespace
write protection states. The settings are specified in Command Dword 11.


This Feature is not saveable (refer to Figure 196). There is no default value for this Feature; the value of
the Feature after a power cycle or a Controller Level Reset is determined by the write protection state of
the namespace prior to the power cycle or Controller Level Reset, except for the Write Protect Until Power
Cycle write protection state (refer to section 8.1.16).


If a Get Features command is submitted for this Feature, the attributes specified in Figure 442 are returned
in Dword 0 of the completion queue entry for that command.


**Figure 442: Write Protection – Command Dword 11**






|Bits|Description|
|---|---|
|31:03|Reserved|
|02:00|**Write Protection State (WPS):** This field specifies the write protection state of the specified namespace. <br>**Value**<br>**Definition**<br>000b<br>No Write Protect<br>001b<br>Write Protect<br>010b<br>Write Protect Until Power Cycle<br>011b<br>Permanent Write Protect<br>100b to 111b<br>Reserved|


|Value|Definition|
|---|---|
|000b|No Write Protect|
|001b|Write Protect|
|010b|Write Protect Until Power Cycle|
|011b|Permanent Write Protect|
|100b to 111b|Reserved|



If a Set Features command attempts to change the namespace write protection state of a namespace that
is in the Write Protect Until Power Cycle state or in the Permanent Write Protect state, then the controller
shall abort the command with a status code of Feature Not Changeable.


If a Set Features command attempts to change the namespace write protection state of a namespace to
the Write Protect Until Power Cycle state and the Write Protect Until Power Cycle Control (WPUPCC) bit
of the of the Write Protection Control field is cleared to ‘0’, then the controller shall abort the command with
a status code of Feature Not Changeable.


If a Set Features command attempts to change the namespace write protection state of a namespace to
the Write Protect Until Power Cycle state in a multi-domain NVM subsystem (i.e., the MDS bit is set to ‘1’


400


NVM Express [®] Base Specification, Revision 2.2


in the CTRATT field of the Identify Controller data structure (refer to Figure 313)), then the controller shall
abort the command with a status code of Feature Not Changeable.


If a Set Features command changes the namespace to a write protected state, then the controller shall
commit all volatile write cache data and metadata associated with the specified namespace to non-volatile
storage media as part of transitioning to the write protected state.


**5.1.25.1.32** **Boot Partition Write Protection Config (Feature Identifier 85h)**


This Feature is used by the host to configure Boot Partition write protection states and to determine the
write protection state of both Boot Partitions supported by a controller. Refer to section 8.1.3.3.1 for
definition and behaviors of the Boot Partition write protection states and state transitions. The settings are
specified in Command Dword 11.


This Feature is not saveable (refer to Figure 196). The default value of both the Boot Partition 0 Write
Protection State field and the Boot Partition 1 Write Protection State field after a power cycle is Write
Locked.


If a Get Features command is submitted for this Feature, the attributes specified in Figure 443 are returned
in Dword 0 of the completion queue entry for that command. A controller shall not return a value of 000b
for either the Boot Partition 0 Write Protection State field or the Boot Partition 1 Write Protection State field
as a result of the Get Features command for the Boot Partition Write Protection Config feature.


If a Set Features command is submitted for this Feature with either the Boot Partition 0 Write Protection
State field or the Boot Partition 1 Write Protection State field cleared to 000b, then the controller shall not
change the Boot Partition write protection state for that Boot Partition as part of the Set Features command
completion.


If the Boot Partition Write Protection Enable bit is set to ‘1’ in the RPMB Device Configuration Block data
structure (refer to section 8.1.21), then the controller shall return a value of 100b for both the Boot Partition
0 Write Protection State field and the Boot Partition 1 Write Protection State field as a result of the Get
Features command for the Boot Partition Write Protection Config feature.


If a Set Features command is submitted for this Feature with either the Boot Partition 0 Write Protection
State field or the Boot Partition 1 Write Protection State field set to 100b, then the controller shall abort the
command with a status code of Invalid Field in Command.


**Figure 443: Boot Partition Write Protection Config - Command Dword 11**





|Bits|Description|
|---|---|
|31:06|Reserved|
|05:03|**Boot Partition 1 Write Protection State (BP1WPS):** This field specifies the write protection state of<br>Boot Partition 1.<br>The default value of this field is Write Locked.<br>**Value**<br>**Definition**<br>000b1 <br>Change in state not requested<br>001b<br>Write Unlocked<br>010b<br>Write Locked<br>011b<br>Write Locked Until Power Cycle<br>100b2 <br>Write Protection controlled by RPMB<br>101b to 111b<br>Reserved|


|Value|Definition|
|---|---|
|000b1|Change in state not requested|
|001b|Write Unlocked|
|010b|Write Locked|
|011b|Write Locked Until Power Cycle|
|100b2|Write Protection controlled by RPMB|
|101b to 111b|Reserved|


401


NVM Express [®] Base Specification, Revision 2.2


**Figure 443: Boot Partition Write Protection Config - Command Dword 11**







|Bits|Description|
|---|---|
|02:00|**Boot Partition 0 Write Protection State (BP0WPS):**This field specifies the write protection state of<br>Boot Partition 0.<br>The default value of this field is Write Locked.<br>**Value**<br>**Definition**<br>000b1 <br>Change in state not requested<br>001b<br>Write Unlocked<br>010b<br>Write Locked<br>011b<br>Write Locked Until Power Cycle<br>100b2 <br>Write Protection controlled by RPMB<br>101b to 111b<br>Reserved|
|Notes:<br>1.<br>A value of 000b is not returned by a controller via a Get Features command. This value is only used in the Set<br>Features command.<br>2.<br>A value of 100b is reserved for the Set Features command for both the Boot Partition 0 Write Protection State<br>field and the Boot Partition 1 Write Protection State field. The Boot Partition write protection states transition to<br>this state when RPMB Boot Partition Write Protection is enabled (refer to section 8.1.3.3.2 and section 8.1.21).|Notes:<br>1.<br>A value of 000b is not returned by a controller via a Get Features command. This value is only used in the Set<br>Features command.<br>2.<br>A value of 100b is reserved for the Set Features command for both the Boot Partition 0 Write Protection State<br>field and the Boot Partition 1 Write Protection State field. The Boot Partition write protection states transition to<br>this state when RPMB Boot Partition Write Protection is enabled (refer to section 8.1.3.3.2 and section 8.1.21).|


|Value|Definition|
|---|---|
|000b1|Change in state not requested|
|001b|Write Unlocked|
|010b|Write Locked|
|011b|Write Locked Until Power Cycle|
|100b2|Write Protection controlled by RPMB|
|101b to 111b|Reserved|


If a Set Features command is submitted that attempts to change the Boot Partition write protection state of
a Boot Partition that is in the Write Locked Until Power Cycle state, then the controller shall abort the
command with a status code of Feature Not Changeable.


If a Set Features command is submitted that attempts to change either Boot Partition write protection state
from a value of 100b (i.e., Boot Partition write protection is controlled by RPMB), then the controller shall
abort the command with a status code of Feature Not Changeable.


If a Set Features command attempts to change the Boot Partition write protection state of a Boot Partition
shared across multiple controllers to the Write Locked Until Power cycle state in a multi-domain NVM
subsystem (i.e., the MDS bit is set to ‘1’ in the CTRATT field of the Identify Controller data structure (refer
to Figure 313), then the controller shall abort the command with a status code of Feature Not Changeable.


**Memory-Based Transport Feature Specific Information (PCIe)**


**5.1.25.2.1** **Number of Queues (Feature Identifier 07h)**


This Feature indicates the number of queues that the host requests for the controller processing the
command. This Feature shall only be issued during initialization prior to creation of any I/O Submission
and/or Completion Queues. If a Set Features command is issued for this Feature after creation of any I/O
Submission and/or I/O Completion Queues, then the Set Features command shall abort with status code
of Command Sequence Error. The controller shall not change the value allocated between resets. For a
Set Features command, the attributes are specified in Command Dword 11 (refer to Figure 444). For a Get
Features command, Dword 11 is ignored.


If a Set Features or Get Features command is submitted for this Feature, the attributes specified in Figure
445 are returned in Dword 0 of the completion queue entry for that command.


**Figure 444: Number of Queues – Command Dword 11**





|Bits|Description|
|---|---|
|31:16|**Number of I/O Completion Queues Requested (NCQR):**Indicates the number of I/O Completion<br>Queues requested by software. This number does not include the Admin Completion Queue. A minimum<br>of one queue shall be requested, reflecting that the minimum support is for one I/O Completion Queue.<br>This is a 0’s based value. The maximum value that may be specified is 65,534 (i.e., 65,535 I/O<br>Completion Queues). If the value specified is 65,535, the controller should abort the command with a<br>status code of Invalid Field in Command.|


402


NVM Express [®] Base Specification, Revision 2.2


**Figure 444: Number of Queues – Command Dword 11**






|Bits|Description|
|---|---|
|15:00|**Number of I/O Submission Queues Requested (NSQR):**Indicates the number of I/O Submission<br>Queues requested by software. This number does not include the Admin Submission Queue. A minimum<br>of one queue shall be requested, reflecting that the minimum support is for one I/O Submission Queue.<br>This is a 0’s based value. The maximum value that may be specified is 65,534 (i.e., 65,535 I/O<br>Submission Queues). If the value specified is 65,535, the controller should abort the command with a<br>status code of Invalid Field in Command.|



Note: The value allocated may be smaller or larger than the number of queues requested, often in virtualized
implementations. The controller may not have as many queues to allocate as are requested. Alternatively,
the controller may have an allocation unit of queues (e.g., power of two) and may supply more queues to
host software to satisfy its allocation unit.


**Figure 445: Number of Queues – Completion Queue Entry Dword 0**






|Bits|Description|
|---|---|
|31:16|**Number of I/O Completion Queues Allocated (NCQA):**Indicates the number of I/O Completion<br>Queues allocated by the controller. A minimum of one queue shall be allocated, reflecting that the<br>minimum support is for one I/O Completion Queue. The value may not match the number requested by<br>host software. This is a 0’s based value.|
|15:00|**Number of I/O Submission Queues Allocated (NSQA):**Indicates the number of I/O Submission<br>Queues allocated by the controller. A minimum of one queue shall be allocated, reflecting that the<br>minimum support is for one I/O Submission Queue. The value may not match the number requested by<br>host software. This is a 0’s based value.|



**5.1.25.2.2** **Interrupt Coalescing (Feature Identifier 08h)**


This Feature configures controller configures interrupt coalescing settings. The controller should signal an
interrupt when either the Aggregation Time or the Aggregation Threshold conditions are met. If either the
Aggregation Time or the Aggregation Threshold fields are cleared to 0h, then an interrupt may be generated
(i.e., interrupt coalescing is implicitly disabled). This Feature applies only to the I/O Queues. It is
recommended that interrupts for commands that complete in error are not coalesced. The settings are
specified in Command Dword 11.


If the controller detects that interrupts are already being processed for this vector, then the controller may
delay additional interrupts. Specifically, if the Completion Queue Head Doorbell property that is associated
with a particular interrupt vector is being updated, then the controller has a positive indication that
completion queue entries are already being processed. In this case, the aggregation time and/or the
aggregation threshold may be reset/restarted upon the associated property write. This may result in
interrupts being delayed indefinitely in certain workloads where the aggregation time or aggregation
threshold is non-zero.


If a Get Features command is submitted for this Feature, the attributes specified in Figure 446 are returned
in Dword 0 of the completion queue entry for that command.


This Feature is valid when the controller is configured for Pin Based, MSI, Multiple MSI or MSI-X interrupts.
There is no requirement for the controller to persist these settings if interrupt modes are changed. It is
recommended that the host re-issue this Feature after changing interrupt modes.


**Figure 446: Interrupt Coalescing – Command Dword 11**





|Bits|Description|
|---|---|
|31:16|Reserved|
|15:08|**Aggregation Time (TIME):**Specifies the recommended maximum time in 100 microsecond increments<br>that a controller may delay an interrupt due to interrupt coalescing. A value of 0h corresponds to no<br>delay. The controller may apply this time per interrupt vector or across all interrupt vectors. The reset<br>value of this setting is 0h.|


403


NVM Express [®] Base Specification, Revision 2.2


**Figure 446: Interrupt Coalescing – Command Dword 11**






|Bits|Description|
|---|---|
|07:00|**Aggregation Threshold (THR):**Specifies the recommended minimum number of completion queue<br>entries to aggregate per interrupt vector before signaling an interrupt to the host. This is a 0’s based<br>value. The reset value of this setting is 0h.|



**5.1.25.2.3** **Interrupt Vector Configuration (Feature Identifier 09h)**


This Feature configures settings specific to a particular controller interrupt vector. The settings are specified
in Command Dword 11.


By default, coalescing settings are enabled for each interrupt vector. Interrupt coalescing is not supported
for the Admin Completion Queue.


If a Get Features command is submitted for this Feature, the attributes specified in Figure 447 are returned
in Dword 0 of the completion queue entry for that command for the Interrupt Vector specified in Command
Dword 11.


Prior to issuing a Set Features command that specifies this Feature, the host shall configure the specified
Interrupt Vector with an I/O Completion Queue (refer to section 5.2.1). If the specified Interrupt Vector is
invalid, or not associated with an existing I/O Completion Queue (refer to Figure 476), then the controller
should abort the command with a status code of Invalid Field in Command.


**Figure 447: Interrupt Vector Configuration – Command Dword 11**







|Bits|Description|
|---|---|
|31:17|Reserved|
|16|**Coalescing Disable (CD):**If this bit is set to ‘1’, then any interrupt coalescing settings shall not be applied<br>for this interrupt vector. If this bit is cleared to ‘0’, then interrupt coalescing settings apply for this interrupt<br>vector.|
|15:00|**Interrupt Vector (IV):**This field specifies the interrupt vector for which the configuration settings are<br>applied.|


**5.1.25.2.4** **Host Memory Buffer (Feature Identifier 0Dh)**


This Feature controls use of the Host Memory Buffer by the controller. The attributes are specified in
Command Dword 11, Command Dword 12, Command Dword 13, Command Dword 14, and Command
Dword 15.


The Host Memory Buffer feature provides a mechanism for the host to allocate a portion of host memory
for the exclusive use of the controller. After a successful completion of a Set Features command enabling
the host memory buffer, the host shall not write to:


a) The Host Memory Descriptor List (refer to Figure 453); and
b) the associated host memory region (i.e., the memory regions described by the Host Memory

Descriptor List),


until the host memory buffer has been disabled.


If the host memory buffer is enabled, then a Set Features command to enable the host memory buffer (i.e.,
the EHM bit (refer to Figure 448) set to ‘1’) shall abort with a status code of Command Sequence Error.


If the host memory buffer is not enabled, then a Set Features command to disable the host memory buffer
(i.e., the EHM bit (refer to Figure 448) cleared to ‘0’) shall succeed without taking any action.


After a successful completion of a Set Features command that disables the host memory buffer, the
controller shall not access any data in the host memory buffer until the host memory buffer has been
enabled. The controller should retrieve any necessary data from the host memory buffer in use before
posting the completion queue entry for the Set Features command that disables the host memory buffer.
Posting of the completion queue entry for the Set Features command that disables the host memory buffer


404


NVM Express [®] Base Specification, Revision 2.2


acknowledges that it is safe for the host software to modify the host memory buffer contents. Refer to
section 8.2.3.


A host is able to restrict access to the host memory buffer (HMB) while the controller is in a non-operational
power state that was configured by the host (refer to section 5.1.25.1.2). If this HMB non-operational power
state access restriction is enabled by the host (refer to Figure 448) and the host configures a nonoperational power state, then the controller does not access the HMB until the controller transitions to an
operational power state except for HMB access required to process Admin commands and background
operations initiated by Admin commands. Enabling or disabling Non-Operational Power State Permissive
Mode (refer to section 5.1.25.1.10) shall have no effect on HMB non-operational power state access
restriction.


Enabling or disabling HMB non-operational power state access restriction should not affect the Entry
Latency (ENLAT) for non-operational power states (refer to section 8.1.17) that are reported in the power
state descriptors in Identify Controller data structure (e.g., if HMB non-operational power state access
restriction is enabled, the controller may consume additional time beyond the applicable Entry Latency
value in order to retrieve necessary data from the HMB before the controller transitions to a non-operational
power state).


If HMB non-operational power state access restriction is enabled and the controller autonomously
transitions from an operational power state to a non-operational power state, then HMB access by the
controller is not restricted and that access should be minimized (e.g., access ceases as soon as possible
after that transition and does not resume until after the controller transitions to an operational power state).


If HMB non-operational power state access restriction is enabled and the host configures a non-operational
power state while the controller is in a non-operational power state, then HMB access by the controller is
restricted.


If a Get Features command is issued for this Feature, then the completion queue entry indicates whether
HMB non-operational power state access restriction is enabled and whether HMB non-operational power
state access restriction is currently restricting controller access to the HMB (refer to Figure 455):


**Figure 448: Host Memory Buffer – Command Dword 11**





|Bits|Description|
|---|---|
|31:04|Reserved|
|03|**Cleared to Zero (CTZ):** This bit shall be cleared to ‘0’|
|02|**Host Memory Non-operational Access Restriction Enable (HMNARE):** If the HMBR bit is set to ‘1’<br>in the Controller Attributes (CTRATT) field in the Identify Controller data structure and:<br>• <br>this bit is set to ‘1’, then HMB non-operational power state access restriction shall be enabled<br>(i.e., the controller shall not access the HMB after a non-operational power state is configured<br>by the host (refer to section 5.1.25.1.2) until the controller is in an operational power state<br>except for access required to process Admin commands and background operations initiated<br>by Admin commands); and<br>• <br>this bit is cleared to ‘0’, then HMB non-operational power state access restriction shall be<br>disabled (i.e., the controller may access the HMB while the controller is in any non-operational<br>power state).<br>If this bit set to ‘1’ and the HMBR bit is cleared to ‘0’, then the controller shall abort the command with<br>a status code of Invalid Field in Command.<br>If this bit is cleared to ‘0’ and the HMBR bit is cleared to ‘0’, then this bit has no effect.|
|01|**Memory Return (MR):** If this bit is set to ‘1’, then the host is returning memory previously allocated to<br>the controller for use as the host memory buffer (HMB). That memory may have been in use for the<br>HMB prior to a reset or entering the Runtime D3 state (e.g., prior to the HMB being disabled). A returned<br>host memory buffer shall have the exact same size, descriptor list address, descriptor list contents, and<br>host memory buffer contents as last seen by the controller before the host memory buffer was disabled<br>(i.e., a Set Features command with the EHM bit cleared to '0' was processed). If this bit is cleared to<br>‘0’, then the host is allocating host memory resources with undefined content.|


405


NVM Express [®] Base Specification, Revision 2.2


**Figure 448: Host Memory Buffer – Command Dword 11**





|Bits|Description|
|---|---|
|00|**Enable Host Memory (EHM):** If this bit is set to ‘1’, then the host memory buffer shall be enabled and<br>the controller may use the host memory buffer. If this bit is cleared to ‘0’, then the host memory buffer<br>shall be disabled, and the controller shall not use the host memory buffer.<br>If a Set Features command is processed with this bit cleared to ‘0’, then the controller shall ignore<br>Command Dword 12, Command Dword 13, Command Dword 14, and Command Dword 15.|


**Figure 449: Host Memory Buffer – Command Dword 12**



|Bits|Description|
|---|---|
|31:00|**Host Memory Buffer Size (HSIZE):** This field specifies the size of the host memory buffer allocated in<br>memory page size (CC.MPS) units.|


**Figure 450: Host Memory Buffer– Command Dword 13**





|Bits|Description|
|---|---|
|31:00|**Host Memory Descriptor List Lower Address (HMDLLA):** This field specifies the least significant<br>32 bits of the physical location of the Host Memory Descriptor List (refer to Figure 453) for the Host<br>Memory Buffer. This address shall be 16 byte aligned, indicated by bits 3:0 being cleared to 0h.<br>Note: The controller shall operate as if bits 3:0 are cleared to 0h. However, the controller is not<br>required to check that bits 3:0 are cleared to 0h.|


**Figure 451: Host Memory Buffer – Command Dword 14**



|Bits|Description|
|---|---|
|31:00|**Host Memory Descriptor List Upper Address (HMDLUA):** This field specifies the most significant 32<br>bits of the physical location of the Host Memory Descriptor List for the Host Memory Buffer.|


The Host Memory Descriptor List Address (HMDLLA/HMDLUA) specifies the address of a physically
contiguous data structure in host memory that describes the address and length pairs of the Host Memory
Buffer. The number of address and length pairs is specified in the Host Memory Descriptor List Entry Count
in Figure 452. The Host Memory Descriptor List is described in Figure 453.


**Figure 452: Host Memory Buffer – Command Dword 15**

|Bits|Description|
|---|---|
|31:00|**Host Memory Descriptor List Entry Count (HMDLEC):**This field specifies the number of entries<br>provided in the Host Memory Descriptor List.|



If the host specifies the Host Memory Descriptor List Entry Count field cleared to 0h, then the controller
shall abort the command with a status code of Invalid Field in Command.


**Figure 453: Host Memory Buffer – Host Memory Descriptor List**

|Bytes|Description|
|---|---|
|**Host Memory Descriptor List**|**Host Memory Descriptor List**|
|15:0|**Host Memory Buffer Descriptor Entry 0:**This field is the first Host Memory Buffer<br>Descriptor (refer to Figure 454) in the list, if any.|
|31:16|**Host Memory Buffer Descriptor Entry 1:** This field is the second Host Memory Buffer<br>Descriptor in the list, if any.|
|…|…|
|16*n+15:16*n|**Host Memory Buffer Descriptor Entry n:** This field is the last Host Memory Buffer<br>Descriptor in the list where n = HMDLEC - 1 (refer to Figure 452), if any.|



406


NVM Express [®] Base Specification, Revision 2.2


Each Host Memory Buffer Descriptor Entry shall describe a host memory address in memory page size
units and the number of contiguous memory page size units associated with the host address.


**Figure 454: Host Memory Buffer – Host Memory Buffer Descriptor Entry**






|Bits|Description|
|---|---|
|127:96|Reserved|
|95:64|**Buffer Size (BSIZE):** Indicates the number of contiguous memory page size (CC.MPS) units for this<br>descriptor. If this field is cleared to 0h, then the controller shall ignore this descriptor.|
|63:00|**Buffer Address (BADD):**Indicates the host memory address for this descriptor aligned to the<br>memory page size (CC.MPS). The least significant bits (_n_:0) of this field indicate the offset within the<br>memory page is 0h (e.g., if the memory page size is 4 KiB, then bits 11:00 shall be 0h; if the memory<br>page size is 8 KiB, then bits 12:00 shall be 0h).|



If a Get Features command is issued for this Feature, the attributes specified in Figure 455 are returned in
Dword 0 of the completion queue entry and the Host Memory Buffer Attributes data structure, whose
structure is defined in Figure 456, is returned in the data buffer for that command.


**Figure 455: Host Memory Buffer – Completion Queue Entry Dword 0**











|Bits|Description|
|---|---|
|31:04|Reserved|
|03|**Host Memory Non-operational Access Restricted (HMNAR):** If this bit is set to ‘1’, then HMB non-<br>operational power state access restriction is currently restricting the controller from accessing the<br>HMB. If this bit is cleared to ‘0’, then HMB non-operational power state access restriction is not<br>currently restricting the controller from accessing the HMB (e.g., the HMB is not enabled, the controller<br>is currently in an operational power state, HMB non-operational power state access restriction is not<br>supported, or HMB non-operational power state access restriction is not enabled).|
|02|**Host Memory Non-operational Access Restriction Enable (HMNARE):** If this bit is set to ‘1’, then<br>HMB non-operational power state access restriction is enabled (refer to the HMNARE bit description<br>in Figure 448). If this bit is cleared to ‘0’, then HMB non-operational power state access restriction is<br>not enabled.|
|01|**Not Used (NUSED):**This bit is not used for a Get Feature command and shall be cleared to ‘0’.|
|00|**Enable Host Memory (EHM):** If this bit is set to ‘1’, then the host memory buffer is enabled and the<br>controller may use the host memory buffer. If this bit is cleared to ‘0’, then the host memory buffer is<br>disabled, and the controller is not using the host memory buffer.|


**Figure 456: Host Memory Buffer – Attributes Data Structure**









|Bytes|Description|
|---|---|
|3:0|**Host Memory Buffer Size (HSIZE):** This field indicates the size of the host memory buffer allocated<br>in memory page size units.|
|7:4|**Host Memory Descriptor List Address Lower (HMDLAL):** This field indicates the least significant<br>32 bits of the physical location of the Host Memory Descriptor List (refer to Figure 453) for the host<br>memory buffer. This address shall be 16 byte aligned. The least significant 4 bits shall be cleared to<br>‘0’.|
|11:8|**Host Memory Descriptor List Address Upper (HMDLAU):** This field indicates the most significant<br>32 bits of the physical location of the Host Memory Descriptor List (refer to Figure 453) for the host<br>memory buffer.|
|15:12|**Host Memory Descriptor List Entry Count (HMDLEC):**This field indicates the number of valid Host<br>Memory Descriptor Entries (refer to Figure 454) in the Host Memory Descriptor List (refer to Figure<br>453).|
|4095:16|Reserved|


**Message-Based Transport Feature Specific Information (Fabrics)**



There are no features that are specific to the Message-based transport model.


407


NVM Express [®] Base Specification, Revision 2.2


**5.1.25.3.1 Asynchronous Event Configuration (Feature Identifier 0Bh) for Fabrics**


The Asynchronous Event Configuration feature is not Fabrics specific. Configuration of notifications for
Fabrics specific events is described in section 5.1.25.1.5.


**Command Completion**


Upon completion of the Set Features command, the controller posts a completion queue entry to the Admin
Completion Queue. If a status code of Successful Completion is returned, the completion queue entry shall
not be posted until the controller has completed setting attributes associated with the Feature. Set Features
command specific status values are defined in Figure 457.


**Figure 457: Set Features – Command Specific Status Values**

|Value|Definition|
|---|---|
|0Dh|**Feature Identifier Not Saveable:** The Feature Identifier specified does not support a saveable value.|
|0Eh|**Feature Not Changeable:**The Feature Identifier specified does not support a changeable value or the<br>value is not changeable at this time.|
|0Fh|**Feature Not Namespace Specific:**The Feature Identifier does not have namespace scope. The scope<br>is defined in Figure 386. The Feature Identifier settings apply across all namespaces.|
|14h|**Overlapping Range:**Command Set specific definition. Refer to each I/O Command Set specification<br>for applicability and details.|
|15h|**I/O Command Set Combination Rejected:**This error indicates that the controller did not accept the<br>request to select the requested I/O Command Set Combination.|
|37h|**Invalid Controller Data Queue:** This error indicates that the specified Controller Data Queue Identifier<br>is invalid for the controller processing the command.|



**Track Receive command**


The Track Receive command is used to obtain the information being tracked by the controller that was
enabled by a Track Send command (refer to section 5.1.27).


The Track Receive command uses the Data Pointer field, Command Dword 10 field, and Command Dword
12 field. The use of the Command Dword 11 field is specific to the management operation specified by the
Select field . All other command specific fields are reserved.


The Select field defined in Figure 458 specifies the management operation to be performed. Refer to section
5.1.26.1 for a description of each management operation.


**Figure 458: Track Receive – Command Dword 10**





|Bits|Description|
|---|---|
|31:08|Reserved|
|07:00|**Select (SEL):**This field specifies the type of management operation to perform.<br>**Value**<br>**M/O1 **<br>**Management Operation**<br>**Reference Section**<br>0h<br>O <br>Tracked Memory Changes<br>5.1.26.1.1<br>1h to FFh<br> <br>Reserved<br>Notes:<br>1.<br>O/M definition: O = Optional, M = Mandatory|


|Value|1<br>M/O|Management Operation|Reference Section|
|---|---|---|---|
|0h|O|Tracked Memory Changes|5.1.26.1.1|
|1h to FFh||Reserved|Reserved|
|Notes:<br>1.<br>O/M definition: O = Optional, M = Mandatory|Notes:<br>1.<br>O/M definition: O = Optional, M = Mandatory|Notes:<br>1.<br>O/M definition: O = Optional, M = Mandatory|Notes:<br>1.<br>O/M definition: O = Optional, M = Mandatory|


**Figure 459: Track Receive – Command Dword 12**





|Bits|Description|
|---|---|
|31:00|**Number of Dwords (NUMDL):** This field specifies the number of dwords to return. If the host specifies a<br>size larger than defined by the specified management operation of the command, then the controller returns<br>the data specified by that management operation with undefined results for dwords beyond the end of the<br>data specified by that management operation. This is a 0’s based value.|


408


NVM Express [®] Base Specification, Revision 2.2


**Track Receive Management Operations**


**5.1.26.1.1** **Tracked Memory Changes (Management Operation 0h)**


The Tracked Memory Changes management operation of the Track Receive command is used to report
host memory changes by the controller specified by the Controller Identifier (CNTLID) field (refer to Figure
460) processing any and all commands (e.g., Admin commands, I/O command) as a result of tracking host
memory modifications being started by a Tracked Memory Changes management operation of the Track
Send command (refer to section 5.1.27.1.2).


The data returned is a Tracked Memory Change data structure defined by Figure 461. The identifier for the
controller that is tracked is specified in the Controller Identifier field in the Command Dword 11 field as
defined in Figure 460.


**Figure 460: Tracked Memory Changes – Command Dword 11**

|Bits|Description|
|---|---|
|31:16|Reserved|
|15:00|**Controller Identifier (CNTLID):** This field specifies the identifier of the controller for which the tracked<br>memory changes, if any, are to be returned.|



If the Track Receive command for this management operation completes successfully, then the controller
shall remove the tracked memory changes that were reported in the returned data. The reported memory
ranges identify the host memory that has changed due to the specified controller processing commands
since:


   - Track Memory Changes was enabled (refer to 5.1.27.1.2) and no tracked memory changes have
been reported by the controller; or

   - the controller last reported tracking change while the memory tracking remained enabled.


If tracked memory changes occur for the same memory address at a high frequency, the controller reporting
of the Tracking Memory Changed Descriptors for that address may be delayed by a vendor specific amount
of time so that Tracking Memory Changed Descriptors for other addresses are able to be reported during
that vendor specific amount of time.


If the Suspended bit is set to ‘1’ and the More To Report (MTR) bit is cleared to ‘0’ in the returned Track
Memory Changed data structure, then all host memory changes have been reported to the host. If the
controller specified by the CNTLID field remains suspended, then the controller has no more tracked host
memory changes to report to the host until the controller specified by the CNTLID field is resumed.


If the Suspended bit is cleared to ‘0’ and the More To Report (MTR) bit is cleared to ‘0’ in the returned Track
Memory Changed data structure, then no additional tracked host memory changes are available to report
to the host in a subsequent commands at the time of processing this command.


**Figure 461: Tracked Memory Change Data Structure**





|Bytes|Description|
|---|---|
|**Header**|**Header**|
|00|**Version (VER):**This field indicates the version of this data structure.<br>This field shall be cleared to 0h.|


409


NVM Express [®] Base Specification, Revision 2.2


**Figure 461: Tracked Memory Change Data Structure**






|Bits|Description|
|---|---|
|7:2|Reserved|
|1|**Suspended (SUSP):** If this bit is set to ‘1’, then the controller was suspended during<br>the processing of the command. If this bit is cleared to ‘0’, then the controller was<br>not suspended during the processing of the command.|
|0|**More To Report (MTR):** If this bit is set to ‘1’, then the controller was not able to<br>report all of the tracked memory changes available to be reported in this returned<br>data structure. The host should issue a subsequent Track Receive command to<br>obtain any tracked memory changes not reported.<br>If this bit is cleared to ‘0’, the controller reported all of the tracked memory changes<br>available to be reported, if any, at the time the Track Receive command was<br>processed.<br>If the NTMCD field is cleared to 0h, then this bit shall be cleared to ‘0’.|









|Bytes|Description|
|---|---|
|01|**Attributes (ATTRB)**: This field identifies attributes associated with the tracked memory<br>changes.<br>**Bits**<br>**Description**<br>7:2<br>Reserved<br>1 <br>**Suspended (SUSP):** If this bit is set to ‘1’, then the controller was suspended during<br>the processing of the command. If this bit is cleared to ‘0’, then the controller was<br>not suspended during the processing of the command.<br>0 <br>**More To Report (MTR):** If this bit is set to ‘1’, then the controller was not able to<br>report all of the tracked memory changes available to be reported in this returned<br>data structure. The host should issue a subsequent Track Receive command to<br>obtain any tracked memory changes not reported.<br>If this bit is cleared to ‘0’, the controller reported all of the tracked memory changes<br>available to be reported, if any, at the time the Track Receive command was<br>processed.<br>If the NTMCD field is cleared to 0h, then this bit shall be cleared to ‘0’.|
|03:02|**Controller Identifier (CNTLID)**: This field indicates the identifier for the controller whose<br>memory modifications are being tracked and reported in the Tracked Memory Changed<br>Descriptor list. (i.e., the same controller identifier as specified by the host in the Management<br>Operation Specific field (refer to Figure 460)).|
|07:04|**Number of Tracked Memory Changed Descriptors (NTMCD):** This field indicates the<br>number of Tracked Memory Changed Descriptors in this data structure. A value of 0h<br>indicates that at the time of processing the Track Receive command, there was no tracked<br>memory changes to report.|
|09:08|**Reported Memory Range Granularity (RPMPG):** This field specifies the granularity unit size<br>of the Length field in each Tracked Memory Changed Descriptor containing in this data<br>structure. The value specified is a power of two (2^n) times 4 KiB. For example, a value of 8h<br>indicates that the granularity of tracking is (2^8) * 4 KiB which is equal to 1 MiB.|
|15:10|Reserved|
|**Tracked Memory Changed Descriptor List**|**Tracked Memory Changed Descriptor List**|
|31:16|**Tracked Memory Changed Descriptor 1:**This field contains the first Tracked Memory<br>Change Descriptor as defined in Figure 464, if any.|
|47:32|**Tracked Memory Changed Descriptor 2:**This field contains the second Tracked Memory<br>Changed Descriptor as defined in Figure 464, if any.|
|…|…|
|(NTMCD*16)+15:<br>(NTMCD-1)*16+16|**Tracked Memory Changed Descriptor NTMCD:**This field contains the last Tracked<br>Memory Changed Descriptor as defined in Figure 464, if any.|
|…|…|


Figure 464 defines a Tracked Memory Changed Descriptor.


**Figure 462: Tracked Memory Changed Descriptor**







|Bytes|Description|
|---|---|
|07:00|**Start Address (SADDR):** This field indicates the 64-bit starting address of a memory range in which one<br>or more bytes of data have been written. The address in this field shall be aligned to the granularity specified<br>by the RPMPG field. For example, if the value in the RPMPG field is 8h, then the value in this field is<br>required to be aligned to 1 MiB (i.e., bits 19:0 are cleared to 0h).|
|11:08|**Length (LEN):** This field specifies the length of this memory range in units of the tracking granularity as<br>indicated in the RPMPG field. For example, if the value in the RPMPG field is 8h and the value of this field<br>is 4h then the length of this length of this memory range is 1 MiB * 4h which is 4 MiB.|
|15:12|Reserved|


410


NVM Express [®] Base Specification, Revision 2.2


**5.1.26.1.2** **Command Completion**


Upon completion of the Track Receive command, the controller posts a completion queue entry to the
Admin Completion Queue indicating the status for the command. Section 5.1.26.1 describes completion
details each for management operation.


Track Receive command specific status values (i.e., SCT field set to 1h) are shown in Figure 463.


**Figure 463: Track Receive – Command Specific Status Values**

|Value|Definition|
|---|---|
|1Fh|**Invalid Controller Identifier:**The controller for the specified Controller Identifier is already<br>tracking host memory changes.|



**Track Send command**


The Track Send command is used to manage the tracking of information by a controller (e.g., what to track
during the migration of a controller in an NVM subsystem).


The Track Send command uses the Command Dword 10 field. The use of the Data Pointer field and
Command Dword 11 field is specific to the management operation specified by the Select field . All other
command specific fields are reserved.


The Select field defined in Figure 464 specifies the management operation to be performed. Refer to section
5.1.27.1 for a description of each management operation.


**Figure 464: Track Send – Command Dword 10**





|Bits|Description|
|---|---|
|31:16|**Management Operation Specific (MOS):**The definition of this field is specific to a management operation<br>(refer to the Select field). If a management operation does not define the use of this field, then this field is<br>reserved.|
|15:08|Reserved|
|07:00|**Select (SEL):**This field specifies the type of management operation to perform.<br>**Value**<br>**M/O1 **<br>**Management Operation**<br>**Reference Section**<br>0h<br>O <br>Log User Data Changes<br>5.1.27.1.1<br>1h<br>O <br>Track Memory Changes<br>5.1.27.1.2<br>2h to FFh<br> <br>Reserved<br>Notes:<br>1.<br>O/M definition: O = Optional, M = Mandatory|


|Value|1<br>M/O|Management Operation|Reference Section|
|---|---|---|---|
|0h|O|Log User Data Changes|5.1.27.1.1|
|1h|O|Track Memory Changes|5.1.27.1.2|
|2h to FFh||Reserved|Reserved|
|Notes:<br>1.<br>O/M definition: O = Optional, M = Mandatory|Notes:<br>1.<br>O/M definition: O = Optional, M = Mandatory|Notes:<br>1.<br>O/M definition: O = Optional, M = Mandatory|Notes:<br>1.<br>O/M definition: O = Optional, M = Mandatory|


**Track Send Management Operations**



**5.1.27.1.1** **Log User Data Changes (Management Operation 0h)**


The Log User Data Changes management operation of the Track Send command is used to start or stop
logging user data changes to namespaces attached to the controller associated with the User Data
Migration Queue (refer to section 5.1.4.1.1.1) specified in Controller Data Queue Identifier field in Command
Dword 11 (refer to Figure 466).


Refer to the applicable I/O command Set specification for additional requirements.


411


NVM Express [®] Base Specification, Revision 2.2


**Figure 465: Log User Data Changes – Management Operation Specific Field**










|Bits|Description|
|---|---|
|15:04|Reserved|
|03:00|**Logging Action (LACT):**This field specifies the logging action to be performed. <br>**Value**<br>**Definition**<br>0h<br>**Stop Logging:** The controller shall stop logging user data changes to namespaces<br>attached to the controller associated with the User Data Migration Queue specified in the<br>Controller Data Queue Identifier field. <br>1h<br>**Start Logging:** The controller shall start logging user data changes to namespaces<br>attached to the controller associated with the User Data Migration Queue (refer to the<br>CDQID field in Figure 466) into that User Data Migration Queue where those user data<br>changes are caused by the controller associated with that User Data Migration Queue<br>processing commands.<br>2h to Fh<br>Reserved|


|Value|Definition|
|---|---|
|0h|**Stop Logging:** The controller shall stop logging user data changes to namespaces<br>attached to the controller associated with the User Data Migration Queue specified in the<br>Controller Data Queue Identifier field.|
|1h|**Start Logging:** The controller shall start logging user data changes to namespaces<br>attached to the controller associated with the User Data Migration Queue (refer to the<br>CDQID field in Figure 466) into that User Data Migration Queue where those user data<br>changes are caused by the controller associated with that User Data Migration Queue<br>processing commands.|
|2h to Fh|Reserved|



The Log User Data Changes management operation uses Command Dword 11 as defined in Figure 466.


**Figure 466: Log User Data Changes – Command Dword 11**

|Bits|Description|
|---|---|
|31:16|Reserved|
|15:00|**Controller Data Queue Identifier (CDQID):** This field specifies the Controller Data Queue Identifier of the<br>User Data Migration Queue.|



Refer to the applicable I/O Command Set specification for any requirements on the posting of entries into
the User Data Migration Queue if this command is successful.


If the value in the Controller Data Queue Identifier field specifies a User Data Migration Queue that does
not exist in the controller processing the command, then the controller shall abort the command with a
status code of Invalid Controller Data Queue.


If the LACT field is set to 1h and any controller in the NVM subsystem is already logging user data for the
controller associated with the Controller Data Queue specified by the CDQID field, then the controller shall
abort the command with a status code of Invalid Controller Data Queue.


If the controller associated with the User Data Migration Queue specified by the CDQID field is suspended
as a result of a Migration Send command (refer to section 5.1.17.1.1), then the controller shall abort the
command with a status code of Controller Suspended.


**5.1.27.1.2** **Track Memory Changes (Management Operation 1h)**


The Track Memory Changes management operation of the Track Send command requests the controller
processing that Track Send command to:


   - start tracking host memory changes described by the specified host memory ranges that are
caused by the processing commands in the controller specified by Controller Identifier field (refer
to Figure 468); or

   - stop tracking the host memory changes that are caused by the processing commands by the
controller specified by Controller Identifier field.


If the TACT bit is set to ‘1’ (refer to Figure 467), then:


   - The data buffer contains a Track Memory Changes data structure (refer to Figure 469) that
specifies one or more host memory ranges associated with the controller specified by the
Controller Identifier field.

   - If the value in the Requested Memory Range Tracking Granularity (RMRTG) field is greater than
the value in the Maximum Memory Range Tracking Granularity (MAXMRTG) field in the Identify
Controller data structure (refer to Figure 313), then the controller shall abort the command with a
status code of Invalid Field in Command.


412


NVM Express [®] Base Specification, Revision 2.2


   - If the value in the Requested Memory Range Tracking Granularity (RMRTG) field is less than the
value in the Minimum Memory Range Granularity (MINMRG) field in the Identify Controller data
structure (refer to Figure 313), then the controller shall abort the command with a status code of
Invalid Field in Command.

   - If the sum of:


`o` the value in the Requested Number of Memory Range Tracking Descriptors (RNMRTD)
field; and
`o` the number of Memory Range Tracking Descriptors currently being tracked by the
controller processing the command for other controllers in the NVM subsystem,


is greater than the value in the Controller Maximum Memory Range Tracking Descriptors
(CMMRTD) field in the Identify Controller data structure (refer to Figure 313), then the controller
processing the command shall abort the command with a status code of Invalid Field in Command.

   - If the sum of the value in the Requested Number of Memory Range Tracking Descriptors
(RNMRTD) field plus the number of Memory Range Tracking Descriptors currently being tracked
by all controllers in the NVM subsystem is greater than the value in the NVM subsystem Maximum
Memory Range Tracking Descriptors (NMMRTD) field in the Identify Controller data structure (refer
to Figure 313), then the controller shall abort the command with a status code of Invalid Field in
Command.

   - If any controller in the NVM subsystem is already tracking host memory changes for the controller
specified by the CNTLID field, then the controller processing the command shall abort the
command with a status code of Invalid Controller Identifier.

   - If:

`o` the Memory Range Tracking Length Limit (MRTLL) bit in the Identify Controller data
structure is set to ‘1’; and
`o` the length as specified by the Requested Memory Range Tracking Granularity field and
any Length field in a Track Memory Changes data structure is not a value that is a power
of 2,


then the controller shall abort the command with a status code of Invalid Field in Command.


If the TACT bit is cleared to ‘0’, then the data buffer shall be ignored by the controller.


**Figure 467: Track Memory Changes – Management Operation Specific Field**





|Bits|Description|
|---|---|
|15:01|Reserved|
|00|**Tracking Action (TACT):**If this bit is set to ‘1’, then the data buffer specifies the host memory<br>ranges associated with the controller specified by the Controller Identifier field. Any writes to<br>those host memory ranges by the controller specified by the Controller Identifier field shall be<br>tracked by the controller processing the command (i.e., tracking starts).<br>If this bit is cleared to ‘0’, then controller processing the command shall stop tracking host memory<br>changes by the controller specified by the Controller Identifier field.|


**Figure 468: Track Memory Changes – Command Dword 11**








|Bits|Description|
|---|---|
|31:16|Reserved|
|15:00|**Controller Identifier (CNTLID):** This field specifies the identifier of the controller for which changes to host<br>memory is being tracked. If the value of this field is the controller identifier of the controller processing the<br>command, then the controller processing the command shall abort the command with a status code of Invalid<br>Controller Identifier.|



If the controller specified by the CNTLID field is suspended (refer to section 5.1.17.1.1), then the controller
shall abort the command with a status code of Controller Suspended.


413


NVM Express [®] Base Specification, Revision 2.2


**Figure 469: Track Memory Changes Data Structure**












|Bytes|Description|
|---|---|
|**Header**|**Header**|
|00|**Version (VER):**This field specifies the version of this data structure.<br>If this field is not cleared to 0h, then the controller shall abort this command with a status code<br>of Invalid Field in Command.|
|02:01|Reserved|
|03|**Requested Memory Range Tracking Granularity (RMRTG):** This field specifies the<br>granularity for the Length field in each Memory Range Tracking Descriptor contained in this<br>data structure. The value specified is a power of two (2^n) times 4 KiB. For example, a value<br>of 8h indicates that the granularity of tracking is (2^8) * 4 KiB which in 1 MiB.|
|07:04|**Number of Memory Range Tracking Descriptors (RNMRTD):** This field specifies the<br>number of Memory Range Tracking Descriptors in the Memory Range Tracking Descriptor<br>list.<br>This field is a 1’s based number.|
|**Memory Range Tracking Descriptor List**|**Memory Range Tracking Descriptor List**|
|19:08|**Memory Range Tracking Descriptor 0:**This field contains the first Memory Range Tracking<br>Descriptor as defined in Figure 470.|
|31:20|**Memory Range Tracking Descriptor 1:**This field contains the second Memory Range<br>Tracking Descriptor as defined in Figure 470, if any.|
|…|…|
|(RNMRTD*12)+7:<br>(RNMRTD-1)*12+8|**Memory Range Tracking Descriptor RNMRTD-1:**This field contains the last Memory<br>Range Tracking Descriptor as defined in Figure 470, if any.|



Figure 470 defines a Memory Range Tracking Descriptor. The address range specified by a Memory Range
Tracking Descriptor describes addresses specified in an SGL or PRP for a command submitted by a host
to the controller specified in the CNTLID field (refer to Figure 468).


**Figure 470: Memory Range Tracking Descriptor**






|Bytes|Description|
|---|---|
|07:00|**Address (SADDR):** This field specifies the starting 64-bit address of the memory range where the address<br>is host memory (refer to section 1.5.46) associated with the controller specified by the CNTLID field (refer<br>to Figure 468). The address is aligned to the granularity specified by the RMRTG field. For example, if the<br>value in the RMRTG field is 8h, then the value in this field is required to the be aligned to 1 MiB (i.e., bits<br>19:0 are cleared to 0h).|
|11:08|**Length (LEN):** This field specifies the length of this host memory range in units of the tracking granularity<br>as defined by RMRTG field. For example, if the value n the RMRTG field is 8h and the value of this field is<br>4h, then the length of this memory range is 1 MiB * 4h which is 4 MiB.|



If the controller is unable to track the requested number of Memory Range Tracking Descriptors (i.e.,
specified in the RNMRTD field) or unable to track the memory changes at the specified granularity (i.e.,
RMRTG field), then:


   - the controller shall abort the command with a status code of Not Enough Resources; and

   - Dword 0 and Dword 1 of the completion queue entry shall be returned as defined in Figure 471
and Figure 472.


If any Address field is not aligned to the granularity specified by the RMRTG field, then the controller shall
abort the command with a status code of Invalid Field in Command.


If the address range specified by the Address field and the Length field specifies an address that is not host
memory (refer to section 1.5.46) associated with the controller specified by the CNTLID field, then the
controller processing the command shall abort the command with a status code of Invalid Field in
Command. If:


   - the command is successful; and


414


NVM Express [®] Base Specification, Revision 2.2


   - the configuration within the controller associated with the controller specified by the CNTLID field
changes resulting in that address range is no longer specifying host memory associated with the
controller specified by the CNTLID field (e.g., the address range overlaps with PMR or CMB), then
the behavior for tracking host memory changes for the controller specified by the CNTLID field is
undefined.


A host should not specify MSI or MSI-X registers in the address range. If the address range specified by
the Address field and the Length field contains addresses for MSI or MSI-X registers on the controller
specified by the CNTLID field, then the controller may or may not report modification to those MSI or MSIX register addresses.


**Figure 471: Track Memory Changes – Completion Queue Entry Dword 0**





|Bits|Description|
|---|---|
|31:16|Reserved|
|15:00|**Memory Range Tracking Granularity (MRTG):** This field indicates the lowest granularity that the controller<br>is able track the memory changes with the specified Memory Range Tracking Descriptor list (refer to Figure<br>469).<br>This units for this field is defined by the RMRTG field.|


**Figure 472: Track Memory Changes – Completion Queue Entry Dword 1**








|Bits|Description|
|---|---|
|31:00|**Number of Memory Range Tracking Descriptors (NMRTD):** This field indicates the number of<br>Memory Range Tracking Descriptors for which the controller is able to track the memory changes<br>with the requested granularity specified in the RMRTG field (refer to Figure 469).|



**Command Completion**


Upon completion of the Track Send command, the controller posts a completion queue entry to the Admin
Completion Queue indicating the status for the command. Section 5.1.27.1 describes completion details
each for management operation.


The use of Dword 0 and Dword 1 of the completion queue entry is specific to the management operation
specified in the Select field (refer to Figure 464). Refer to each management operation description in section
5.1.27.1 for details.


Track Send command specific status values (i.e., SCT field set to 1h) are shown in Figure 483.


**Figure 473: Track Send – Command Specific Status Values**







|Value|Definition|
|---|---|
|1Fh|**Invalid Controller Identifier:**The controller for the specified Controller Identifier is already<br>tracking host memory changes.|
|37h|**Invalid Controller Data Queue:** This error indicates:<br>• <br>that the specified Controller Data Queue Identifier is invalid for the controller processing<br>the command; or <br>• <br>the controller associated with the Controller Data Queue specified by the Controller<br>Data Queue Identifier is already logging user data changes.|
|38h|**Not Enough Resources:**This error indicates that there are not enough resources in the<br>controller to process the command successfully.|
|39h|**Controller Suspended:**The requested operation is not allowed if the controller specified in the<br>Controller Identifier field is suspended by a Migration Send command (refer to section 5.1.17.1.1).|

