**Format NVM command**


The Format NVM command is used to low level format the NVM media. This command is used by the host
to change the attributes of the NVM media (e.g., the LBA data size and/or metadata size for the NVM
Command Set). A low level format may destroy all data and metadata associated with all namespaces that
contain formatted storage or only the specific namespace associated with the command (refer to the Format
NVM Attributes field in the Identify Controller data structure, Figure 313). After the Format NVM command
successfully completes, the controller shall not return any user data that was previously contained in an
affected namespace.


192


NVM Express [®] Base Specification, Revision 2.2


As part of the Format NVM command, the host requests a format operation and may request a secure
erase of the contents of the NVM (refer to the SES field in Figure 190). There are two types of secure erase.
The User Data Erase erases all user content present in the NVM subsystem. The Cryptographic Erase
erases all user content present in the NVM subsystem by deleting the encryption key with which the user
data was previously encrypted.


The scope of the format operation and the scope of the format with secure erase depend on the attributes
that the controller supports for the Format NVM command and the Namespace Identifier specified in the
command as described in Figure 189. The type of secure erase, if applicable, is based on the setting of the
Secure Erase Settings field in Command Dword 10 as defined in Figure 190.


The scope of the entire Format NVM command is determined by the value of the SES field (refer to Figure
190) and the setting of either the Format Namespace Scope (FNS) bit or the Secure Erase Namespace
Scope (SENS) bit (refer to Figure 313) as follows:


a) If the Format NVM command does not specify Secure Erase (i.e., the SES field is cleared to 000b),

then the scope of the Format NVM command is indicated by the value of FNS bit and the value of
SENS bit is not applicable to this command.
b) If the Format NVM command specifies Secure Erase (i.e., the SES field is set to a non-zero value),

then the scope of the Format NVM command is indicated by the value of SENS bit and the value
of FNS bit is not applicable to this command.


**Figure 189: Format NVM – Operation Scope**



























|SES|FNS Bit|SENS Bit|NSID|Format Operation|
|---|---|---|---|---|
|000b (i.e.,<br>not a<br>secure<br>erase)|0|N/A|FFFFFFFFh1|All namespaces attached to the controller.<br>Other namespaces are not affected.|
|000b (i.e.,<br>not a<br>secure<br>erase)|0|0|Any allocated value<br>(refer to section 3.2.1.3)|The specified namespace. Other<br>namespaces are not affected.|
|000b (i.e.,<br>not a<br>secure<br>erase)|1|1|Any allocated value<br>(refer to section 3.2.1.3)<br>or FFFFFFFFh|All namespaces that exist in the NVM<br>subsystem.|
|001b or<br>010b (i.e.,<br>secure<br>erase)|N/A|0|FFFFFFFFh1|All namespaces attached to the controller.<br>Other namespaces are not affected.|
|001b or<br>010b (i.e.,<br>secure<br>erase)|N/A|0|Any allocated value<br>(refer to section 3.2.1.3)|The specified namespace. Other<br>namespaces are not affected.|
|001b or<br>010b (i.e.,<br>secure<br>erase)|N/A|1|Any allocated value<br>(refer to section 3.2.1.3)<br>or FFFFFFFFh|All namespaces that exist in the NVM<br>subsystem.|
|All others|All others|All others|All others|The controller shall abort the command<br>with a status code of Invalid Field in<br>Command|
|Notes:<br>1.<br>If the Format NVM Broadcast Support (FNVMBS) bit in the FNA field is set to ‘1’, then this value is not supported,<br>and the command is aborted as described in this section.|Notes:<br>1.<br>If the Format NVM Broadcast Support (FNVMBS) bit in the FNA field is set to ‘1’, then this value is not supported,<br>and the command is aborted as described in this section.|Notes:<br>1.<br>If the Format NVM Broadcast Support (FNVMBS) bit in the FNA field is set to ‘1’, then this value is not supported,<br>and the command is aborted as described in this section.|Notes:<br>1.<br>If the Format NVM Broadcast Support (FNVMBS) bit in the FNA field is set to ‘1’, then this value is not supported,<br>and the command is aborted as described in this section.|Notes:<br>1.<br>If the Format NVM Broadcast Support (FNVMBS) bit in the FNA field is set to ‘1’, then this value is not supported,<br>and the command is aborted as described in this section.|


If the NVM subsystem supports multiple domains and the Format NVM command is not able to format the
specified namespaces as a result of the NVM subsystem being divided (refer to section 3.2.5), then the
Format NVM command shall be aborted with a status code of Asymmetric Access Inaccessible or
Asymmetric Access Persistent Loss.


The Format NVM command may be aborted with a status code defined in this specification under
circumstances defined by a security specification (e.g., invalid security state as specified in TCG Storage
Interface Interactions specification). If there are I/O commands being processed for a namespace, then a
Format NVM command that is submitted affecting that namespace may be aborted; if aborted, then a status
code of Command Sequence Error shall be returned. If a Format NVM command is in progress, then an
I/O command that is submitted for any namespace affected by that Format NVM command may be aborted;


193


NVM Express [®] Base Specification, Revision 2.2


if aborted, then a status code of Format in Progress shall be returned. Refer to section 5 for further
information about restrictions on Admin commands during Format NVM.


For a Format NVM command with the NSID field set to FFFFFFFFh that specifies secure erase:


a) if the Secure Erase Namespace Scope (SENS) bit is set to ‘1’ in the FNA field (refer to Figure 313)

and there are no namespaces in the NVM subsystem, then that Format NVM command shall
complete without error; and
b) if the SENS bit is cleared to ‘0’ in the FNA field and there are no attached namespaces, then that

Format NVM command shall complete without error.


For a Format NVM command with an NSID field set to FFFFFFFFh that does not specify a secure erase:


a) if the Format Namespace Scope (FNS) bit is set to ‘1’ in the FNA field and there are no namespaces

in the NVM subsystem, then that Format NVM command shall complete without error; and
b) if the FNS bit is cleared to ‘0’ in the FNA field and there are no attached namespaces, then that

Format NVM command shall complete without error.


If a host does not set the LBA Format Extension Enable (LBAFEE) field to 1h in the Host Behavior Support
feature (refer to section 5.1.25.1.14), then the 0h value of the LBAFEE field disables any I/O Command Set
specific format that requires the LBAFEE field to be set to 1h (refer to the applicable I/O Command Set
specification). If a Format NVM command specifies a format that is disabled (e.g., the LBAFEE field is
cleared to 0h), then the controller shall abort that Format NVM command with a status code of Invalid
Namespace or Format.


If the format operation scope (refer to Figure 189) for a Format NVM command includes any namespace
that is write protected (refer to section 8.1.16), then the controller aborts that Format NVM command with
a status code of Namespace is Write Protected.


If the Format NVM Broadcast Support (FNVMBS) bit in the FNA field is set to ‘1’ and a Format NVM
command has the NSID field set to FFFFFFFFh, then the controller shall abort that command with a status
code of Invalid Field in Command.


After successful completion of a Format NVM command, the settings specified in the Format NVM
command (e.g., PI, MSET, LBAF) are reported as part of the Identify Namespace data structures (refer to
section 1.5.49).


The Format NVM command uses the Command Dword 10 field. All other command specific fields are
reserved.


**Figure 190: Format NVM – Command Dword 10**





|Bits|Description|
|---|---|
|31:14|Reserved|
|13:12|**LBA Format Upper (LBAFU):** This field specifies the most significant 2 bits of the Format Index of the<br>User Data Format to apply to the NVM media. This corresponds to the User Data Formats indicated in<br>the Identify command, refer to the Identify Namespace data structure and the LBA Format data structure<br>in the applicable I/O Command Set specification. If an unsupported User Data Format is selected, the<br>controller shall abort the command with a status code of Invalid Format.<br>This field shall be ignored by the controller if the LBA Format Extension Enable (LBAFEE) field is cleared<br>to 0h in the Host Behavior Support feature (refer to section 5.1.25.1.14).<br>NOTE: This field applies to all User Data Formats. The original name has been retained for historical<br>continuity.|


194


NVM Express [®] Base Specification, Revision 2.2


**Figure 190: Format NVM – Command Dword 10**










|Value|Definition|
|---|---|
|000b|No secure erase operation requested|
|001b|**User Data Erase:** All user data shall be erased, contents of the media allocated for<br>user data after the erase is indeterminate (e.g., the user data may be zero filled, one<br>filled, etc.). If a User Data Erase is requested and all affected user data is encrypted,<br>then the controller is allowed to use a cryptographic erase to perform the requested<br>User Data Erase.|
|010b|**Cryptographic Erase:** All user data shall be erased cryptographically. This is<br>accomplished by deleting the encryption key.|
|011b to 111b|Reserved|







|Bits|Description|
|---|---|
|11:09|**Secure Erase Settings (SES):**This field specifies whether a secure erase should be performed as part<br>of the format and the type of the secure erase operation. The erase applies to all user data, regardless<br>of location (e.g., within an exposed LBA (refer to the NVM Express NVM Command Set Specification),<br>within a cache, within deallocated logical blocks, etc.).<br>**Value**<br>**Definition**<br>000b<br>No secure erase operation requested<br>001b<br>**User Data Erase:** All user data shall be erased, contents of the media allocated for<br>user data after the erase is indeterminate (e.g., the user data may be zero filled, one<br>filled, etc.). If a User Data Erase is requested and all affected user data is encrypted,<br>then the controller is allowed to use a cryptographic erase to perform the requested<br>User Data Erase.<br>010b<br>**Cryptographic Erase:** All user data shall be erased cryptographically. This is<br>accomplished by deleting the encryption key.<br>011b to 111b<br>Reserved|
|08|**Protection Information Location (PIL):**I/O Command Set specific definition.1|
|07:05|**Protection Information (PI):**I/O Command Set specific definition.1|
|04|**Metadata Settings (MSET):**I/O Command Set specific definition.1|
|03:00|**LBA Format Lower (LBAFL):**This field specifies the least significant 4 bits of the Format Index of the<br>User Data Format to apply to the NVM media. This corresponds to the User Data Formats indicated in<br>the Identify Namespace data structure, refer to the Identify Namespace data structure and the I/O<br>Command Set specific Format data structure in the applicable I/O Command Set specification. If an<br>unsupported User Data Format is selected, the controller shall abort the command with a status code of<br>Invalid Format.<br>Note: This field applies to all User Data Formats. The original name has been retained for historical<br>continuity.|
|Note:<br>1.<br>I/O Command Set specific fields are described in the applicable I/O Command Set specification.|Note:<br>1.<br>I/O Command Set specific fields are described in the applicable I/O Command Set specification.|


**Command Completion**


A completion queue entry is posted to the Admin Completion Queue when the NVM media format is
complete. Format NVM command specific status values (i.e., SCT field set to 1h) are shown in Figure 191.


**Figure 191: Format NVM – Command Specific Status Values**






|Value|Definition|
|---|---|
|0Ah|**Invalid Format:**The format specified is invalid. This may be due to various conditions, including:<br>• <br>specifying an invalid User Data Format number;<br>• <br>enabling protection information when there are not sufficient metadata resources; or<br>• <br>the specified format is not available in the current configuration.|