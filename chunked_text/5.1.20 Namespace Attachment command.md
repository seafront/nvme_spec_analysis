**Namespace Attachment command**


The Namespace Attachment command is used to attach and detach controllers from a namespace. The
attach and detach operations (refer to section 8.1.15) are persistent across all reset events. Namespace
attach and detach operations are persistent across Virtualization Management commands that set a
secondary controller offline.


The Namespace Attachment command uses the Data Pointer and Command Dword 10 fields. All other
command specific fields are reserved.


The Select field determines the data structure used as part of the command. The data structure is 4,096
bytes in size. The data structure used for Controller Attach and Controller Detach is a Controller List (refer
to section 4.6.1). The controllers that are to be attached or detached, respectively, are described in the data
structure.


If the SEL field specifies the Controller Attach value, then


   - If the Maximum Domain Namespace Attachments (MAXDNA) field in the Identify Controller data
structure (refer to Figure 313) is non-zero, then:


358


NVM Express [®] Base Specification, Revision 2.2


`o` For each controller specified in the controller list, if attaching the namespace to that I/O
controller causes the sum of the number of namespaces attached to each I/O controller in
the Domain to be greater than the value specified in the MAXDNA field, then the controller
shall abort the command with a status code of Namespace Attachment Limit Exceeded;


and


   - For each I/O controller specified in the controller list, if the Maximum I/O Controller Namespace
Attachments (MAXCNA) field in the Identify Controller data structure for that controller is non-zero,
then:


`o` If attaching the namespace to that I/O controller causes that I/O controller to have the
number of attached namespaces to be greater than the value specified in the MAXCNA
field, then the controller shall abort the command with a status code of Namespace
Attachment Limit Exceeded.


If an attempt is made to attach a namespace to a controller that does not support the corresponding I/O
Command Set, then the command shall be aborted with a status code of I/O Command Set Not Supported.


If an attempt is made to attach a namespace to a controller that supports the corresponding I/O Command
Set and the corresponding I/O Command Set is not enabled by the I/O Command Set profile feature, then
the command shall be aborted with a status code of I/O Command Set Not Enabled.


**Figure 364: Namespace Attachment – Data Pointer**





|Bits|Description|
|---|---|
|127:00|**Data Pointer (DPTR):**This field specifies the start of the data buffer. Refer to Figure 92 for the definition<br>of this field. If using PRPs, this field shall not be a pointer to a PRP List as the data buffer may not cross<br>more than one page boundary.|


**Figure 365: Namespace Attachment – Command Dword 10**





|Bits|Description|
|---|---|
|31:04|Reserved|
|03:00|**Select (SEL):**This field selects the type of attachment to perform.<br>**Value**<br>**Definition**<br>0h<br>Controller Attach<br>1h<br>Controller Detach<br>2h to Fh<br>Reserved|


**Command Completion**




|Value|Definition|
|---|---|
|0h|Controller Attach|
|1h|Controller Detach|
|2h to Fh|Reserved|



When the command is completed, the controller posts a completion queue entry to the Admin Completion
Queue indicating the status for the command.


Command specific status values associated with the Namespace Attachment command are defined in
Figure 366. For failures, the byte offset of the first failing entry is reported in the Command Specific
Information field of the Error Information Log Entry. The controller does not process further entries in the
Controller List after an error is encountered.


**Figure 366: Namespace Attachment – Command Specific Status Values**

|Value|Definition|
|---|---|
|18h|**Namespace Already Attached:**The controller is already attached to the specified namespace.|
|19h|**Namespace Is Private:**The controller is not attached to the namespace. The request to attach the controller<br>could not be completed because the namespace is private and is already attached to one controller.|
|1Ah|**Namespace Not Attached:**The controller is not attached to the namespace. The request to detach the<br>controller could not be completed.|
|1Ch|**Controller List Invalid:**The controller list provided is invalid or the controller list contains an Administrative<br>controller.|



359


NVM Express [®] Base Specification, Revision 2.2


**Figure 366: Namespace Attachment – Command Specific Status Values**

|Value|Definition|
|---|---|
|25h|**ANA Attach Failed:** The controller is not attached to the namespace as a result of an ANA condition (e.g.,<br>attaching the controller would result in an ANA Persistent Loss state (refer to section 8.1.1.7)).|
|27h|**Namespace Attachment Limit Exceeded:** Attaching the namespace to a controller causes maximum<br>number of namespace attachments allowed to be exceeded.|
|29h|**I/O Command Set Not Supported:**The request to attach the controller could not be completed due to the<br>I/O Command Set corresponding to the namespace is not supported by the controller.|
|2Ah|**I/O Command Set Not Enabled:**The request to attach the controller could not be completed due to the I/O<br>Command Set corresponding to the namespace is restricted by the I/O Command Set profile feature.|
