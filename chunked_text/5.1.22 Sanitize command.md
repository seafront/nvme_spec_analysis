**Sanitize command**


The Sanitize command is used to start a sanitize operation that targets the NVM subsystem or to recover
from a previously failed sanitize operation that targeted the NVM subsystem. The sanitize operation types
that may be supported are Block Erase, Crypto Erase, and Overwrite.


A sanitize operation consists of:


  - sanitize processing (refer to section 8.1.24), which may include:


`o` deallocation of all media allocated for user data; and
`o` additional media modification;


  - optional verification of media allocated for user data; and

  - post-verification deallocation of all media allocated for user data following media verification, if any,
as described in section 8.1.24.


All sanitize operations are performed in the background (i.e., completion of the Sanitize command that
starts a sanitize operation does not indicate completion of that sanitize operation). Refer to section 8.1.24
for details on the sanitize operation.


If the NVM subsystem supports multiple domains and the Sanitize command is not able to start a sanitize
operation as a result of the NVM subsystem being divided (refer to section 3.2.5), then the controller shall
abort the Sanitize command shall be aborted with a status code of Asymmetric Access Inaccessible or
Asymmetric Access Persistent Loss.


The Sanitize command shall not be supported by Exported NVM Subsystems (refer to section 8.1.24.5).


The Sanitize Capabilities (SANICAP) field in the Identify Controller data structure (refer to Figure 313)
indicates:


a) the sanitize operation types supported;
b) whether setting the No-Deallocate After Sanitize (NDAS) bit (refer to Figure 373) causes media to

be modified as part of sanitize processing;
c) whether the controller inhibits the functionality of the No-Deallocation After Sanitize bit in the

Sanitize command; and


362


NVM Express [®] Base Specification, Revision 2.2


d) whether the controller supports the Media Verification state and the Post-Verification Deallocation

state (refer to the Verification Support (VERS) bit in the SANICAP field in Figure 313).


If a Sanitize command specifies an unsupported value in the SANACT field (refer to Figure 373), then the
controller shall abort the command with a status code of Invalid Field in Command.


If the Verification Support (VERS) bit is cleared to ‘0’ and a Sanitize command specifies the Enter Media
Verification State (EMVS) bit set to ‘1’ (refer to Figure 373), then the controller shall abort the command
with a status code of Invalid Field in Command.


If the Verification Support (VERS) bit is set to ‘1’ and a Sanitize command is processed that specifies:


a) the Enter Media Verification State (EMVS) bit set to ‘1’, the SANACT field set to a value of 010b

(i.e., Block Erase) or a value of 100b (i.e., Crypto Erase), and the No-Deallocate After Sanitize
(NDAS) bit cleared to ‘0’, then successful sanitize processing is followed by entry to the Media
Verification state;


b) the Enter Media Verification State (EMVS) bit set to ‘1’ and:


a) the SANACT field set to 011b (i.e., Overwrite); or
b) the No-Deallocate After Sanitize (NDAS) bit set to ‘1’;


then the controller shall abort the command with a status code of Invalid Field in Command;


c) the SANACT field set to 101b (i.e., Exit Media Verification State) and the sanitization target is in

the Media Verification state, then:


    - the controller does not start a new sanitize operation; and

    - the sanitization target transitions from the Media Verification state to the Post-Verification
Deallocation state, in which all media allocated for user data in the NVM subsystem is
deallocated;


or


d) the SANACT field set to 101b (i.e., Exit Media Verification State) and the sanitization target is not

in the Media Verification state, then the controller shall abort the command with a status code of
Invalid Field in Command.


If any Persistent Memory Region is enabled in an NVM subsystem, then the controller shall abort any
Sanitize command with a status code of Sanitize Prohibited While Persistent Memory Region is Enabled.


If any namespace is write protected in an NVM subsystem (refer to section 8.1.16), then the controller
aborts any Sanitize command with a status code of Namespace is Write Protected.


If a firmware activation with reset is pending, then the controller shall abort any Sanitize command (refer to
section 5.1.8.1 and section 3.11).


If the Firmware Commit command that established the pending firmware activation with reset condition
returned a status code of:


a) Firmware Activation Requires Controller Level Reset;
b) Firmware Activation Requires Conventional Reset; or
c) Firmware Activation Requires NVM Subsystem Reset,


then the controller shall abort the Sanitize command with that same status code.


If the Firmware Commit command that established the pending firmware activation with reset condition
completed successfully or returned a status code other than:


a) Firmware Activation Requires Controller Level Reset;
b) Firmware Activation Requires Conventional Reset; or
c) Firmware Activation Requires NVM Subsystem Reset,


then the controller shall abort the Sanitize command with a status code of Firmware Activation Requires
Controller Level Reset.


363


NVM Express [®] Base Specification, Revision 2.2


Activation of new firmware is prohibited during a sanitize operation (refer to section 8.1.24.4).


If one or more controllers in the NVM subsystem is suspended (refer to section 5.1.17.1.1), then the
controller shall abort the command with a status code of Controller Suspended.


Support for Sanitize commands in a Controller Memory Buffer (i.e., submitted to an Admin Submission
Queue in a Controller Memory Buffer or specifying an Admin Completion Queue in a Controller Memory
Buffer) is implementation specific. If an implementation does not support Sanitize commands in a Controller
Memory Buffer and a controller’s Admin Submission Queue or Admin Completion Queue is in the Controller
Memory Buffer, then the controller shall abort all Sanitize commands with a status code of Command Not
Supported for Queue in CMB.


All sanitize operations (i.e., Block Erase, Crypto Erase, and Overwrite) are performed in the background
(i.e., Sanitize command completion does not indicate sanitize operation completion). If a sanitize operation
starts as a result of a Sanitize command, then the controller shall complete that Sanitize command with a
status code of Successful Completion. If the controller completes a Sanitize command with any status code
other than Successful Completion, then the controller:


  - shall not start the sanitize operation for that command;

  - shall not modify the Sanitize Status log page; and

  - shall not alter any user data.


The Sanitize command uses Command Dword 10 and Command Dword 11. All other command specific
fields are reserved.


**Figure 373: Sanitize – Command Dword 10**





|Bits|Description|
|---|---|
|31:11|Reserved|
|10|**Enter Media Verification State (EMVS):** If this bit is set to ‘1’, then the Media Verification state shall be<br>entered if sanitize processing completes successfully (i.e., the Global Data Erased (GDE) bit is set to ‘1’<br>(refer to Figure 292)).<br>If this bit is cleared to ‘0’, then this bit shall have no effect.<br>If the SANACT field does not specify starting a sanitize operation (i.e., is set to any value other than<br>010b, 011b, or 100b), then this bit shall be ignored by the controller.|
|09|**No-Deallocate After Sanitize (NDAS):** If this bit is set to ‘1’ and the No-Deallocate Inhibited bit (refer to<br>Figure 313) is cleared to ‘0’, then the controller shall not deallocate any media allocated for user data as<br>a result of successfully completing the sanitize operation. If this bit is:<br>a)<br>cleared to ‘0’; or<br>b)<br>set to ‘1’ and the No-Deallocate Inhibited bit is set to ‘1’,<br>then the controller should deallocate all media allocated for user data as a result of successfully<br>completing the sanitize operation.<br>If the SANACT field does not specify starting a sanitize operation (i.e., is set to any value other than<br>010b, 011b, or 100b), then this bit shall be ignored by the controller.|
|08|**Overwrite Invert Pattern Between Passes (OIPBP):**If this bit is set to ‘1’, then the Overwrite Pattern<br>shall be inverted between passes. If this bit is cleared to ‘0’, then the overwrite pattern shall not be<br>inverted between passes. If the Sanitize Action field is set to a value other than 011b (i.e., Overwrite),<br>then this bit shall be ignored by the controller.|
|07:04|**Overwrite Pass Count (OWPASS):** This field specifies the number of overwrite passes (i.e., how many<br>times the media is to be overwritten) using the data from the Overwrite Pattern field of this command. A<br>value of 0h specifies 16 overwrite passes. If the Sanitize Action field is set to a value other than 011b<br>(i.e., Overwrite), then this field shall be ignored by the controller.|
|03|**Allow Unrestricted Sanitize Exit (AUSE):** If this bit is set to ‘1’, then the sanitize processing is<br>performed in unrestricted completion mode (i.e., in the Unrestricted Processing state; refer to section<br>8.1.24.3.4). If this bit is cleared to ‘0’, then the sanitize processing is performed in restricted completion<br>mode (i.e., in the Restricted Processing state; refer to section 8.1.24.3.2).<br>If the SANACT field does not specify starting a sanitize operation (i.e., is set to any value other than<br>010b, 011b, or 100b), then this bit shall be ignored by the controller.|


364


NVM Express [®] Base Specification, Revision 2.2


**Figure 373: Sanitize – Command Dword 10**





|Bits|Description|
|---|---|
|02:00|**Sanitize Action (SANACT):**This field specifies the sanitize action to perform.<br>**Value**<br>**Definition**<br>000b<br>Reserved<br>001b<br>Exit Failure Mode<br>010b<br>Start a Block Erase sanitize operation<br>011b<br>Start an Overwrite sanitize operation<br>100b<br>Start a Crypto Erase sanitize operation<br>101b<br>Exit Media Verification State<br>110b to 111b<br>Reserved|


|Value|Definition|
|---|---|
|000b|Reserved|
|001b|Exit Failure Mode|
|010b|Start a Block Erase sanitize operation|
|011b|Start an Overwrite sanitize operation|
|100b|Start a Crypto Erase sanitize operation|
|101b|Exit Media Verification State|
|110b to 111b|Reserved|


**Figure 374: Sanitize – Command Dword 11**






|Bits|Description|
|---|---|
|31:00|**Overwrite Pattern (OVRPAT):**This field specifies a 32-bit pattern that is used for the Overwrite sanitize<br>operation. Refer to section 8.1.24.<br>If the Sanitize Action field is set to a value other than 011b (i.e., Overwrite), then this field shall be ignored<br>by the controller.|



**Command Completion**


When the command is complete, the controller shall post a completion queue entry to the Admin Completion
Queue indicating the status for the command. All sanitize operations are performed in the background (i.e.,
completion of the Sanitize command that started that sanitize operation does not indicate completion of the
sanitize operation). If a sanitize operation starts (refer to section 8.1.24.3), then the Sanitize Status log page
shall be updated before posting the completion queue entry for the command that started that sanitize
operation.


Sanitize command specific status values (i.e., SCT field set to 1h) are shown in Figure 375.


**Figure 375: Sanitize – Command Specific Status Values**







|Value|Definition|
|---|---|
|0Bh|**Firmware Activation Requires Conventional Reset:** The sanitize operation could not be started<br>because a firmware activation is pending and a Conventional Reset (refer to the NVM Express NVMe<br>over PCIe Transport Specification) is required.|
|10h|**Firmware Activation Requires NVM Subsystem Reset:** The sanitize operation could not be started<br>because a firmware activation is pending and an NVM Subsystem Reset is required.|
|11h|**Firmware Activation Requires Controller Level Reset:** The sanitize operation could not be started<br>because a firmware activation is pending and a Controller Level Reset is required.|
|23h|**Sanitize Prohibited While Persistent Memory Region is Enabled:**A sanitize operation is prohibited<br>while the Persistent Memory Region is enabled.|
|39h|**Controller Suspended:**One or more controllers in the NVM subsystem have been suspended by a<br>Migration Send command.|
