
**Doorbell Buffer Config command**


The Doorbell Buffer Config command is used to provide two separate memory buffers that mirror the
controller's doorbell properties defined in section 3.1.4. This command is intended for emulated controllers
and is not typically supported by a physical NVMe controller. The two buffers are known as “Shadow
Doorbell” and “EventIdx”, respectively. Refer to “Updating Controller Doorbell Properties using a Shadow
Doorbell Buffer” in section B.5.2 for an example of how these buffers may be used.


The Doorbell Buffer Config command uses the PRP Entry 1 and PRP Entry 2 fields. All other command
specific fields are reserved. The command is not namespace specific, does not support metadata, and does
not support SGLs. The settings are not retained across a Controller Level Reset.


Each buffer supplied with the Doorbell Buffer Config command shall be a single physical memory page as
defined by the CC.MPS field. The controller shall ensure that the following condition is satisfied:


(4 << CAP.DSTRD) * (max(NSQA, NCQA)+1) <= (2^(12+CC.MPS))


**Figure 487: Doorbell Buffer Config – Shadow Doorbell and EventIdx**













|Start<br>1, 2<br>(Offset in Buffer)|End<br>1, 2<br>(Offset in Buffer)|2<br>Description|
|---|---|---|
|00h|03h|Submission Queue 0 Tail Doorbell or EventIdx (Admin)|
|00h + (1 *<br>(4 << CAP.DSTRD))|03h + (1 *<br>(4 << CAP.DSTRD))|Completion Queue 0 Head Doorbell or EventIdx (Admin)|
|00h + (2 *<br>(4 << CAP.DSTRD))|03h + (2 *<br>(4 << CAP.DSTRD))|Submission Queue 1 Tail Doorbell or EventIdx|
|00h + (3 *<br>(4 << CAP.DSTRD))|03h + (3 *<br>(4 << CAP.DSTRD))|Completion Queue 1 Head Doorbell or EventIdx|
|…|…|…|
|00h + (2y *<br>(4 << CAP.DSTRD))|03h + (2y *<br>(4 << CAP.DSTRD))|Submission Queue y Tail Doorbell or EventIdx|


420


NVM Express [®] Base Specification, Revision 2.2


**Figure 487: Doorbell Buffer Config – Shadow Doorbell and EventIdx**







|Start<br>1, 2<br>(Offset in Buffer)|End<br>1, 2<br>(Offset in Buffer)|2<br>Description|
|---|---|---|
|00h + ((2y + 1) *<br>(4 << CAP.DSTRD))|03h + ((2y + 1) *<br>(4 << CAP.DSTRD))|Completion Queue y Head Doorbell or EventIdx|
|Notes:<br>1.<br>The offsets in Start and End are referenced to the value provided in PRP1 for the doorbell buffer and to the<br>value provided in PRP2 for the EventIdx buffer.<br>2.<br>The value of y is equal to max(NSQA, NCQA).|Notes:<br>1.<br>The offsets in Start and End are referenced to the value provided in PRP1 for the doorbell buffer and to the<br>value provided in PRP2 for the EventIdx buffer.<br>2.<br>The value of y is equal to max(NSQA, NCQA).|Notes:<br>1.<br>The offsets in Start and End are referenced to the value provided in PRP1 for the doorbell buffer and to the<br>value provided in PRP2 for the EventIdx buffer.<br>2.<br>The value of y is equal to max(NSQA, NCQA).|


**Figure 488: Doorbell Buffer Config – PRP Entry 1**





|Bits|Description|
|---|---|
|63:00|**PRP Entry 1 (PRP1):**This field specifies a 64-bit base memory address pointer to the Shadow Doorbell<br>buffer with the definition specified in Figure 487. The Shadow Doorbell buffer is updated by the host. This<br>buffer shall be memory page aligned.|


**Figure 489: Doorbell Buffer Config – PRP Entry 2**







|Bits|Description|
|---|---|
|63:00|**PRP Entry 2 (PRP2):**This field specifies a 64-bit base memory address pointer to the EventIdx buffer<br>with the definition specified in Figure 487. The EventIdx buffer is updated by the para-virtualized<br>controller. This buffer shall be memory page aligned.|


**Command Completion**



When the command is completed, the controller posts a completion queue entry to the Admin Completion
Queue indicating the status for the command. If the Shadow Doorbell buffer or EventIdx buffer memory
addresses are invalid, then a status code of Invalid Field in Command shall be returned.