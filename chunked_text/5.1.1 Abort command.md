**Abort command**


The Abort command is used to request an abort of a specific command previously submitted to the Admin
Submission Queue or an I/O Submission Queue. An Abort command may or may not abort the command
that was requested to be aborted. For example, the command to abort may have already completed,
currently be in execution, or may be deeply queued.


The controller should process the Abort command as soon as the command is fetched.


To abort a large number of commands (e.g., a larger number of commands than the limit listed in the ACL
field), the host should:


  - use the Cancel command (refer to section 7.1), if supported, to abort all commands submitted to
an I/O Submission Queue or to abort all commands submitted to an I/O Submission Queue for a
specific namespace; or

  - follow the procedures described in section 3.3.1.3 to delete the I/O Submission Queue and recreate
the I/O Submission Queue.


If an abort action is performed on the command to abort, that action may be:


  - an immediate abort (i.e., the abort action occurs prior to posting the completion queue entry for the
Abort command); or

  - a deferred abort (i.e., the abort action occurs after posting the completion queue entry for the Abort
command).


If an immediate abort is performed, then the controller shall either:


  - post the completion queue entry for the command to abort to the appropriate Admin Completion
Queue or I/O Completion Queue with a status code of Command Abort Requested before the
completion queue entry for the Abort command is posted to the Admin Completion Queue; or

  - ensure that there are no subsequent effects of the command to abort, as described in section
5.1.1.1, prior to posting the completion queue entry for the Abort command and post the completion
queue entry for the command to abort to the appropriate Admin Completion Queue or I/O
Completion Queue with a status code of Command Abort Requested. The completion queue entry
for the Abort command and the completion queue entry for the command to abort are allowed to
be posted in any order.


If an immediate abort is not performed, then the controller may or may not perform a deferred abort.


The Abort command uses the Command Dword 10 field. All other command specific fields are reserved.


The Abort Command Limit field in the Identify Controller data structure (refer to Figure 313) indicates the
controller limit on concurrent execution of Abort commands. A host should not allow the number of
outstanding Abort commands to exceed this value. The controller may complete any excess Abort
commands with the status code set to Abort Command Limit Exceeded.


**Figure 144: Abort – Command Dword 10**

|Bits|Description|
|---|---|
|31:16|**Command Identifier (CID):**This field specifies the command identifier of the command to be aborted,<br>that was specified in the CDW0.CID field within the command itself.|
|15:00|**Submission Queue Identifier (SQID):**This field specifies the identifier of the Submission Queue that<br>the command to be aborted is associated with.|



**Immediate Abort requirements**


If the controller performs an immediate abort, then the controller shall ensure that, other than the posting
of the completion queue entry for the command to abort, there are no effects of that command (e.g., no
host memory access, command processing does not modify: NVM media, NVM Set state, Endurance
Group state, namespace state, controller state, domain state, or NVM subsystem state) subsequent to the
posting of the CQE for the command that requested the abort. If the controller is not able to ensure there


170


NVM Express [®] Base Specification, Revision 2.2


are no effects of the command to abort subsequent to the posting of the CQE for the command that
requested the abort, then the controller shall not perform an immediate abort on that command.


For example, if a command:


  - requests a data transfer;

  - the data transfer has been initiated and not completed; and

  - the CQE for that command was not posted prior to the posting of the CQE for the command that
requested the abort,


then the controller is prohibited from performing an immediate abort.


Performing an immediate abort effects the information returned in the CQE for the command that requested
the abort as described in section 5.1.1.2 for an Abort command and in section 7.1.1 for a Cancel command.


**Command Completion**


Upon completion of the Abort command, the controller posts a completion queue entry to the Admin
Completion Queue indicating the status for the Abort command. Dword 0 of the completion queue entry
indicates information about the command to abort as shown in Figure 145.


**Figure 145: Abort Command – Completion Queue Entry Dword 0**






|Bits|Description|
|---|---|
|31:01|Reserved|
|00|**Immediate Abort Not Performed (IANP):**Indicates whether or not an immediate abort was performed.<br>If this bit is set to ‘1’, then an immediate abort was not performed (i.e., the command to abort was not<br>aborted prior to posting the CQE for the Abort command) for any reason (e.g., the immediate abort<br>requirements were not met, the requested command to abort was not found). If this bit is cleared to ‘0’,<br>then an immediate abort was performed (i.e., the command to abort was aborted prior to posting the<br>CQE for the Abort command).|



If the Immediate Abort Not Performed bit in Dword 0 (refer to Figure 145) is set to ‘1’ in the completion
queue entry for the Abort command and a deferred abort is performed, then the controller shall set the
status code for the command to abort to Command Abort Requested. The host should examine the status
in the completion queue entry of the command to abort to determine if the command was aborted.


Command specific status code values associated with the Abort command are defined in Figure 146.


**Figure 146: Abort – Command Specific Status Values**

|Value|Definition|
|---|---|
|3h|**Abort Command Limit Exceeded:** The number of concurrently outstanding Abort commands has exceeded<br>the limit indicated in the Identify Controller data structure.|
